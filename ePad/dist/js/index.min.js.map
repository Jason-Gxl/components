{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","js/eraser.js","js/ferula.js","js/image.js","js/index.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modeMap","circular","quadrate","pos","lastPoint","Eraser","params","this","name","interimBuffer","buffer","prototype","constructor","active","mouseRender","data","self","type","x","y","eraserSize","mode","current","from","id","width","mainCanvas","offsetWidth","height","offsetHeight","largen","cw","clientWidth","ch","clientHeight","Math","min","apply","lesser","max","bufferRender","_data","origin","status","ex","ey","size","push","render","destory","vm","window","eraser","Ferula","ferula","Image","renderBuffer","toolbarMap","image","shift","concat","toString","Object","URL","webkitURL","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","eventMap","click","down","move","up","wheel","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","noCache","noTab","noToolbar","layout","fontSize","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","ferulaSize","toolbars","childToolbars","rectangle","line","round","titles","circle","roundel","ellipesstroke","rectstroke","pen","rect","ellipes","text","arrow","export","scissors","clear","classes","tabNameMap","0","tpl1","tpl2","tpl3","tpl5","addEventListener","target","fn","use","delEvent","detachEvent","addClass","ele","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextNode","css","attrName","attrValue","scroll","scrolls","createElement","xTpl","Scroll","activeType","node","parentNode","events","scrollObj","scrollBuilder","tplDiv","innerHTML","yTpl","removeChild","firstChild","appendChild","toolbar","getElementsByClassName","scrollHeight","classList","remove","defineProperty","set","d","get","mousemoveHandler","obj","args","event","clientX","distance","startPoint","scale","moveWidth","coverWidth","clientY","moveHeight","coverHeight","mouseupHandler","addEvent","slice","arguments","param","container","offsetLeft","style","left","scrollLeft","offsetTop","top","scrollTop","fire","resize","scrollWidth","add","eventName","splice","indexOf","forEach","create","uuid","val","scaleWidth","scaleHeight","isNaN","firstArg","arg","_type","key","copy","item","index","saveAsImage","count","arr","file","len","activeTab","tab","getActive","next","list","imgData","createImageCanvas","toDataURL","_data_","page","pageNumber","getPageNumber","saveData","_createImage","pop","trim","content","keys","sort","b","renderPen","callback","isCreateImage","canvas","bufferCanvas","wScale","hScale","ctx","getContext","strokeStyle","lineWidth","point","beginPath","lineTo","stroke","restore","renderRect","strokeRect","fillStyle","fillRect","moveTo","angle","atan2","PI","angle1","topx","cos","topy","sin","botx","angle2","boty","save","arc","fill","scaleX","scaleY","closePath","font","renderImage","fileCanvas","img","tplImage","src","onload","imgWidth","imgHeight","resizePad","cWidth","cHeight","resizePadPixel","pWidth","pHeight","drawImage","pw","ph","sImgWidth","sImgHeight","dw","dh","cwhp","iwhp","delete","atan","x1","y1","x2","y2","x3","y3","x4","y4","clip","clearRect","renderLine","renderRound","renderText","mouseIconCanvas","px","py","mouse","Tab","canvasMap","build","_tab","that","_tabTpl","tabTpl","del","delTpl","UL","_id","li","firstElementChild","tabMap","getElementsByTagName","cancelBubble","preventDefault","onTabRemove","activeObj","onTabChange","tabWrap","dataMap","splitPage","tabName","saving","it","setTimeout","pageMap","getData","clearTimeout","idList","removeClass","toOrigin","show","getTab","tabId","localStorage","setItem","JSON","stringify","cleanCache","removeItem","getPage","outData","Page","currentPage","pageEle","div","prePageBtn","pre","total","goPageBtn","pageNumberInput","value","go","onPageTurn","$1","keyCode","which","start","__data","some","flag","nextPageBtn","pageWrap","splitpageLayout","right","hide","empower","WPad","setAttribute","waitList","onRender","onMousemove","fr","FileReader","isFullScreen","exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","colorInput","bufferCanvas4","_toolbar","_childToolbars","_tpl2","childToolbarStr","toolbarStr","fullScreen","__str__","parse","getItem","canvasWrap","toolbarWrap","createSize","canvasWrapWidth","canvasWrapHeight","$2","_canvasWrapWidth","_canvasWrapHeight","returnValue","detail","oldAvilWidth","oldAvilHeight","avilWidth","avilHeight","w","h","bufferCanvas1","bufferCanvas2","bufferCanvas3","textInput","init","onScroll","fullScreenBtn","pad","showFiles","files","newTab","isShow","_showFiles","pageObj","setPage","onShowFiles","result","fileInput","readAsDataURL","shiftKey","span","srcElement","level","getAttribute","handPad","removeAttribute","downloadEle","imageDataArr","split","bStr","atob","tArr","Uint8ClampedArray","charCodeAt","href","url","download","revokeObjectURL","exportImage","curActiveNode","lastSpan","curActiveChildNode","parentSpan","preNode","title","match","stopPropagation","mouseX","mouseY","targetTouches","getBoundingClientRect","posY","toLowerCase","moveX","posX","moveY","_n","realData","renderAll","dataArr","renderMouse","console","error","enable","createImage","turnPage","number","removeTab","wPad","_params","getPadById","getPadByIndex","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","xc","yc","originY","abs","9","Text","cssText","focus"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: eraser.js\r\n * describe: 橡皮擦\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null,\r\n\t\tlastPoint = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\t// 存储临时数据\r\n\t\tthis.interimBuffer = [];\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\t// 橡皮擦放大接口\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 橡皮擦缩小接口\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// 橡皮擦功能较为特殊，直接绘制到持久画板上\r\n\t\t// status = 1\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = {type: \"eraser\", data: [], status: 1, origin: true, mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\r\n\t\t\tif(!origin && lastPoint) {\r\n\t\t\t\t_data.ex = lastPoint.x;\r\n\t\t\t\t_data.ey = lastPoint.y;\r\n\t\t\t} else {\r\n\t\t\t\t_data.ex = _data.x;\r\n\t\t\t\t_data.ey = _data.y;\r\n\t\t\t}\r\n\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.render(data);\r\n\t\t\tlastPoint = _data;\r\n\t\t},\r\n\t\t// 舍弃\r\n\t\trender: function() {\r\n\t\t\treturn ;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: ferula.js\r\n * describe: 教鞭\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: image.js\r\n * describe: 演示图片\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tURL = window.URL || window.webkitURL,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\t// 事件名map，PC端和移动端需要对应不同的事件名\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mousemove\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\"\r\n\t\t},\r\n\t\t// 工具栏不同的布局对应的className\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\t// 默认的白板初始化参数\r\n\t\t// ferula, ellipesstroke, rectstroke, pen, eraser, rect, ellipes, text, line, arrow, color, export, scissors, clear, enlarge, file, handPad\r\n\t\tdefaultConfig = {\r\n\t\t\tdata: null,\r\n\t\t\tnoCache: false,\r\n\t\t\tnoTab: false,\r\n\t\t\tnoToolbar: false,\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tfontSize: 16,\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\t// 不同工具对应的名称\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\t// 不同工具对应的icon的className\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\t// 白板tab的默认名称\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n// ==============================================================模板===============================================================\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap @LAYOUT@ @DISABLED@ @NOTOOLBAR@ @NOTAB@\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">@TOOLBARS@</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"@TITLE@\"><span class=\"item-icon iconfont @ICONCLASS@\" item=\"@ITEM@\" level=\"@LEVEL@\"></span>@CHILDTOOLBARS@</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">@CHILDTOOLBARITEM@</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn iconfont icon-zuofanye\"></a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn iconfont icon-youfanye\"></a>\\\r\n\t\t\t<span><input type=\"text\" class=\"page-number-input\"/>/@TOTAL@<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl5 = '<li class=\"toolbar-item full-screen-btn-wrap\"><span class=\"item-icon full-screen-btn iconfont icon-enlarge\" item=\"fullScreen\"></span></li>';\r\n// ==============================================================模板===============================================================\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\t// 这里创建一个ele对象，此对象下都是对dom节点进行操作的接口\r\n\t// 目地是方便后面的调用\r\n\tvar ele = {\r\n\t\t// 对dom节点绑定事件\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 移除dom节点上的事件\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 为dom节点添加一个指定的类名\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 移除dom节点上指定的类名\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取指定dom节点的前一个节点\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\t// 获取指定dom节点的下一个节点\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\t// 为dom节点添加样式\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\t// 滚动条模块\r\n\t// 如果创建白板时，为白板指定了固定大小，且白板大小大于当前放置白板的容器时会创建滚动条\r\n\tvar scroll = (function() {\r\n\t\tvar scrolls = [],\r\n\t\t\ttplDiv = document.createElement(\"DIV\"),\r\n\t\t\txTpl = '<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>',\r\n\t\t\tyTpl = '<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>';\r\n\r\n\t\tfunction Scroll(params) {\r\n\t\t\tif(!(this instanceof Scroll)) {\r\n\t\t\t\treturn new Scroll(params);\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdisable = false,\r\n\t\t\t\tactiveType = \"x\",\r\n\t\t\t\tstartPoint = {x: 0, y: 0},\r\n\t\t\t\tparentNode = params.node.parentNode;\r\n\r\n\t\t\tself.params = params;\r\n\t\t\tself.events = {};\r\n\t\t\tself.scrollObj = {};\r\n\r\n\t\t\tvar scrollBuilder = function(type) {\r\n\t\t\t\ttplDiv.innerHTML = \"x\"===type?xTpl:yTpl;\r\n\t\t\t\tvar ele = tplDiv.removeChild(tplDiv.firstChild);\r\n\t\t\t\tparentNode.appendChild(ele);\r\n\r\n\t\t\t\tself.scrollObj[type] = {\r\n\t\t\t\t\tcontainer: ele,\r\n\t\t\t\t\ttoolbar: ele.getElementsByClassName(\"scroll-toolbar\")[0]\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\tparams.node.clientWidth<params.node.scrollWidth && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.node.clientHeight<params.node.scrollHeight && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tObject.defineProperty(this, \"disable\", {\r\n\t\t\t\tset: function(d) {\r\n\t\t\t\t\tdisable = d;\r\n\t\t\t\t},\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn disable;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif(!params.type) {\r\n\t\t\t\tscrollBuilder(\"x\");\r\n\t\t\t\tscrollBuilder(\"y\");\r\n\t\t\t} else {\r\n\t\t\t\tscrollBuilder(params.type);\r\n\t\t\t}\r\n\r\n\t\t\tvar mousemoveHandler = function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\tobj = self.scrollObj[activeType],\r\n\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\tif(\"x\"===activeType) {\r\n\t\t\t\t\tvar x = e.x || e.clientX, data = {type: \"x\", distance: x-startPoint.x, from: params.id, scale: obj.moveWidth/obj.coverWidth};\r\n\t\t\t\t\tstartPoint.x = x;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar y = e.y || e.clientY, data = {type: \"y\", distance: y-startPoint.y, from: params.id, scale: obj.moveHeight/obj.coverHeight};\r\n\t\t\t\t\tstartPoint.y = y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.scroll(data);\r\n\t\t\t};\r\n\r\n\t\t\tvar mouseupHandler = function() {\r\n\t\t\t\tele.delEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\tele.delEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t};\r\n\r\n\t\t\tif(self.scrollObj.x) {\r\n\t\t\t\tele.addEvent(self.scrollObj.x.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.x = e.x || e.clientX;\r\n\t\t\t\t\tactiveType = \"x\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(self.scrollObj.y) {\r\n\t\t\t\tele.addEvent(self.scrollObj.y.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.y = e.y || e.clientY;\r\n\t\t\t\t\tactiveType = \"y\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tScroll.prototype = {\r\n\t\t\tconstructor: Scroll,\r\n\t\t\tscroll: function(param) {\r\n\t\t\t\tvar params = this.params,\r\n\t\t\t\t\tobj = this.scrollObj[param.type],\r\n\t\t\t\t\tcontainer = obj.container,\r\n\t\t\t\t\ttoolbar = obj.toolbar;\r\n\r\n\t\t\t\tif(\"x\"===param.type) {\r\n\t\t\t\t\tvar offsetLeft = toolbar.offsetLeft + param.distance;\r\n\t\t\t\t\ttoolbar.style.left = Math.max(0, Math.min(offsetLeft, container.clientWidth - toolbar.offsetWidth)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollLeft = params.node.scrollLeft + (param.distance/(obj.moveWidth/obj.coverWidth))/((obj.moveWidth/obj.coverWidth)/param.scale);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar offsetTop = toolbar.offsetTop + param.distance;\r\n\t\t\t\t\ttoolbar.style.top = Math.max(0, Math.min(offsetTop, container.clientHeight - toolbar.offsetHeight)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollTop = params.node.scrollTop + (param.distance/(obj.moveHeight/obj.coverHeight))/((obj.moveHeight/obj.coverHeight)/param.scale);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(void(0)==this.params.id || param.from==this.params.id) {\r\n\t\t\t\t\tthis.fire(\"scroll\", param);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttoOrigin: function(type) {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(!type) {\r\n\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(this.scrollObj.x) {\r\n\t\t\t\t\tvar obj = this.scrollObj.x,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverWidth = params.node.scrollWidth - params.node.clientWidth;\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoolbar.style.width = Math.max(obj.container.clientWidth - coverWidth/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverWidth = coverWidth;\r\n\t\t\t\t\tobj.moveWidth = obj.container.clientWidth - toolbar.offsetWidth;\r\n\r\n\t\t\t\t\tif(0===obj.moveWidth) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.scrollObj.y) {\r\n\t\t\t\t\tvar obj = this.scrollObj.y,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverHeight = params.node.scrollHeight - params.node.clientHeight;\r\n\r\n\t\t\t\t\ttoolbar.style.height = Math.max(obj.container.clientHeight - coverHeight/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverHeight = coverHeight;\r\n\t\t\t\t\tobj.moveHeight = obj.container.clientHeight - toolbar.offsetHeight;\r\n\r\n\t\t\t\t\tif(0===obj.moveHeight) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(!events[eventName]) {\r\n\t\t\t\t\tevents[eventName] = [fn];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[eventName].push(fn);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(\"[object Function]\"===toString.call(fn)) {\r\n\t\t\t\t\tevents[eventName].splice(events[eventName].indexOf(fn), 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete events[eventName];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfire: function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\teventName = args.shift(),\r\n\t\t\t\t\tevents = this.events;\r\n\r\n\t\t\t\tevents[eventName] && events[eventName].forEach(function(fn) {\r\n\t\t\t\t\t\"[object Function]\"===toString.call(fn) && fn.apply(Object.create(null), args);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tinit: function(params) {\r\n\t\t\t\tif(!params.node) return ;\r\n\t\t\t\tvar scrollObj = new Scroll(params);\r\n\t\t\t\tscrolls.push(scrollObj);\r\n\t\t\t\treturn scrollObj;\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tscrolls.forEach(function(scrollObj) {\r\n\t\t\t\t\tscrollObj.resize();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\t// 数据对象\r\n\t// 这里是对所有进行数据处理的接口进行了归总\r\n\tvar data = {\r\n\t\t// 生成uuid\r\n\t\tget uuid() {\r\n\t\t\treturn Date.now().toString();\r\n\t\t},\r\n\t\t// 对白板数进行缩放\r\n\t\t// 主要应对白板的缩放后的重绘及从一个白板传递到另一个白板的数据\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 数据深拷贝\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tvar val = arg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\tfirstArg.push(container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tvar val = firstArg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 将白板数据生成图片数据\r\n\t\t// 此接口应对的是用户在白板上多次操作产生很多数据，由于数据是存储在storage中，数据量不宜过多，所以会在操作过程中把适量的数据生成图片数据进行存储\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(),\r\n\t\t\t\t\tpage = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) {\r\n\t\t\t\t\t_data_.pageNumber = page.getPageNumber();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 清除文本头尾的空格\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\t// 数据分页\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\t// 对页码进行排序\r\n\t\t\tkeys.sort(function(a, b) {\r\n\t\t\t\treturn a-b;\r\n\t\t\t});\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\t// 向白板绘制pen模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制rect模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制line模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制round模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制text模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.font = params.size + \"px sans-serif\";\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制image模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:(\"file\"===params.type?self.fileCanvas:self.mainCanvas)),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tcWidth = params.width,\r\n\t\t\t\tcHeight = params.height,\r\n\t\t\t\timg = self.tplImage,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.src = data[0];\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tvar imgWidth = img.width, imgHeight = img.height;\r\n\r\n\t\t\t\tif(\"file\"===params.type && 0!=params.status && !isCreateImage) {\r\n\t\t\t\t\tcWidth = self.params.width;\r\n\t\t\t\t\tcHeight = self.params.height;\r\n\t\t\t\t\tself.tab.resizePad(cWidth, cHeight);\r\n\t\t\t\t\tself.tab.resizePadPixel(cWidth, cHeight);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(\"file\"===params.type) {\r\n\t\t\t\t\tvar imgScale = imgWidth/imgHeight,\r\n\t\t\t\t\t\tpWidth = imgWidth,\r\n\t\t\t\t\t\tpHeight = imgHeight;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif(cHeight>cWidth/imgScale) {\r\n\t\t\t\t\t\tpHeight = (imgHeight + imgHeight*(cHeight/cWidth - imgHeight/imgWidth))>>0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcHeight = (cWidth/(imgWidth/imgHeight))>>0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.tab.resizePad(cWidth, cHeight);\r\n\t\t\t\t\tself.tab.resizePadPixel(pWidth, pHeight);\r\n\t\t\t\t\tctx.drawImage(img, (pWidth-imgWidth)/2, (pHeight-imgHeight)/2, imgWidth, imgHeight);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar pw = canvas.width,\r\n\t\t\t\t\t\tph = canvas.height,\r\n\t\t\t\t\t\twScale = pw/cWidth,\r\n\t\t\t\t\t\thScale = ph/cHeight,\r\n\t\t\t\t\t\tsImgWidth = imgWidth*wScale,\r\n\t\t\t\t\t\tsImgHeight = imgHeight*hScale,\r\n\t\t\t\t\t\tdw = pw - sImgWidth, \r\n\t\t\t\t\t\tdh = ph - sImgHeight;\r\n\r\n\t\t\t\t\tif(dw>=0 && dh>=0) {\r\n\t\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\t\tctx.drawImage(img, x, y, sImgWidth, sImgHeight);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar cwhp = pw/ph, iwhp = img.width/img.height;\r\n\r\n\t\t\t\t\t\tif(cwhp>iwhp) {\r\n\t\t\t\t\t\t\tctx.drawImage(img, (pw-ph*iwhp)/2, 0, ph*iwhp, ph);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tctx.drawImage(img, 0, (ph-pw/iwhp)/2, pw, pw/iwhp);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 向白板绘制eraser模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tdata.forEach(function(data) {\r\n\t\t\t\tif(0===params.mode) {\r\n\t\t\t\t\tvar sin = data.size/2*Math.sin(Math.atan((data.y - data.ey)/(data.x - data.ex))) || 0,\r\n\t\t\t\t    \tcos = data.size/2*Math.cos(Math.atan((data.y - data.ey)/(data.x - data.ex))) || 0;\r\n\r\n\t\t\t\t    var x1 = data.ex + sin;\r\n\t\t\t\t    var y1 = data.ey - cos;\r\n\t\t\t\t    var x2 = data.ex - sin;\r\n\t\t\t\t    var y2 = data.ey + cos;\r\n\t\t\t\t    var x3 = data.x + sin;\r\n\t\t\t\t    var y3 = data.y - cos;\r\n\t\t\t\t    var x4 = data.x - sin;\r\n\t\t\t\t    var y4 = data.y + cos;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.arc(data.x, data.y, data.size/2, 0, 2*Math.PI);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar x1 = data.ex - data.size/2;\r\n\t\t\t\t    var y1 = data.ey - data.size/2;\r\n\t\t\t\t    var x2 = data.ex - data.size/2;\r\n\t\t\t\t    var y2 = data.ey + data.size/2;\r\n\t\t\t\t    var x3 = data.x + data.size/2;\r\n\t\t\t\t    var y3 = data.y - data.size/2;\r\n\t\t\t\t    var x4 = data.x - data.size/2;\r\n\t\t\t\t    var y4 = data.y + data.size/2;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.rect(x1, y1, data.size, data.size);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(wScale, hScale);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x1, y1);\r\n\t        \tctx.lineTo(x2, y2);\r\n\t        \tctx.lineTo(x3, y3);\r\n\t        \tctx.lineTo(x4, y4);\r\n\t        \tctx.closePath();\r\n\t        \tctx.clip()\r\n\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t        \tctx.restore();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 总的绘制接口\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\t// 根据type调用相对应功能的render接口\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 鼠标的绘制对象\r\n\tvar mouse = {\r\n\t\t// 橡皮擦\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 教鞭\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\t// 总的render接口\r\n\t\t// 根据type调用mouse[type]\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\t// 白板的tab模块\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\" title=\"@LABEL@\">@LABEL@@DELETEBTN@</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\t// 创建的所有tab生成的map,key是tab的唯一标识\r\n\t\t\t\tdataMap = {},\t// 所有tab对应的数据生成的map,key是tab的唯一标识\r\n\t\t\t\tcanvasMap = {},\t// 所有tab对应的画面生成的map,key是tab的唯一标识\r\n\t\t\t\tactiveObj = {},\t// 目前被激活的画布,数据,tab生成的对象\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, type, _data, _tab, from) {\r\n\t\t\t\tif(!canvas) return ;\r\n\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\tdel = from == that.params.id,\r\n\t\t\t\t\t_id = _tab && _tab.id?_tab.id:(0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/@LABEL@/g, _tab && _tab.name?_tab.name:tabNameMap[type]).replace(/@DELETEBTN@/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(true===that.params.disable || this===activeObj.tab) return ;\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tfrom: from\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(_tab && _tab.name) that.container[_id].tabName = _tab.name;\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\t\t\t\tdelete pageMap[_id];\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\r\n\t\t\t\tif(activeObj.id==_id) {\r\n\t\t\t\t\t_id = idList[Math.max(index-1, 0)];\r\n\t\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id) {\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\t\t\t\tself.tab.resizePad();\r\n\t\t\t\tself.tab.resizePadPixel();\r\n\t\t\t\tself.scroll.toOrigin();\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.container[_id].type != activeObj.type) {\r\n\t\t\t\t\tele.css(activeObj.canvas || self.mainCanvas, \"background\");\r\n\t\t\t\t\tele.css(canvasMap[_id], \"background\", self.params.background);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(params) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.clear.call(self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(self.params.onClear) && self.params.onClear({tabId: activeObj.id});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar id = params.tabId;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].clear.call(self, params);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(dataMap[id]) dataMap[id].length = 0;\r\n\t\t\t\t\t\tif(canvasMap[id]) canvasMap[id].width = canvasMap[id].width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.cleanCache = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\t!self.params.noCache && window.localStorage.removeItem(self.id+\"_pad\");\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.render = function(_data, callback) {\r\n\t\t\t\tvar that = this;\r\n\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {};\r\n\r\n\t\t\t\t\t\tobj[activeObj.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeObj.type,\r\n\t\t\t\t\t\t\tsplitPage: activeObj.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tcallback(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_data.status && that.tab.push.call(that, activeObj.id, _data);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4.replace(/@TOTAL@/g, total);\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"input\", function() {\r\n\t\t\tif(/^\\s*([0-9]+).*\\s*$/.test(this.value)) {\r\n\t\t\t\tthis.value = RegExp.$1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = currentPage;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"keypress\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = window.event || args[0];\r\n\r\n\t\t\tif(13===e.keyCode || 13===e.which) {\r\n\t\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, callback) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\"[object Function]\" === toString.call(callback) && callback();\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\r\n\t\t\tif(_data.length>1) {\r\n\t\t\t\tpageWrap.appendChild(pageEle);\r\n\r\n\t\t\t\tswitch(that.params.splitpageLayout) {\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\tpageWrap.style.left = \"10px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\tpageWrap.style.left = (pageWrap.parentNode.clientWidth - pageWrap.offsetWidth)/2 + \"px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tpageWrap.style.right = \"10px\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.tab.getActive().page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: that.mainCanvas.offsetWidth,\r\n\t\t\t\t\theight: that.mainCanvas.offsetHeight,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d, pageNumber) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = void(0)!=pageNumber?pageNumber:currentPage;\r\n\t\t\t_data[d.pageNumber-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[d.pageNumber-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[d.pageNumber-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tvar pageNumber = (params?params.pageNumber:currentPage) || currentPage;\r\n\t\t\t_data[pageNumber-1].length = 1;\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\tif(void(0)===params || (params.tabId==that.tab.getActive().id && params.pageNumber==currentPage)) {\r\n\t\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(that.params.onClear) && that.params.onClear({tabId: that.tab.getActive().id, pageNumber: pageNumber});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data, callback) {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\tpageNumber: currentPage,\r\n\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcallback(obj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_data.status && that.tab.getActive().page.push.call(that, _data);\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\t\tshow && this.show();\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar tplImage = new Image();\r\n\t\ttplImage.setAttribute(\"crossOrigin\", \"anonymous\");\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\ttplImage: tplImage,\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\tactiveTab.page.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthat.tab.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, realData = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tif(!activeTab.page) {\r\n\t\t\t\t\t\tthat.tab.render.call(that, realData);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(activeTab.page.getPageNumber() == val.pageNumber) {\r\n\t\t\t\t\t\t\tactiveTab.page.render.call(that, realData);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trealData.status && activeTab.page.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(realData.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, realData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, 1, [realData], {id: key}, realData.from);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null, scaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, val = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tthat.tab.clear.call(that, params);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.getData = function(tabId) {\r\n\t\t\treturn that.container[tabId] || that.container;\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\tthat.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id==activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)==id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\ttoolbarStr = \"\",\r\n\t\t\tisFullScreen = false,\r\n\t\t\tfullScreenInterface = wrap.requestFullscreen || wrap.webkitRequestFullscreen || wrap.mozRequestFullScreen || wrap.msRequestFullscreen,\r\n\t\t\tcancelFullScreenInterface = document.exitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen;\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/@ITEM@/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@TITLE@/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARS@/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/@ITEM@/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@TITLE@/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@CHILDTOOLBARS@/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARITEM@/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tfalse!=params.fullScreen && (toolbarStr = toolbarStr + tpl5);\r\n\t\tvar __str__ = tpl1.replace(/@LAYOUT@/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\"))\r\n\t\t\t\t\t\t\t.replace(/@TOOLBARS@/g, toolbarStr)\r\n\t\t\t\t\t\t\t.replace(/@DISABLED@/g, params.disable?\"disabled\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTOOLBAR@/g, params.noToolbar?\"no-toolbar\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTAB@/g, params.noTab?\"no-tab\":\"\");\r\n\t\tvar _data = params.data || (!params.noCache?JSON.parse(window.localStorage.getItem(self.id+\"_pad\")):null);\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar canvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0],\r\n\t\t\tfullScreenBtn = toolbarWrap.getElementsByClassName(\"full-screen-btn\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\tvar createSize = function() {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*\\*\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tcanvasWrapWidth = +RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = +RegExp.$2;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*:\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tswitch(true) {\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2>_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapWidth/RegExp.$1*RegExp.$2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2<_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapHeight/RegExp.$2*RegExp.$1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)%\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth/100*RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight/100*RegExp.$1;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tcanvasWrapWidth = canvasWrap.clientWidth;\r\n\t\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\t\t\t}\r\n\r\n\t\t\tparams.width = canvasWrapWidth>>0;\r\n\t\t\tparams.height = canvasWrapHeight>>0;\r\n\t\t};\r\n\r\n\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tif(true!=scrollObj.disable && scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\tvar data = {type: \"y\", distance: (\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY))/10, from: params.id, scale: scrollObj.scrollObj.y.moveHeight/scrollObj.scrollObj.y.coverHeight};\r\n\t\t\t\tscrollObj.scroll(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar oldAvilWidth = canvasWrap.clientWidth, oldAvilHeight = canvasWrap.clientHeight;\r\n\r\n\t\tele.addEvent(window, \"resize\", function() {\r\n\t\t\tvar avilWidth = canvasWrap.clientWidth,\r\n\t\t\t\tavilHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(avilWidth!=oldAvilWidth || avilHeight!=oldAvilHeight) {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tresizePad();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t\toldAvilWidth = avilWidth;\r\n\t\t\t\toldAvilHeight = avilHeight;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar resizePad = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\r\n\t\t\tmainCanvas.style.width = bufferCanvas1.style.width = bufferCanvas2.style.width = bufferCanvas3.style.width = bufferCanvas4.style.width = width + \"px\";\r\n\t\t\tmainCanvas.style.height = bufferCanvas1.style.height = bufferCanvas2.style.height = bufferCanvas3.style.height = bufferCanvas4.style.height = height + \"px\";\r\n\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = 0;\r\n\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = 0;\r\n\r\n\t\t\tif(width<canvasWrap.clientWidth) {\r\n\t\t\t\tvar left = (canvasWrap.clientWidth - width)/2;\r\n\t\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = left + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tif(height<canvasWrap.clientHeight) {\r\n\t\t\t\tvar top = (canvasWrap.clientHeight - height)/2;\r\n\t\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = top + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tscrollObj && scrollObj.resize();\r\n\t\t};\r\n\r\n\t\tvar resizePadPixel = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\r\n\t\t\tmainCanvas.width = bufferCanvas1.width = bufferCanvas2.width = bufferCanvas3.width = bufferCanvas4.width = width;\r\n\t\t\tmainCanvas.height = bufferCanvas1.height = bufferCanvas2.height = bufferCanvas3.height = bufferCanvas4.height = height;\r\n\t\t};\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tself.mainCanvas = mainCanvas;\r\n\t\tcreateSize();\r\n\t\tresizePad();\r\n\t\tresizePadPixel();\r\n\r\n\t\tvar scrollObj = scroll.init({\r\n\t\t\tnode: canvasWrap,\r\n\t\t\tid: params.id\r\n\t\t});\r\n\r\n\t\tscrollObj.disable = params.disable;\r\n\t\tself.scroll = scrollObj;\r\n\r\n\t\tscrollObj.addEvent(\"scroll\", function(data) {\r\n\t\t\t\"[object Function]\"===toString.call(params.onScroll) && params.onScroll(data);\r\n\t\t});\r\n\t\t\r\n\t\tObject.defineProperty(self.tab, \"resizePad\", {\r\n\t\t\tvalue: resizePad\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(self.tab, \"resizePadPixel\", {\r\n\t\t\tvalue: resizePadPixel\r\n\t\t});\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tvar fullScreen = function(flag) {\r\n\t\t\tif(!isMobile) {\r\n\t\t\t\tflag?fullScreenInterface.call(wrap.getElementsByClassName(\"pad-wrap\")[0]):cancelFullScreenInterface.call(document);\r\n\t\t\t}else {\t\t\t\t\r\n\t\t\t\tflag?ele.addClass(wrap, \"pad-full-screen\"):ele.removeClass(wrap, \"pad-full-screen\");\r\n\t\t\t}\r\n\r\n\t\t\tisFullScreen = flag;\r\n\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t\tresizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tvar exportImage = function() {\r\n\t\t\tvar uuid = data.uuid,\r\n\t\t\t\tdownloadEle = document.createElement(\"A\"),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas,\r\n\t\t\t\tctx = createImageCanvas.getContext(\"2d\");\r\n\r\n\t\t\tctx.drawImage(self.fileCanvas, 0, 0);\r\n\t\t\tctx.drawImage(self.mainCanvas, 0, 0);\r\n\r\n\t\t\tvar\timage = createImageCanvas.toDataURL(),\r\n\t\t\t\timageDataArr = image.split(\",\"),\r\n\t\t\t\tbStr = atob(imageDataArr[1]),\r\n\t\t\t\tlen = bStr.length,\r\n\t\t\t\ttArr = new Uint8ClampedArray(len);\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\ttArr[len] = bStr.charCodeAt(len);\r\n\t\t\t}\r\n\r\n\t\t\tvar url = URL.createObjectURL(new Blob([tArr], {mime: \"image/octet-stream;Content-Disposition:attachment\"}));\r\n\t\t\tdownloadEle.href = url;\r\n\t\t\tdownloadEle.download = uuid + \".png\";\r\n\t\t\tdownloadEle.click();\r\n\t\t\tURL.revokeObjectURL(url);\r\n\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\t\t};\r\n\r\n\t\tself.pad.resize = function(w, h) {\r\n\t\t\t!isNaN(w) && !isNaN(h) && resizePad(w, h);\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tself.pad.scroll = function(data) {\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t};\r\n\r\n\t\tself.pad.fullScreen = function() {\r\n\t\t\tif(isFullScreen) return ;\r\n\t\t\tfullScreen(true);\r\n\t\t};\r\n\r\n\t\tself.pad.exitFullScreen = function() {\r\n\t\t\tif(!isFullScreen) return ;\r\n\t\t\tfullScreen(false);\r\n\t\t};\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = void(0)!=params.from?params.from:self.params.id,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\twidth: params.width,\r\n\t\t\t\t\theight: params.height,\r\n\t\t\t\t\tfrom: from,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\r\n\t\t\t\tif(self.params.id==from && \"[object Function]\"===toString.call(self.params.onShowFiles)) {\r\n\t\t\t\t\tparams.from = from;\r\n\t\t\t\t\tself.params.onShowFiles(params);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar _tab = {id: tabId, name: tabName};\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, 1, null, _tab, from);\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tfrom == self.params.id && self.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tself.pad.clear();\r\n\t\t\t\t_showFiles();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"input\", function() {\r\n\t\t\tthis.style.width = this.scrollWidth + \"px\";\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), \r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\t\t\tcurrent && current.destory.call(self);\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\texportImage();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"fullScreen\":\r\n\t\t\t\tfullScreen(!isFullScreen);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tparentSpan.setAttribute(\"item\", item);\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar mouseX = 0, mouseY = 0;\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\tif(isMobile && e.targetTouches.length>1) return ;\r\n\r\n\t\t\tvar rect = this.getBoundingClientRect(),\r\n\t\t\t\tposX = isMobile?e.targetTouches[0].clientX:e.clientX,\r\n\t\t\t\tposY = isMobile?e.targetTouches[0].clientY:e.clientY,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: posX - (rect.x || rect.left),\r\n\t\t\t\t\ty: posY - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(!current) {\r\n\t\t\t\tif(active) {\r\n\t\t\t\t\tif(true===scrollObj.disable) return ;\r\n\t\t\t\t\tvar moveX = mouseX - posX, moveY = mouseY - posY;\r\n\r\n\t\t\t\t\tif(isMobile) {\r\n\t\t\t\t\t\tmoveX /= 10;\r\n\t\t\t\t\t\tmoveY /= 10;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.x.coverWidth>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({type: \"x\", distance: moveX, from: params.id, scale: scrollObj.scrollObj.x.moveWidth/scrollObj.scrollObj.x.coverWidth});\r\n\t\t\t\t\t\tmouseX = posX;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({type: \"y\", distance: moveY, from: params.id, scale: scrollObj.scrollObj.y.moveHeight/scrollObj.scrollObj.y.coverHeight});\r\n\t\t\t\t\t\tmouseY = posY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar item = current.name.toLowerCase();\r\n\r\n\t\t\t\tif(handPad || active) {\r\n\t\t\t\t\tswitch(item) {\r\n\t\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tmouseX = isMobile?e.targetTouches[0].clientX:e.clientX;\r\n\t\t\tmouseY = isMobile?e.targetTouches[0].clientY:e.clientY;\r\n\t\t\tactive = true;\r\n\t\t\tif(!current) return ;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent.bufferRender && current.bufferRender.call(self, pos, true);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, 0);\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tObject.keys(_data).sort(function(a, b) {return a-b}).forEach(function(key) {\r\n\t\t\t\tvar val = _data[key];\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, val.type, val.data, {id: key, name: val.tabName}, val.from);\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0 === val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\t_params.id = void(0)==_params.id?data.uuid:_params.id;\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: line.js\r\n * describe: 线性\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\t//直线\r\n\t\tarrow: 1\t//箭头\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: pen.js\r\n * describe: 笔\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: rectangle.js\r\n * describe: 矩形\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\t//空心矩形\r\n\t\trect: 1\t//实心矩形\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: round.js\r\n * describe: 圆\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\t//空心圆\r\n\t\troundel: 1,\t//实心圆\r\n\t\tellipesstroke: 2,\t//空心椭圆\r\n\t\tellipes: 3\t//实心椭圆\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: text.js\r\n * describe: 文本\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; font-size: \" + self.params.fontSize + \"; left: \" + (data.x + self.mainCanvas.offsetLeft) + \"px; top: \" + (data.y + self.mainCanvas.offsetTop -self.textInput.offsetHeight/2 - 18) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, size: self.params.fontSize, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this, content = self.textInput.value.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(content) self.current.render.call(self, content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}