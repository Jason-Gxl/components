{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","js/eraser.js","js/ferula.js","js/image.js","js/index.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modeMap","circular","quadrate","pos","lastPoint","Eraser","params","this","name","interimBuffer","buffer","prototype","constructor","active","mouseRender","data","self","type","x","y","eraserSize","mode","current","from","id","width","mainCanvas","height","largen","cw","clientWidth","ch","clientHeight","Math","min","apply","lesser","max","bufferRender","_data","origin","status","ex","ey","size","push","render","destory","vm","window","eraser","Ferula","ferula","Image","renderBuffer","toolbarMap","image","shift","concat","toString","Object","URL","webkitURL","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","eventMap","click","down","move","up","wheel","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","noCache","noToolbar","layout","fontSize","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","ferulaSize","toolbars","childToolbars","rectangle","line","round","titles","circle","roundel","ellipesstroke","rectstroke","pen","rect","ellipes","text","arrow","export","scissors","clear","classes","tabNameMap","0","tpl1","tpl2","tpl3","tpl5","addEventListener","target","fn","use","delEvent","detachEvent","addClass","ele","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextNode","css","attrName","attrValue","scroll","scrolls","createElement","xTpl","Scroll","activeType","node","parentNode","events","scrollObj","scrollBuilder","tplDiv","innerHTML","yTpl","removeChild","firstChild","appendChild","toolbar","getElementsByClassName","scrollHeight","classList","remove","defineProperty","set","d","get","mousemoveHandler","obj","args","event","clientX","distance","startPoint","scale","moveWidth","coverWidth","clientY","moveHeight","coverHeight","mouseupHandler","addEvent","slice","arguments","param","container","offsetLeft","style","left","offsetWidth","scrollLeft","offsetTop","top","offsetHeight","scrollTop","fire","resize","scrollWidth","add","eventName","splice","indexOf","forEach","create","uuid","val","scaleWidth","scaleHeight","isNaN","firstArg","arg","_type","key","copy","item","index","saveAsImage","count","arr","file","len","activeTab","tab","getActive","next","list","imgData","createImageCanvas","toDataURL","_data_","page","pageNumber","getPageNumber","saveData","_createImage","pop","content","splitPage","keys","sort","renderPen","callback","isCreateImage","canvas","bufferCanvas","wScale","hScale","ctx","getContext","strokeStyle","lineWidth","point","beginPath","lineTo","stroke","restore","renderRect","strokeRect","fillStyle","fillRect","moveTo","angle","atan2","PI","angle1","topx","cos","topy","sin","botx","angle2","boty","save","arc","fill","scaleX","scaleY","closePath","font","fillText","fileCanvas","img","tplImage","src","onload","resizePad","dw","sImgWidth","dh","original","sImgHeight","drawImage","cwhp","iwhp","delete","atan","x1","y1","x2","y2","x3","y3","x4","y4","clip","clearRect","renderLine","renderRound","renderText","renderImage","mouseIconCanvas","px","py","mouse","Tab","canvasMap","build","_tab","that","_tabTpl","tabTpl","del","delTpl","UL","_id","li","firstElementChild","tabMap","getElementsByTagName","cancelBubble","preventDefault","onTabRemove","activeObj","onTabChange","tabWrap","dataMap","tabName","saving","it","setTimeout","pageMap","getData","clearTimeout","idList","localStorage","setItem","JSON","stringify","removeClass","toOrigin","show","getTab","tabId","cleanCache","removeItem","getPage","outData","Page","currentPage","pageEle","div","prePageBtn","pre","total","goPageBtn","pageNumberInput","value","go","onPageTurn","$1","keyCode","which","start","__data","some","flag","nextPageBtn","pageWrap","splitpageLayout","right","hide","empower","removeAttribute","setAttribute","WPad","waitList","onRender","onMousemove","fr","FileReader","isFullScreen","exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","colorInput","bufferCanvas4","_toolbar","_childToolbars","_tpl2","childToolbarStr","toolbarStr","fullScreen","__str__","noTab","parse","getItem","canvasWrap","toolbarWrap","createSize","canvasWrapWidth","canvasWrapHeight","$2","_canvasWrapWidth","_canvasWrapHeight","returnValue","detail","oldAvilWidth","oldAvilHeight","avilWidth","avilHeight","w","h","bufferCanvas1","bufferCanvas2","bufferCanvas3","textInput","onScroll","fullScreenBtn","pad","exitFullScreen","showFiles","files","newTab","isShow","_showFiles","pageObj","onShowFiles","result","fileInput","readAsDataURL","trim","shiftKey","span","srcElement","level","getAttribute","handPad","downloadEle","imageDataArr","split","bStr","atob","tArr","Uint8ClampedArray","charCodeAt","href","url","download","revokeObjectURL","exportImage","curActiveNode","lastSpan","curActiveChildNode","parentSpan","preNode","title","match","stopPropagation","mouseX","mouseY","targetTouches","getBoundingClientRect","posY","toLowerCase","moveX","posX","moveY","_n","setPage","realData","renderAll","dataArr","renderMouse","console","error","enable","createImage","turnPage","number","removeTab","wPad","init","_params","getPadById","getPadByIndex","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","xc","yc","originY","abs","9","Text","cssText","focus"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: eraser.js\r\n * describe: 橡皮擦\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null,\r\n\t\tlastPoint = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\t// 存储临时数据\r\n\t\tthis.interimBuffer = [];\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\t// 橡皮擦放大接口\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 橡皮擦缩小接口\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// 橡皮擦功能较为特殊，直接绘制到持久画板上\r\n\t\t// status = 1\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = {type: \"eraser\", data: [], status: 1, origin: true, mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\t\r\n\t\t\tif(!origin && lastPoint) {\r\n\t\t\t\t_data.ex = lastPoint.x;\r\n\t\t\t\t_data.ey = lastPoint.y;\r\n\t\t\t} else {\r\n\t\t\t\t_data.ex = _data.x;\r\n\t\t\t\t_data.ey = _data.y;\r\n\t\t\t}\r\n\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.render(data);\r\n\t\t\tlastPoint = _data;\r\n\t\t},\r\n\t\t// 舍弃\r\n\t\trender: function() {\r\n\t\t\treturn ;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: ferula.js\r\n * describe: 教鞭\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: image.js\r\n * describe: 演示图片\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tURL = window.URL || window.webkitURL,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\t// 事件名map，PC端和移动端需要对应不同的事件名\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mousemove\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\"\r\n\t\t},\r\n\t\t// 工具栏不同的布局对应的className\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\t// 默认的白板初始化参数\r\n\t\t// ferula, ellipesstroke, rectstroke, pen, eraser, rect, ellipes, text, line, arrow, color, export, scissors, clear, enlarge, file, handPad\r\n\t\tdefaultConfig = {\r\n\t\t\tdata: null,\r\n\t\t\tnoCache: false,\r\n\t\t\tnoToolbar: false,\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tfontSize: 16,\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\t// 不同工具对应的名称\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\t// 不同工具对应的icon的className\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\t// 白板tab的默认名称\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n// ==============================================================模板===============================================================\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap @LAYOUT@ @DISABLED@ @NOTOOLBAR@ @NOTAB@\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">@TOOLBARS@</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"@TITLE@\"><span class=\"item-icon iconfont @ICONCLASS@\" item=\"@ITEM@\" level=\"@LEVEL@\"></span>@CHILDTOOLBARS@</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">@CHILDTOOLBARITEM@</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn iconfont icon-zuofanye\"></a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn iconfont icon-youfanye\"></a>\\\r\n\t\t\t<span><input type=\"text\" class=\"page-number-input\"/>/@TOTAL@<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl5 = '<li class=\"toolbar-item full-screen-btn-wrap\"><span class=\"item-icon full-screen-btn iconfont icon-enlarge\" item=\"fullScreen\"></span></li>';\r\n// ==============================================================模板===============================================================\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\t// 这里创建一个ele对象，此对象下都是对dom节点进行操作的接口\r\n\t// 目地是方便后面的调用\r\n\tvar ele = {\r\n\t\t// 对dom节点绑定事件\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 移除dom节点上的事件\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 为dom节点添加一个指定的类名\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 移除dom节点上指定的类名\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取指定dom节点的前一个节点\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\t// 获取指定dom节点的下一个节点\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\t// 为dom节点添加样式\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\t// 滚动条模块\r\n\t// 如果创建白板时，为白板指定了固定大小，且白板大小大于当前放置白板的容器时会创建滚动条\r\n\tvar scroll = (function() {\r\n\t\tvar scrolls = [],\r\n\t\t\ttplDiv = document.createElement(\"DIV\"),\r\n\t\t\txTpl = '<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>',\r\n\t\t\tyTpl = '<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>';\r\n\r\n\t\tfunction Scroll(params) {\r\n\t\t\tif(!(this instanceof Scroll)) {\r\n\t\t\t\treturn new Scroll(params);\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdisable = false,\r\n\t\t\t\tactiveType = \"x\",\r\n\t\t\t\tstartPoint = {x: 0, y: 0},\r\n\t\t\t\tparentNode = params.node.parentNode;\r\n\r\n\t\t\tself.params = params;\r\n\t\t\tself.events = {};\r\n\t\t\tself.scrollObj = {};\r\n\r\n\t\t\tvar scrollBuilder = function(type) {\r\n\t\t\t\ttplDiv.innerHTML = \"x\"===type?xTpl:yTpl;\r\n\t\t\t\tvar ele = tplDiv.removeChild(tplDiv.firstChild);\r\n\t\t\t\tparentNode.appendChild(ele);\r\n\r\n\t\t\t\tself.scrollObj[type] = {\r\n\t\t\t\t\tcontainer: ele,\r\n\t\t\t\t\ttoolbar: ele.getElementsByClassName(\"scroll-toolbar\")[0]\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\tparams.node.clientWidth<params.node.scrollWidth && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.node.clientHeight<params.node.scrollHeight && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tObject.defineProperty(this, \"disable\", {\r\n\t\t\t\tset: function(d) {\r\n\t\t\t\t\tdisable = d;\r\n\t\t\t\t},\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn disable;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif(!params.type) {\r\n\t\t\t\tscrollBuilder(\"x\");\r\n\t\t\t\tscrollBuilder(\"y\");\r\n\t\t\t} else {\r\n\t\t\t\tscrollBuilder(params.type);\r\n\t\t\t}\r\n\r\n\t\t\tvar mousemoveHandler = function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\tobj = self.scrollObj[activeType],\r\n\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\tif(\"x\"===activeType) {\r\n\t\t\t\t\tvar x = e.x || e.clientX, data = {type: \"x\", distance: x-startPoint.x, from: params.id, scale: obj.moveWidth/obj.coverWidth};\r\n\t\t\t\t\tstartPoint.x = x;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar y = e.y || e.clientY, data = {type: \"y\", distance: y-startPoint.y, from: params.id, scale: obj.moveHeight/obj.coverHeight};\r\n\t\t\t\t\tstartPoint.y = y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.scroll(data);\r\n\t\t\t};\r\n\r\n\t\t\tvar mouseupHandler = function() {\r\n\t\t\t\tele.delEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\tele.delEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t};\r\n\r\n\t\t\tif(self.scrollObj.x) {\r\n\t\t\t\tele.addEvent(self.scrollObj.x.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.x = e.x || e.clientX;\r\n\t\t\t\t\tactiveType = \"x\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(self.scrollObj.y) {\r\n\t\t\t\tele.addEvent(self.scrollObj.y.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.y = e.y || e.clientY;\r\n\t\t\t\t\tactiveType = \"y\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tScroll.prototype = {\r\n\t\t\tconstructor: Scroll,\r\n\t\t\tscroll: function(param) {\r\n\t\t\t\tvar params = this.params,\r\n\t\t\t\t\tobj = this.scrollObj[param.type],\r\n\t\t\t\t\tcontainer = obj.container,\r\n\t\t\t\t\ttoolbar = obj.toolbar;\r\n\r\n\t\t\t\tif(\"x\"===param.type) {\r\n\t\t\t\t\tvar offsetLeft = toolbar.offsetLeft + param.distance;\r\n\t\t\t\t\ttoolbar.style.left = Math.max(0, Math.min(offsetLeft, container.clientWidth - toolbar.offsetWidth)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollLeft = params.node.scrollLeft + (param.distance/(obj.moveWidth/obj.coverWidth))/((obj.moveWidth/obj.coverWidth)/param.scale);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar offsetTop = toolbar.offsetTop + param.distance;\r\n\t\t\t\t\ttoolbar.style.top = Math.max(0, Math.min(offsetTop, container.clientHeight - toolbar.offsetHeight)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollTop = params.node.scrollTop + (param.distance/(obj.moveHeight/obj.coverHeight))/((obj.moveHeight/obj.coverHeight)/param.scale);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(void(0)==this.params.id || param.from===this.params.id) {\r\n\t\t\t\t\tthis.fire(\"scroll\", param);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttoOrigin: function(type) {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(!type) {\r\n\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(this.scrollObj.x) {\r\n\t\t\t\t\tvar obj = this.scrollObj.x,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverWidth = params.node.scrollWidth - params.node.clientWidth;\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoolbar.style.width = Math.max(obj.container.clientWidth - coverWidth/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverWidth = coverWidth;\r\n\t\t\t\t\tobj.moveWidth = obj.container.clientWidth - toolbar.offsetWidth;\r\n\r\n\t\t\t\t\tif(0===obj.moveWidth) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.scrollObj.y) {\r\n\t\t\t\t\tvar obj = this.scrollObj.y,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverHeight = params.node.scrollHeight - params.node.clientHeight;\r\n\r\n\t\t\t\t\ttoolbar.style.height = Math.max(obj.container.clientHeight - coverHeight/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverHeight = coverHeight;\r\n\t\t\t\t\tobj.moveHeight = obj.container.clientHeight - toolbar.offsetHeight;\r\n\r\n\t\t\t\t\tif(0===obj.moveHeight) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(!events[eventName]) {\r\n\t\t\t\t\tevents[eventName] = [fn];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[eventName].push(fn);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(\"[object Function]\"===toString.call(fn)) {\r\n\t\t\t\t\tevents[eventName].splice(events[eventName].indexOf(fn), 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete events[eventName];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfire: function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\teventName = args.shift(),\r\n\t\t\t\t\tevents = this.events;\r\n\r\n\t\t\t\tevents[eventName] && events[eventName].forEach(function(fn) {\r\n\t\t\t\t\t\"[object Function]\"===toString.call(fn) && fn.apply(Object.create(null), args);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tinit: function(params) {\r\n\t\t\t\tif(!params.node) return ;\r\n\t\t\t\tvar scrollObj = new Scroll(params);\r\n\t\t\t\tscrolls.push(scrollObj);\r\n\t\t\t\treturn scrollObj;\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tscrolls.forEach(function(scrollObj) {\r\n\t\t\t\t\tscrollObj.resize();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\t// 数据对象\r\n\t// 这里是对所有进行数据处理的接口进行了归总\r\n\tvar data = {\r\n\t\t// 生成uuid\r\n\t\tget uuid() {\r\n\t\t\treturn Date.now();\r\n\t\t},\r\n\t\t// 对白板数进行缩放\r\n\t\t// 主要应对白板的缩放后的重绘及从一个白板传递到另一个白板的数据\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 数据深拷贝\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tvar val = arg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\tfirstArg.push(container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tvar val = firstArg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 将白板数据生成图片数据\r\n\t\t// 此接口应对的是用户在白板上多次操作产生很多数据，由于数据是存储在storage中，数据量不宜过多，所以会在操作过程中把适量的数据生成图片数据进行存储\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(),\r\n\t\t\t\t\tpage = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) {\r\n\t\t\t\t\t_data_.pageNumber = page.getPageNumber();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 清除文本头尾的空格\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\t// 数据分页\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\t// 对页码进行排序\r\n\t\t\tkeys.sort();\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\t// 向白板绘制pen模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制rect模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制line模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制round模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制text模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.font = params.size + \"px sans-serif\";\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制image模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:(\"file\"===params.type?self.fileCanvas:self.mainCanvas)),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\timg = self.tplImage,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.src = data[0];\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tif(!isCreateImage && 0!=params.status && \"file\"===params.type) self.tab.resizePad(self.params.width, self.params.height);\r\n\r\n\t\t\t\tvar cw = canvas.width, \r\n\t\t\t\t\tch = canvas.height,\r\n\t\t\t\t\twScale = cw/params.width,\r\n\t\t\t\t\thScale = ch/params.height,\r\n\t\t\t\t\timgWidth = img.width,\r\n\t\t\t\t\timgHeight = img.height,\r\n\t\t\t\t\tsImgWidth = imgWidth*wScale,\r\n\t\t\t\t\tsImgHeight = imgHeight*hScale,\r\n\t\t\t\t\tdw = cw - sImgWidth, \r\n\t\t\t\t\tdh = ch - sImgHeight;\r\n\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(dw>=0 && dh>=0) {\r\n\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\tctx.drawImage(img, x, y, sImgWidth, sImgHeight);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!params.original) {\r\n\t\t\t\t\t\tvar cwhp = cw/ch, iwhp = img.width/img.height;\r\n\r\n\t\t\t\t\t\tif(cwhp>iwhp) {\r\n\t\t\t\t\t\t\tctx.drawImage(img, (cw-ch*iwhp)/2, 0, ch*iwhp, ch);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tctx.drawImage(img, 0, (ch-cw/iwhp)/2, cw, cw/iwhp);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcw = dw>=0?self.params.width:sImgWidth;\r\n\t\t\t\t\t\tch = dh>=0?self.params.height:sImgHeight;\r\n\t\t\t\t\t\tdw = cw - sImgWidth;\r\n\t\t\t\t\t\tdh = ch - sImgHeight;\r\n\t\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\t\tself.tab.resizePad(cw, ch);\r\n\t\t\t\t\t\tctx.drawImage(img, x, y, sImgWidth, sImgHeight);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 向白板绘制eraser模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tdata.forEach(function(data) {\r\n\t\t\t\tif(0===params.mode) {\r\n\t\t\t\t\tvar sin = data.size/2*Math.sin(Math.atan((data.y - data.ey)/(data.x - data.ex))),\r\n\t\t\t\t    \tcos = data.size/2*Math.cos(Math.atan((data.y - data.ey)/(data.x - data.ex)));\r\n\r\n\t\t\t\t    var x1 = data.ex + sin;\r\n\t\t\t\t    var y1 = data.ey - cos;\r\n\t\t\t\t    var x2 = data.ex - sin;\r\n\t\t\t\t    var y2 = data.ey + cos;\r\n\t\t\t\t    var x3 = data.x + sin;\r\n\t\t\t\t    var y3 = data.y - cos;\r\n\t\t\t\t    var x4 = data.x - sin;\r\n\t\t\t\t    var y4 = data.y + cos;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.arc(data.x, data.y, data.size/2, 0, 2*Math.PI);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar x1 = data.ex - data.size/2;\r\n\t\t\t\t    var y1 = data.ey - data.size/2;\r\n\t\t\t\t    var x2 = data.ex - data.size/2;\r\n\t\t\t\t    var y2 = data.ey + data.size/2;\r\n\t\t\t\t    var x3 = data.x + data.size/2;\r\n\t\t\t\t    var y3 = data.y - data.size/2;\r\n\t\t\t\t    var x4 = data.x - data.size/2;\r\n\t\t\t\t    var y4 = data.y + data.size/2;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.rect(x1, y1, data.size, data.size);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(wScale, hScale);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x1, y1);\r\n\t        \tctx.lineTo(x2, y2);\r\n\t        \tctx.lineTo(x3, y3);\r\n\t        \tctx.lineTo(x4, y4);\r\n\t        \tctx.closePath();\r\n\t        \tctx.clip()\r\n\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t        \tctx.restore();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 总的绘制接口\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\t// 根据type调用相对应功能的render接口\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 鼠标的绘制对象\r\n\tvar mouse = {\r\n\t\t// 橡皮擦\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 教鞭\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\t// 总的render接口\r\n\t\t// 根据type调用mouse[type]\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\t// 白板的tab模块\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\" title=\"@LABEL@\">@LABEL@@DELETEBTN@</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\t// 创建的所有tab生成的map,key是tab的唯一标识\r\n\t\t\t\tdataMap = {},\t// 所有tab对应的数据生成的map,key是tab的唯一标识\r\n\t\t\t\tcanvasMap = {},\t// 所有tab对应的画面生成的map,key是tab的唯一标识\r\n\t\t\t\tactiveObj = {},\t// 目前被激活的画布,数据,tab生成的对象\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, type, _data, _tab, from) {\r\n\t\t\t\tif(!canvas) return ;\r\n\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\tdel = from === that.params.id,\r\n\t\t\t\t\t_id = _tab && _tab.id?_tab.id:(0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/@LABEL@/g, _tab && _tab.name?_tab.name:tabNameMap[type]).replace(/@DELETEBTN@/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(true===that.params.disable || this===activeObj.tab) return ;\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tfrom: from\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(_tab && _tab.name) that.container[_id].tabName = _tab.name;\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\t\t\t\tdelete pageMap[_id];\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\r\n\t\t\t\tif(activeObj.id===_id) {\r\n\t\t\t\t\t_id = idList[Math.max(index-1, 0)];\r\n\t\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id) {\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\t\t\t\tself.tab.resizePad();\r\n\t\t\t\tself.scroll.toOrigin();\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.container[_id].type != activeObj.type) {\r\n\t\t\t\t\tele.css(activeObj.canvas || self.mainCanvas, \"background\");\r\n\t\t\t\t\tele.css(canvasMap[_id], \"background\", self.params.background);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(params) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.clear.call(self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(self.params.onClear) && self.params.onClear({tabId: activeObj.id});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar id = params.tabId;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].clear.call(self, params);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(dataMap[id]) dataMap[id].length = 0;\r\n\t\t\t\t\t\tif(canvasMap[id]) canvasMap[id].width = canvasMap[id].width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.cleanCache = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\t!self.params.noCache && window.localStorage.removeItem(self.id+\"_pad\");\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.render = function(_data, callback) {\r\n\t\t\t\tvar that = this;\r\n\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {};\r\n\r\n\t\t\t\t\t\tobj[activeObj.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeObj.type,\r\n\t\t\t\t\t\t\tsplitPage: activeObj.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tcallback(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_data.status && that.tab.push.call(that, activeObj.id, _data);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4.replace(/@TOTAL@/g, total);\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"input\", function() {\r\n\t\t\tif(/^\\s*([0-9]+).*\\s*$/.test(this.value)) {\r\n\t\t\t\tthis.value = RegExp.$1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = currentPage;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"keypress\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = window.event || args[0];\r\n\r\n\t\t\tif(13===e.keyCode || 13===e.which) {\r\n\t\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, callback) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\"[object Function]\" === toString.call(callback) && callback();\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\r\n\t\t\tif(_data.length>1) {\r\n\t\t\t\tpageWrap.appendChild(pageEle);\r\n\r\n\t\t\t\tswitch(that.params.splitpageLayout) {\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\tpageWrap.style.left = \"10px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\tpageWrap.style.left = (pageWrap.parentNode.clientWidth - pageWrap.offsetWidth)/2 + \"px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tpageWrap.style.right = \"10px\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.tab.getActive().page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: params.width || that.params.width,\r\n\t\t\t\t\theight: params.height || that.params.height,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from,\r\n\t\t\t\t\toriginal: params.original\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d, pageNumber) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = void(0)!=pageNumber?pageNumber:currentPage;\r\n\t\t\t_data[d.pageNumber-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[d.pageNumber-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[d.pageNumber-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tvar pageNumber = (params?params.pageNumber:currentPage) || currentPage;\r\n\t\t\t_data[pageNumber-1].length = 1;\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\tif(void(0)===params || (params.tabId===that.tab.getActive().id && params.pageNumber===currentPage)) {\r\n\t\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(that.params.onClear) && that.params.onClear({tabId: that.tab.getActive().id, pageNumber: pageNumber});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data, callback) {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\tpageNumber: currentPage,\r\n\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcallback(obj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_data.status && that.tab.getActive().page.push.call(that, _data);\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\t\tshow && this.show();\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar tplImage = new Image();\r\n\t\ttplImage.setAttribute(\"crossOrigin\", \"anonymous\");\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\ttplImage: tplImage,\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\tactiveTab.page.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthat.tab.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, realData = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tif(!activeTab.page) {\r\n\t\t\t\t\t\tthat.tab.render.call(that, realData);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(activeTab.page.getPageNumber() === val.pageNumber) {\r\n\t\t\t\t\t\t\tactiveTab.page.render.call(that, realData);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trealData.status && activeTab.page.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(realData.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, realData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, 1, [realData], {id: key}, realData.from);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null, scaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, val = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tthat.tab.clear.call(that, params);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.getData = function(tabId) {\r\n\t\t\treturn that.container[tabId] || that.container;\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\tthat.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id===activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\ttoolbarStr = \"\",\r\n\t\t\tisFullScreen = false,\r\n\t\t\tfullScreenInterface = wrap.requestFullscreen || wrap.webkitRequestFullscreen || wrap.mozRequestFullScreen || wrap.msRequestFullscreen,\r\n\t\t\tcancelFullScreenInterface = document.exitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen;\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/@ITEM@/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@TITLE@/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARS@/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/@ITEM@/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@TITLE@/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@CHILDTOOLBARS@/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARITEM@/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tfalse!=params.fullScreen && (toolbarStr = toolbarStr + tpl5);\r\n\t\tvar __str__ = tpl1.replace(/@LAYOUT@/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\"))\r\n\t\t\t\t\t\t\t.replace(/@TOOLBARS@/g, toolbarStr)\r\n\t\t\t\t\t\t\t.replace(/@DISABLED@/g, params.disable?\"disabled\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTOOLBAR@/g, params.noToolbar?\"no-toolbar\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTAB@/g, params.noTab?\"no-tab\":\"\");\r\n\t\tvar _data = params.data || (!params.noCache?JSON.parse(window.localStorage.getItem(self.id+\"_pad\")):null);\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar canvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0],\r\n\t\t\tfullScreenBtn = toolbarWrap.getElementsByClassName(\"full-screen-btn\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\tvar createSize = function() {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*\\*\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tcanvasWrapWidth = +RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = +RegExp.$2;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*:\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tswitch(true) {\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2>_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapWidth/RegExp.$1*RegExp.$2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2<_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapHeight/RegExp.$2*RegExp.$1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)%\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth/100*RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight/100*RegExp.$1;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tcanvasWrapWidth = canvasWrap.clientWidth;\r\n\t\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\t\t\t}\r\n\r\n\t\t\tparams.width = canvasWrapWidth>>0;\r\n\t\t\tparams.height = canvasWrapHeight>>0;\r\n\t\t};\r\n\r\n\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tif(true!=scrollObj.disable && scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\tvar data = {type: \"y\", distance: (\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY))/10, from: params.id, scale: scrollObj.scrollObj.y.moveHeight/scrollObj.scrollObj.y.coverHeight};\r\n\t\t\t\tscrollObj.scroll(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar oldAvilWidth = canvasWrap.clientWidth, oldAvilHeight = canvasWrap.clientHeight;\r\n\r\n\t\tele.addEvent(window, \"resize\", function() {\r\n\t\t\tvar avilWidth = canvasWrap.clientWidth,\r\n\t\t\t\tavilHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(avilWidth!=oldAvilWidth || avilHeight!=oldAvilHeight) {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tresizePad();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t\toldAvilWidth = avilWidth;\r\n\t\t\t\toldAvilHeight = avilHeight;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar resizePad = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\r\n\t\t\tmainCanvas.width = bufferCanvas1.width = bufferCanvas2.width = bufferCanvas3.width = bufferCanvas4.width = width;\r\n\t\t\tmainCanvas.height = bufferCanvas1.height = bufferCanvas2.height = bufferCanvas3.height = bufferCanvas4.height = height;\r\n\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = 0;\r\n\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = 0;\r\n\r\n\t\t\tif(width<canvasWrap.clientWidth) {\r\n\t\t\t\tvar left = (canvasWrap.clientWidth - width)/2;\r\n\t\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = left + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tif(height<canvasWrap.clientHeight) {\r\n\t\t\t\tvar top = (canvasWrap.clientHeight - height)/2;\r\n\t\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = top + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tscrollObj && scrollObj.resize();\r\n\t\t};\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tself.mainCanvas = mainCanvas;\r\n\t\tcreateSize();\r\n\t\tresizePad();\r\n\r\n\t\tvar scrollObj = scroll.init({\r\n\t\t\tnode: canvasWrap,\r\n\t\t\tid: params.id\r\n\t\t});\r\n\r\n\t\tscrollObj.disable = params.disable;\r\n\t\tself.scroll = scrollObj;\r\n\r\n\t\tscrollObj.addEvent(\"scroll\", function(data) {\r\n\t\t\t\"[object Function]\"===toString.call(params.onScroll) && params.onScroll(data);\r\n\t\t});\r\n\t\t\r\n\t\tObject.defineProperty(self.tab, \"resizePad\", {\r\n\t\t\tvalue: resizePad\r\n\t\t});\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tvar fullScreen = function(flag) {\r\n\t\t\tif(!isMobile) {\r\n\t\t\t\tflag?fullScreenInterface.call(wrap.getElementsByClassName(\"pad-wrap\")[0]):cancelFullScreenInterface.call(document);\r\n\t\t\t}else {\t\t\t\t\r\n\t\t\t\tflag?ele.addClass(wrap, \"pad-full-screen\"):ele.removeClass(wrap, \"pad-full-screen\");\r\n\t\t\t}\r\n\r\n\t\t\tisFullScreen = flag;\r\n\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t\tresizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tvar exportImage = function() {\r\n\t\t\tvar uuid = data.uuid,\r\n\t\t\t\tdownloadEle = document.createElement(\"A\"),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas,\r\n\t\t\t\tctx = createImageCanvas.getContext(\"2d\");\r\n\r\n\t\t\tctx.drawImage(self.fileCanvas, 0, 0);\r\n\t\t\tctx.drawImage(self.mainCanvas, 0, 0);\r\n\r\n\t\t\tvar\timage = createImageCanvas.toDataURL(),\r\n\t\t\t\timageDataArr = image.split(\",\"),\r\n\t\t\t\tbStr = atob(imageDataArr[1]),\r\n\t\t\t\tlen = bStr.length,\r\n\t\t\t\ttArr = new Uint8ClampedArray(len);\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\ttArr[len] = bStr.charCodeAt(len);\r\n\t\t\t}\r\n\r\n\t\t\tvar url = URL.createObjectURL(new Blob([tArr], {mime: \"image/octet-stream;Content-Disposition:attachment\"}));\r\n\t\t\tdownloadEle.href = url;\r\n\t\t\tdownloadEle.download = uuid + \".png\";\r\n\t\t\tdownloadEle.click();\r\n\t\t\tURL.revokeObjectURL(url);\r\n\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\t\t};\r\n\r\n\t\tself.pad.resize = function(w, h) {\r\n\t\t\t!isNaN(w) && !isNaN(h) && resizePad(w, h);\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tself.pad.scroll = function(data) {\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t};\r\n\r\n\t\tself.pad.fullScreen = function() {\r\n\t\t\tif(isFullScreen) return ;\r\n\t\t\tfullScreen(true);\r\n\t\t};\r\n\r\n\t\tself.pad.exitFullScreen = function() {\r\n\t\t\tif(!isFullScreen) return ;\r\n\t\t\tfullScreen(false);\r\n\t\t};\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = void(0)!=params.from?params.from:self.params.id,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\twidth: params.width,\r\n\t\t\t\t\theight: params.height,\r\n\t\t\t\t\tfrom: from,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id,\r\n\t\t\t\t\toriginal: params.original || false\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\r\n\t\t\t\tif(self.params.id===from && \"[object Function]\"===toString.call(self.params.onShowFiles)) {\r\n\t\t\t\t\tparams.from = from;\r\n\t\t\t\t\tparams.width = self.params.width;\r\n\t\t\t\t\tparams.height = self.params.height;\r\n\t\t\t\t\tself.params.onShowFiles(params);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar _tab = {id: tabId, name: tabName};\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, 1, null, _tab, from);\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tfrom === self.params.id && self.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tself.pad.clear();\r\n\t\t\t\t_showFiles();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"input\", function() {\r\n\t\t\tthis.style.width = this.scrollWidth + \"px\";\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), \r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\t\t\tcurrent && current.destory.call(self);\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\texportImage();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"fullScreen\":\r\n\t\t\t\tfullScreen(!isFullScreen);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tparentSpan.setAttribute(\"item\", item);\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar mouseX = 0, mouseY = 0;\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\tif(isMobile && e.targetTouches.length>1) return ;\r\n\r\n\t\t\tvar rect = this.getBoundingClientRect(),\r\n\t\t\t\tposX = isMobile?e.targetTouches[0].clientX:e.clientX,\r\n\t\t\t\tposY = isMobile?e.targetTouches[0].clientY:e.clientY,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: posX - (rect.x || rect.left),\r\n\t\t\t\t\ty: posY - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(!current) {\r\n\t\t\t\tif(active) {\r\n\t\t\t\t\tif(true===scrollObj.disable) return ;\r\n\t\t\t\t\tvar moveX = mouseX - posX, moveY = mouseY - posY;\r\n\r\n\t\t\t\t\tif(isMobile) {\r\n\t\t\t\t\t\tmoveX /= 10;\r\n\t\t\t\t\t\tmoveY /= 10;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.x.coverWidth>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({type: \"x\", distance: moveX, from: params.id, scale: scrollObj.scrollObj.x.moveWidth/scrollObj.scrollObj.x.coverWidth});\r\n\t\t\t\t\t\tmouseX = posX;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({type: \"y\", distance: moveY, from: params.id, scale: scrollObj.scrollObj.y.moveHeight/scrollObj.scrollObj.y.coverHeight});\r\n\t\t\t\t\t\tmouseY = posY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar item = current.name.toLowerCase();\r\n\r\n\t\t\t\tif(handPad || active) {\r\n\t\t\t\t\tswitch(item) {\r\n\t\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tmouseX = isMobile?e.targetTouches[0].clientX:e.clientX;\r\n\t\t\tmouseY = isMobile?e.targetTouches[0].clientY:e.clientY;\r\n\t\t\tactive = true;\r\n\t\t\tif(!current) return ;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t\tcurrent.bufferRender && current.bufferRender.call(self, pos, true);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, 0);\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key];\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, val.type, val.data, {id: key, name: val.tabName}, val.from);\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0 === val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\t_params.id = void(0)==_params.id?data.uuid:_params.id;\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: line.js\r\n * describe: 线性\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\t//直线\r\n\t\tarrow: 1\t//箭头\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: pen.js\r\n * describe: 笔\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: rectangle.js\r\n * describe: 矩形\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\t//空心矩形\r\n\t\trect: 1\t//实心矩形\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: round.js\r\n * describe: 圆\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\t//空心圆\r\n\t\troundel: 1,\t//实心圆\r\n\t\tellipesstroke: 2,\t//空心椭圆\r\n\t\tellipes: 3\t//实心椭圆\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: text.js\r\n * describe: 文本\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; font-size: \" + self.params.fontSize + \"; left: \" + (data.x + self.mainCanvas.offsetLeft) + \"px; top: \" + (data.y + self.mainCanvas.offsetTop -self.textInput.offsetHeight/2 - 18) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, size: self.params.fontSize, from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this, content = self.textInput.value.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(content) self.current.render.call(self, content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}