{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","js/eraser.js","js/ferula.js","js/image.js","js/index.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modeMap","circular","quadrate","pos","lastPoint","Eraser","params","this","name","interimBuffer","buffer","prototype","constructor","active","mouseRender","data","self","type","x","y","eraserSize","mode","current","from","id","largen","cw","mainCanvas","clientWidth","ch","clientHeight","Math","min","apply","lesser","max","bufferRender","_data","origin","status","width","height","ex","ey","size","push","render","vm","window","eraser","Ferula","ferula","Image","renderBuffer","toolbarMap","image","shift","concat","toString","Object","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","eventMap","click","down","move","up","wheel","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","layout","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","ferulaSize","toolbars","childToolbars","rectangle","line","round","titles","circle","roundel","ellipesstroke","rectstroke","pen","rect","ellipes","text","arrow","export","scissors","clear","classes","tabNameMap","0","tpl1","tpl2","tpl4","tpl5","ele","addEvent","addEventListener","target","fn","use","attachEvent","delEvent","removeEventListener","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextElementSibling","nextSibling","css","attrName","attrValue","scroll","val","slice","arguments","event","moveEvent","node","offsetParent","getBoundingClientRect","clientX","dValue","left","offsetWidth","style","clientY","top","offsetHeight","callback","init","start","uuid","str","random","substr","scaleWidth","scaleHeight","isNaN","args","firstArg","_type","arg","key","container","copy","forEach","item","index","count","arr","file","activeTab","tab","getActive","createImageCanvas","next","list","d","imgData","toDataURL","page","getPage","_data_","pageNumber","getPageNumber","saveData","_createImage","pop","unshift","trim","content","obj","keys","isCreateImage","canvas","bufferCanvas","wScale","ctx","getContext","lineWidth","save","scale","hScale","point","beginPath","moveTo","stroke","restore","strokeStyle","strokeRect","fillStyle","fillRect","lineTo","angle1","angle","PI","angle2","topx","cos","topy","sin","botx","arc","fill","scaleX","scaleY","closePath","fillText","renderImage","fileCanvas","setAttribute","src","onload","imgWidth","img","imgHeight","dw","dh","drawImage","fileWidth","fileHeight","original","resizePad","cwhp","iwhp","atan","x1","y1","x2","y2","x3","y3","y4","clip","clearRect","x4","renderRect","renderLine","renderRound","renderText","delete","mouse","mouseIconCanvas","px","py","Tab","_tab","pageMap","build","del","that","_tabTpl","tabTpl","delTpl","innerHTML","_id","li","UL","firstElementChild","firstChild","tabMap","canvasMap","getElementsByTagName","returnValue","cancelBubble","preventDefault","stopPropagation","remove","activeObj","onTabChange","tabWrap","appendChild","dataMap","splitPage","tabName","saveAsImage","saving","getData","clearTimeout","it","idList","indexOf","hide","splice","localStorage","setItem","JSON","stringify","removeClass","addClass","len","onClear","tabId","cleanCache","removeItem","setPage","Page","currentPage","show","createElement","getElementsByClassName","total","pageEle","div","removeChild","nextPageBtn","goPageBtn","pageNumberInput","pre","value","go","$1","__data","some","flag","out","onPageTurn","prePageBtn","pageWrap","removeAttribute","WPad","waitList","onRender","outData","onMousemove","handPad","curActiveChildNode","scrollWrapY","scrollX","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","colorInput","bufferCanvas2","bufferCanvas4","toolbar","_childToolbars","_toolbar","_tpl2","childToolbarStr","fullScreen","toolbarStr","parse","getItem","__str__","canvasWrap","toolbarWrap","scrollWrapX","createSize","canvasWrapWidth","canvasWrapHeight","sizeArr","split","scaleArr","_canvasWrapWidth","_canvasWrapHeight","scrollTop","detail","hideWidth","scrollWidth","scrollLeft","moveDest","scrollY","hideHeight","scrollHeight","oldAvilWidth","oldAvilHeight","avilWidth","avilHeight","w","h","resetScroll","textInput","bufferCanvas1","defineProperty","fullScreenInterface","cancelFullScreenInterface","isFullScreen","fullScreenBtn","pad","exitFullScreen","showFiles","files","newTab","_showFiles","pageObj","isShow","onShowFiles","result","fileInput","fr","readAsDataURL","which","shiftKey","span","srcElement","level","getAttribute","downloadEle","href","curActiveNode","lastSpan","parentNode","parentSpan","preNode","title","match","mouseX","mouseY","targetTouches","posX","posY","toLowerCase","moveX","moveY","offsetLeft","offsetTop","_n","console","error","dataArr","mouseCtrl","renderMouse","enable","createImage","changeTab","turnPage","number","removeTab","wPad","_params","getPadByIndex","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","originY","xc","yc","abs","Text","cssText"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: eraser.js\r\n * describe: 橡皮擦\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null,\r\n\t\tlastPoint = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\t// 存储临时数据\r\n\t\tthis.interimBuffer = [];\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\t// 橡皮擦放大接口\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 橡皮擦缩小接口\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// 橡皮擦功能较为特殊，直接绘制到持久画板上\r\n\t\t// status = 1\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = {type: \"eraser\", data: [], status: 1, origin: true, mode: modeMap[self.current.name], from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\r\n\t\t\tif(!origin && lastPoint) {\r\n\t\t\t\t_data.ex = lastPoint.x;\r\n\t\t\t\t_data.ey = lastPoint.y;\r\n\t\t\t} else {\r\n\t\t\t\t_data.ex = _data.x;\r\n\t\t\t\t_data.ey = _data.y;\r\n\t\t\t}\r\n\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.render(data);\r\n\t\t\tlastPoint = _data;\r\n\t\t},\r\n\t\t// 舍弃\r\n\t\trender: function() {\r\n\t\t\treturn ;\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: ferula.js\r\n * describe: 教鞭\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: image.js\r\n * describe: 演示图片\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\t// 事件名map，PC端和移动端需要对应不同的事件名\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mousemove\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\"\r\n\t\t},\r\n\t\t// 工具栏不同的布局对应的className\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\t// 默认的白板初始化参数\r\n\t\t// ferula, ellipesstroke, rectstroke, pen, eraser, rect, ellipes, text, line, arrow, color, export, scissors, clear, enlarge, file, handPad\r\n\t\tdefaultConfig = {\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\t// 不同工具对应的名称\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\t// 不同工具对应的icon的className\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\t// 白板tab的默认名称\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n// ==============================================================模板===============================================================\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap @LAYOUT@ @DISABLED@\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">@TOOLBARS@</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t\t<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>\\\r\n\t\t\t\t<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"@TITLE@\"><span class=\"item-icon iconfont @ICONCLASS@\" item=\"@ITEM@\" level=\"@LEVEL@\"></span>@CHILDTOOLBARS@</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">@CHILDTOOLBARITEM@</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn iconfont icon-zuofanye\"></a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn iconfont icon-youfanye\"></a>\\\r\n\t\t\t<span><input type=\"text\" class=\"page-number-input\"/>/@TOTAL@<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl5 = '<li class=\"toolbar-item full-screen-btn-wrap\"><span class=\"item-icon full-screen-btn iconfont icon-enlarge\" item=\"fullScreen\"></span></li>';\r\n// ==============================================================模板===============================================================\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\t// 这里创建一个ele对象，此对象下都是对dom节点进行操作的接口\r\n\t// 目地是方便后面的调用\r\n\tvar ele = {\r\n\t\t// 对dom节点绑定事件\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 移除dom节点上的事件\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 为dom节点添加一个指定的类名\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 移除dom节点上指定的类名\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取指定dom节点的前一个节点\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\t// 获取指定dom节点的下一个节点\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\t// 为dom节点添加样式\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\t// 滚动条模块\r\n\t// 如果创建白板时，为白板指定了固定大小，且白板大小大于当前放置白板的容器时会创建滚动条\r\n\tvar scroll = (function() {\r\n\t\tvar moveEvent = function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\ttype = moveEvent.type,\r\n\t\t\t\tnode = moveEvent.node,\r\n\t\t\t\trect = node.offsetParent.getBoundingClientRect();\r\n\r\n\t\t\tif(0===type) {\r\n\t\t\t\tvar val = (e.x || e.clientX) - moveEvent.dValue - (rect.x || rect.left);\r\n\t\t\t\tval = 0>val?0:(val + node.offsetWidth>rect.width?rect.width-node.offsetWidth:val);\r\n\t\t\t\tnode.style.left = val + \"px\";\r\n\t\t\t} else {\r\n\t\t\t\tvar val = (e.y || e.clientY) - moveEvent.dValue - (rect.y || rect.top);\r\n\t\t\t\tval = 0>val?0:(val + node.offsetHeight>rect.height?rect.height-node.offsetHeight:val);\r\n\t\t\t\tnode.style.top = val + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tmoveEvent.callback(val);\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\t// 创建滚动条接口\r\n\t\t\tinit: function(node, type, callback) {\r\n\t\t\t\tele.addEvent(node, eventMap[\"down\"], function() {\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event,\r\n\t\t\t\t\t\tstart = 0===type?(e.x || e.clientX):(e.y || e.clientY),\r\n\t\t\t\t\t\trect = this.getBoundingClientRect();\r\n\r\n\t\t\t\t\tmoveEvent.type = type;\r\n\t\t\t\t\tmoveEvent.node = this;\r\n\t\t\t\t\tmoveEvent.callback = callback;\r\n\t\t\t\t\tmoveEvent.dValue = start - (0===type?(rect.x || rect.left):(rect.y || rect.top));\r\n\t\t\t\t\tele.addEvent(document, eventMap[\"move\"], moveEvent);\r\n\r\n\t\t\t\t\tele.addEvent(document, eventMap[\"up\"], function() {\r\n\t\t\t\t\t\tele.delEvent(document, eventMap[\"move\"], moveEvent);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\t// 数据对象\r\n\t// 这里是对所有进行数据处理的接口进行了归总\r\n\tvar data = {\r\n\t\t// 生成uuid\r\n\t\tget uuid() {\r\n\t\t\tvar len = 20, str = \"\"\r\n\t\t\tfor(;str.length<len;str+=Math.random().toString().substr(2));\r\n\t\t\treturn str.substr(0, len);\r\n\t\t},\r\n\t\t// 对白板数进行缩放\r\n\t\t// 主要应对白板的缩放后的重绘及从一个白板传递到另一个白板的数据\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 数据深拷贝\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tvar val = arg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\tfirstArg.push(container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tvar val = firstArg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 将白板数据生成图片数据\r\n\t\t// 此接口应对的是用户在白板上多次操作产生很多数据，由于数据是存储在storage中，数据量不宜过多，所以会在操作过程中把适量的数据生成图片数据进行存储\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(),\r\n\t\t\t\t\tpage = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) {\r\n\t\t\t\t\t_data_.pageNumber = page.getPageNumber();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 清除文本头尾的空格\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\t// 数据分页\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\t// 对页码进行排序\r\n\t\t\tkeys.sort();\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\t// 向白板绘制pen模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制rect模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制line模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制round模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制text模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制image模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:(\"file\"===params.type?self.fileCanvas:self.mainCanvas)),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\timg = new Image(),\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.setAttribute(\"crossOrigin\", \"anonymous\");\r\n\t\t\timg.src = data[0];\r\n\t\t\tvar cw = canvas.clientWidth, ch = canvas.clientHeight;\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tvar imgWidth = img.width,\r\n\t\t\t\t\timgHeight = img.height,\r\n\t\t\t\t\tdw = cw - imgWidth, \r\n\t\t\t\t\tdh = ch - imgHeight;\r\n\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(dw>=0 && dh>=0) {\r\n\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\tctx.drawImage(img, x, y);\r\n\t\t\t\t\tparams.fileWidth = imgWidth;\r\n\t\t\t\t\tparams.fileHeight = imgHeight;\r\n\t\t\t\t\tdata[1] = x;\r\n\t\t\t\t\tdata[2] = y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!params.original) {\r\n\t\t\t\t\t\tvar cwhp = cw/ch, iwhp = img.width/img.height;\r\n\r\n\t\t\t\t\t\tif(cwhp>iwhp) {\r\n\t\t\t\t\t\t\tctx.drawImage(img, (cw-ch*iwhp)/2, 0, ch*iwhp, ch);\r\n\t\t\t\t\t\t\tparams.fileWidth = ch*iwhp;\r\n\t\t\t\t\t\t\tparams.fileHeight = ch;\r\n\t\t\t\t\t\t\tdata[1] = (cw-ch*iwhp)/2;\r\n\t\t\t\t\t\t\tdata[2] = 0;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tctx.drawImage(img, 0, (ch-cw/iwhp)/2, cw, cw/iwhp);\r\n\t\t\t\t\t\t\tparams.fileWidth = cw;\r\n\t\t\t\t\t\t\tparams.fileHeight = cw/iwhp;\r\n\t\t\t\t\t\t\tdata[1] = 0;\r\n\t\t\t\t\t\t\tdata[2] = (ch-cw/iwhp)/2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcw = cw>imgWidth?cw:imgWidth;\r\n\t\t\t\t\t\tch = ch>imgHeight?ch:imgHeight;\r\n\t\t\t\t\t\tdw = cw - imgWidth, \r\n\t\t\t\t\t\tdh = ch - imgHeight;\r\n\t\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\t\tcanvas.width = cw;\r\n\t\t\t\t\t\tcanvas.height = ch;\r\n\t\t\t\t\t\tparams.fileWidth = imgWidth;\r\n\t\t\t\t\t\tparams.fileHeight = imgHeight;\r\n\t\t\t\t\t\tdata[1] = x;\r\n\t\t\t\t\t\tdata[2] = y;\r\n\t\t\t\t\t\tself.tab.resizePad(cw, ch);\r\n\t\t\t\t\t\tctx.drawImage(img, x, y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 向白板绘制eraser模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tdata.forEach(function(data) {\r\n\t\t\t\tif(0===params.mode) {\r\n\t\t\t\t\tvar sin = data.size/2*Math.sin(Math.atan((data.y - data.ey)/(data.x - data.ex))),\r\n\t\t\t\t    \tcos = data.size/2*Math.cos(Math.atan((data.y - data.ey)/(data.x - data.ex)));\r\n\r\n\t\t\t\t    var x1 = data.ex + sin;\r\n\t\t\t\t    var y1 = data.ey - cos;\r\n\t\t\t\t    var x2 = data.ex - sin;\r\n\t\t\t\t    var y2 = data.ey + cos;\r\n\t\t\t\t    var x3 = data.x + sin;\r\n\t\t\t\t    var y3 = data.y - cos;\r\n\t\t\t\t    var x4 = data.x - sin;\r\n\t\t\t\t    var y4 = data.y + cos;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(scale, scale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.arc(data.x, data.y, data.size/2, 0, 2*Math.PI);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar x1 = data.ex - data.size/2;\r\n\t\t\t\t    var y1 = data.ey - data.size/2;\r\n\t\t\t\t    var x2 = data.ex - data.size/2;\r\n\t\t\t\t    var y2 = data.ey + data.size/2;\r\n\t\t\t\t    var x3 = data.x + data.size/2;\r\n\t\t\t\t    var y3 = data.y - data.size/2;\r\n\t\t\t\t    var x4 = data.x - data.size/2;\r\n\t\t\t\t    var y4 = data.y + data.size/2;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(scale, scale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.rect(x1, y1, data.size, data.size);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(scale, scale);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x1, y1);\r\n\t        \tctx.lineTo(x2, y2);\r\n\t        \tctx.lineTo(x3, y3);\r\n\t        \tctx.lineTo(x4, y4);\r\n\t        \tctx.closePath();\r\n\t        \tctx.clip()\r\n\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t        \tctx.restore();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 总的绘制接口\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\t// 根据type调用相对应功能的render接口\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 鼠标的绘制对象\r\n\tvar mouse = {\r\n\t\t// 橡皮擦\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 教鞭\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\t// 总的render接口\r\n\t\t// 根据type调用mouse[type]\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\t// 白板的tab模块\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\" title=\"@LABEL@\">@LABEL@@DELETEBTN@</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\t// 创建的所有tab生成的map,key是tab的唯一标识\r\n\t\t\t\tdataMap = {},\t// 所有tab对应的数据生成的map,key是tab的唯一标识\r\n\t\t\t\tcanvasMap = {},\t// 所有tab对应的画面生成的map,key是tab的唯一标识\r\n\t\t\t\tactiveObj = {},\t// 目前被激活的画布,数据,tab生成的对象\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, type, _data, _tab, del) {\r\n\t\t\t\tif(!canvas) return ;\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\t_id = _tab && _tab.id?_tab.id:(0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/@LABEL@/g, _tab && _tab.name?_tab.name:tabNameMap[type]).replace(/@DELETEBTN@/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(this===activeObj.tab) return ;\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tdel: del\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(_tab && _tab.name) that.container[_id].tabName = _tab.name;\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\r\n\t\t\t\tif(pageMap[_id]) {\r\n\t\t\t\t\tpageMap[_id].hide();\r\n\t\t\t\t\tdelete pageMap[_id];\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\t\t\t\t_id = idList[index-1>=0?index-1:0];\r\n\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id) {\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\t\t\t\tself.tab.resizePad();\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.container[_id].type != activeObj.type) {\r\n\t\t\t\t\tele.css(activeObj.canvas || self.mainCanvas, \"background\");\r\n\t\t\t\t\tele.css(canvasMap[_id], \"background\", self.params.background);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(params) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.clear.call(self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(self.params.onClear) && self.params.onClear({tabId: activeObj.id});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar id = params.tabId;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].clear.call(self, params);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(dataMap[id]) dataMap[id].length = 0;\r\n\t\t\t\t\t\tif(canvasMap[id]) canvasMap[id].width = canvasMap[id].width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.cleanCache = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\twindow.localStorage.removeItem(self.id+\"_pad\");\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4.replace(/@TOTAL@/g, total);\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\tself.go(pageNumber);\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"input\", function() {\r\n\t\t\tif(/^\\s*([0-9]+).*\\s*$/.test(this.value)) {\r\n\t\t\t\tthis.value = RegExp.$1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = currentPage;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, out) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t!out && that.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tthat.page = self;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t\tdelete that.page;\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: that.params.width,\r\n\t\t\t\t\theight: that.params.height,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from,\r\n\t\t\t\t\toriginal: params.original\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = currentPage;\r\n\t\t\t_data[currentPage-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[currentPage-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[currentPage-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tvar pageNumber = (params?params.pageNumber:currentPage) || currentPage;\r\n\t\t\t_data[pageNumber-1].length = 1;\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\tif(void(0)===params || (params.tabId===that.tab.getActive().id && params.pageNumber===currentPage)) {\r\n\t\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(that.params.onClear) && that.params.onClear({tabId: that.tab.getActive().id, pageNumber: pageNumber});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\r\n\t\tif(show) {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tself.go(1);\r\n\t\t}\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(params.onRender) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tparams.onRender(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(_data.status) {\r\n\t\t\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\t\tactiveTab.page.push.call(that, _data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.push.call(that, activeTab.id, _data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\t\t\t\t_data.width = that.params.width;\r\n\t\t\t\t_data.height = that.params.height;\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key],\r\n\t\t\t\t\ttype = val.type,\r\n\t\t\t\t\tval = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tdata.render.call(that, val);\r\n\r\n\t\t\t\t\tif(val.status) {\r\n\t\t\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\t\t\tactiveTab.page.push.call(that, val);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthat.tab.push.call(that, key, val);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(val.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, val, key);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, val);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, 1, [val], {id: key}, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key],\r\n\t\t\t\t\ttype = val.type,\r\n\t\t\t\t\tval = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tthat.tab.clear.call(that, params);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\tthat.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id===activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number, true);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\tscrollWrapY = null,\r\n\t\t\tscrollWrapX = null,\r\n\t\t\tscrollY = null,\r\n\t\t\tscrollX = null,\r\n\t\t\ttoolbarStr = \"\",\r\n\t\t\tisFullScreen = false,\r\n\t\t\tfullScreenInterface = wrap.requestFullscreen || wrap.webkitRequestFullscreen || wrap.mozRequestFullScreen || wrap.msRequestFullscreen,\r\n\t\t\tcancelFullScreenInterface = document.exitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen;\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/@ITEM@/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@TITLE@/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARS@/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/@ITEM@/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@TITLE@/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@CHILDTOOLBARS@/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARITEM@/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tfalse!=params.fullScreen && (toolbarStr = toolbarStr + tpl5);\r\n\t\tvar __str__ = tpl1.replace(/@LAYOUT@/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\")).replace(/@TOOLBARS@/g, toolbarStr).replace(/@DISABLED@/g, params.disable?\"disabled\":\"\");\r\n\t\tvar _data = params.data || JSON.parse(window.localStorage.getItem(self.id+\"_pad\"));\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar\tcanvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0],\r\n\t\t\tfullScreenBtn = toolbarWrap.getElementsByClassName(\"full-screen-btn\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tscrollWrapX = wrap.getElementsByClassName(\"scroll-x-wrap\")[0];\r\n\t\tscrollWrapY = wrap.getElementsByClassName(\"scroll-y-wrap\")[0];\r\n\t\tscrollX = scrollWrapX.getElementsByClassName(\"scroll-x\")[0];\r\n\t\tscrollY = scrollWrapY.getElementsByClassName(\"scroll-y\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\tvar createSize = function() {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(params.size) {\r\n\t\t\t\tif(/^(\\s*\\d+\\s*)\\*(\\s*\\d+\\s*)$/.test(params.size)) {\r\n\t\t\t\t\tvar sizeArr = params.size.split(/\\*/);\r\n\r\n\t\t\t\t\tcanvasWrapWidth = +sizeArr[0];\r\n\t\t\t\t\tcanvasWrapHeight = +sizeArr[1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(/^(\\s*\\d+\\s*):(\\s*\\d+\\s*)$/.test(params.size)) {\r\n\t\t\t\t\tvar scaleArr = params.size.split(/\\:/),\r\n\t\t\t\t\t\t_canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tswitch(true) {\r\n\t\t\t\t\t\tcase scaleArr[0]/scaleArr[1]>_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapHeight/scaleArr[1]*scaleArr[0];\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase scaleArr[0]/scaleArr[1]<_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapWidth/scaleArr[0]*scaleArr[1];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tparams.width = canvasWrapWidth;\r\n\t\t\tparams.height = canvasWrapHeight;\r\n\t\t};\r\n\r\n\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tcanvasWrap.scrollTop = canvasWrap.scrollTop + (\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY));\r\n\t\t\tscrollY.style.top = (scrollWrapY.clientHeight - scrollY.offsetHeight)*(canvasWrap.scrollTop/(canvasWrap.scrollHeight - canvasWrap.clientHeight)) + \"px\";\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tscroll.init(scrollX, 0, function(val) {\r\n\t\t\tvar rect = scrollWrapX.getBoundingClientRect(),\r\n\t\t\t\tmoveDest = rect.width - scrollX.offsetWidth,\r\n\t\t\t\thideWidth = canvasWrap.scrollWidth - canvasWrap.offsetWidth;\r\n\r\n\t\t\tcanvasWrap.scrollLeft = val*(hideWidth/moveDest);\r\n\t\t});\r\n\r\n\t\tscroll.init(scrollY, 1, function(val) {\r\n\t\t\tvar rect = scrollWrapY.getBoundingClientRect(),\r\n\t\t\t\tmoveDest = rect.height - scrollY.offsetHeight,\r\n\t\t\t\thideHeight = canvasWrap.scrollHeight - canvasWrap.offsetHeight;\r\n\r\n\t\t\tcanvasWrap.scrollTop = val*(hideHeight/moveDest);\r\n\t\t});\r\n\r\n\t\tvar oldAvilWidth = canvasWrap.clientWidth, oldAvilHeight = canvasWrap.clientHeight;\r\n\r\n\t\tele.addEvent(window, \"resize\", function() {\r\n\t\t\tvar avilWidth = canvasWrap.clientWidth,\r\n\t\t\t\tavilHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(avilWidth!=oldAvilWidth || avilHeight!=oldAvilHeight) {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tresizePad();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t\toldAvilWidth = avilWidth;\r\n\t\t\t\toldAvilHeight = avilHeight;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar resizePad = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\t\t\tmainCanvas.width = width;\r\n\t\t\tmainCanvas.height = height;\r\n\t\t\tbufferCanvas1.width = width;\r\n\t\t\tbufferCanvas1.height = height;\r\n\t\t\tbufferCanvas2.width = width;\r\n\t\t\tbufferCanvas2.height = height;\r\n\t\t\tbufferCanvas3.width = width;\r\n\t\t\tbufferCanvas3.height = height;\r\n\t\t\tbufferCanvas4.width = width;\r\n\t\t\tbufferCanvas4.height = height;\r\n\t\t\tresetScroll(w, h);\r\n\t\t};\r\n\r\n\t\tvar resetScroll = function(w, h) {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, \r\n\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight,\r\n\t\t\t\twidth = w || params.width,\r\n\t\t\t\theight = h || params.height;\r\n\r\n\t\t\tif(canvasWrapWidth<width) {\r\n\t\t\t\tele.removeClass(scrollWrapX, \"pad-hide\");\r\n\t\t\t\tvar scrollWidth = canvasWrapWidth - (width - canvasWrapWidth);\r\n\t\t\t\tscrollWidth = scrollWidth<10?10:scrollWidth;\r\n\t\t\t\tscrollX.style.width = scrollWidth + \"px\";\r\n\t\t\t} else {\r\n\t\t\t\tele.addClass(scrollWrapX, \"pad-hide\");\r\n\t\t\t}\r\n\r\n\t\t\tif(canvasWrapHeight<height) {\r\n\t\t\t\tele.removeClass(scrollWrapY, \"pad-hide\");\r\n\t\t\t\tvar scrollHeight = canvasWrapHeight - (height - canvasWrapHeight);\r\n\t\t\t\tscrollHeight = scrollHeight<10?10:scrollHeight;\r\n\t\t\t\tscrollY.style.height = scrollHeight + \"px\";\r\n\t\t\t} else {\r\n\t\t\t\tele.addClass(scrollWrapY, \"pad-hide\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tself.mainCanvas = mainCanvas;\r\n\r\n\t\tcreateSize();\r\n\t\tresizePad();\r\n\r\n\t\tObject.defineProperty(self.tab, \"resizePad\", {\r\n\t\t\tvalue: resizePad\r\n\t\t});\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tvar fullScreen = function(flag) {\r\n\t\t\tif(!isMobile) {\r\n\t\t\t\tflag?fullScreenInterface.call(wrap.getElementsByClassName(\"pad-wrap\")[0]):cancelFullScreenInterface.call(document);\r\n\t\t\t}else {\t\t\t\t\r\n\t\t\t\tflag?ele.addClass(wrap, \"pad-full-screen\"):ele.removeClass(wrap, \"pad-full-screen\");\r\n\t\t\t}\r\n\r\n\t\t\tisFullScreen = flag;\r\n\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t\tresizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tvar exportImage = function() {\r\n\t\t\tvar uuid = data.uuid,\r\n\t\t\t\timage = self.mainCanvas.toDataURL().replace(/image\\/png/, \"image/octet-stream;Content-Disposition:attachment;filename=\"+uuid+\".png\"),\r\n\t\t\t\tdownloadEle = document.createElement(\"A\");\r\n\r\n\t\t\tdownloadEle.download = uuid + \".png\";\r\n\t\t\tdownloadEle.href = image;\r\n\t\t\tdownloadEle.click();\r\n\t\t};\r\n\r\n\t\tself.pad.resize = function(w, h) {\r\n\t\t\t!isNaN(w)&&!isNaN(h)?resizePad(w, h):resizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tself.pad.fullScreen = function() {\r\n\t\t\tif(isFullScreen) return ;\r\n\t\t\tfullScreen(true);\r\n\t\t};\r\n\r\n\t\tself.pad.exitFullScreen = function() {\r\n\t\t\tif(!isFullScreen) return ;\r\n\t\t\tfullScreen(false);\r\n\t\t};\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = void(0)!=params.from?params.from:self.params.id,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tself.pad.clear();\r\n\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\tfrom: from,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id,\r\n\t\t\t\t\toriginal: params.original || false\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\r\n\t\t\t\tif(self.params.id===from && \"[object Function]\"===toString.call(self.params.onShowFiles)) {\r\n\t\t\t\t\tparams.from = from;\r\n\t\t\t\t\tself.params.onShowFiles(params);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar _tab = {id: tabId, name: tabName};\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, 1, null, _tab, from===self.params.id);\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tself.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t_showFiles();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\texportImage();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"fullScreen\":\r\n\t\t\t\tfullScreen(!isFullScreen);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tparentSpan.setAttribute(\"item\", item);\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar mouseX = 0, mouseY = 0;\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\tif(isMobile && e.targetTouches.length>1) return ;\r\n\r\n\t\t\tvar rect = this.getBoundingClientRect(),\r\n\t\t\t\tposX = isMobile?e.targetTouches[0].clientX:e.clientX,\r\n\t\t\t\tposY = isMobile?e.targetTouches[0].clientY:e.clientY,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: posX - (rect.x || rect.left),\r\n\t\t\t\t\ty: posY - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(!current) {\r\n\t\t\t\tif(active) {\r\n\t\t\t\t\tvar moveX = mouseX - posX, moveY = mouseY - posY;\r\n\t\t\t\t\tcanvasWrap.scrollLeft = canvasWrap.scrollLeft + moveX;\r\n\t\t\t\t\tcanvasWrap.scrollTop = canvasWrap.scrollTop + moveY;\r\n\t\t\t\t\tscrollX.style.left = Math.min(Math.max(moveX/((this.offsetWidth - self.params.width)/(self.params.width - scrollX.offsetWidth)) + scrollX.offsetLeft, 0), self.params.width - scrollX.offsetWidth) + \"px\";\r\n\t\t\t\t\tscrollY.style.top = Math.min(Math.max(moveY/((this.offsetHeight - self.params.height)/(self.params.height - scrollY.offsetHeight)) + scrollY.offsetTop, 0), self.params.height - scrollY.offsetHeight) + \"px\";\r\n\t\t\t\t\tmouseX = posX;\r\n\t\t\t\t\tmouseY = posY;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar item = current.name.toLowerCase();\r\n\r\n\t\t\t\tif(handPad || active) {\r\n\t\t\t\t\tswitch(item) {\r\n\t\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tmouseX = isMobile?e.targetTouches[0].clientX:e.clientX;\r\n\t\t\tmouseY = isMobile?e.targetTouches[0].clientY:e.clientY;\r\n\t\t\tactive = true;\r\n\t\t\tif(!current) return ;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent.bufferRender && current.bufferRender.call(self, pos, true);\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tbufferCanvas1.width = bufferCanvas1.width;\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, 0);\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key];\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, val.type, val.data, {id: key, name: val.tabName}, val.del);\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0 === val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: line.js\r\n * describe: 线性\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\t//直线\r\n\t\tarrow: 1\t//箭头\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: pen.js\r\n * describe: 笔\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: rectangle.js\r\n * describe: 矩形\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\t//空心矩形\r\n\t\trect: 1\t//实心矩形\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: round.js\r\n * describe: 圆\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\t//空心圆\r\n\t\troundel: 1,\t//实心圆\r\n\t\tellipesstroke: 2,\t//空心椭圆\r\n\t\tellipes: 3\t//实心椭圆\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: text.js\r\n * describe: 文本\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; left: \" + data.x + \"px; top: \" + (data.y-self.textInput.offsetHeight/2) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}