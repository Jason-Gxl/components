{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","js/eraser.js","js/ferula.js","js/image.js","js/index.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modeMap","circular","quadrate","pos","lastPoint","Eraser","params","this","name","interimBuffer","buffer","prototype","constructor","active","mouseRender","data","self","type","x","y","eraserSize","mode","current","from","id","largen","cw","mainCanvas","clientWidth","ch","clientHeight","Math","min","apply","lesser","max","bufferRender","_data","origin","status","width","height","ex","ey","size","push","render","destory","vm","window","eraser","Ferula","ferula","Image","renderBuffer","toolbarMap","image","shift","concat","toString","Object","URL","webkitURL","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","eventMap","click","down","move","up","wheel","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","layout","fontSize","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","ferulaSize","toolbars","childToolbars","rectangle","line","round","titles","circle","roundel","ellipesstroke","rectstroke","pen","rect","ellipes","text","arrow","export","scissors","clear","classes","tabNameMap","0","tpl1","tpl2","tpl3","tpl5","addEventListener","target","fn","use","delEvent","detachEvent","addClass","ele","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextElementSibling","nextSibling","css","attrName","attrValue","scroll","scrolls","createElement","Scroll","config","node","parentNode","events","scrollBuilder","innerHTML","xTpl","yTpl","appendChild","xScrollObj","scrollWidth","classList","remove","yScrollObj","DIV","removeChild","firstChild","scrollHeight","defineProperty","d","add","get","slice","arguments","event","activeType","clientX","distance","startPoint","clientY","fire","mouseupHandler","mousemoveHandler","addEvent","getElementsByClassName","param","xScrollToolbar","offsetLeft","offsetWidth","style","left","scrollLeft","yScrollToolbar","offsetTop","offsetHeight","top","scrollTop","onScroll","resize","coverWidth","coverHeight","eventName","splice","indexOf","args","forEach","create","init","scrollObj","str","random","substr","val","scaleWidth","scaleHeight","isNaN","firstArg","arg","_type","container","key","copy","item","index","saveAsImage","count","arr","file","len","activeTab","tab","getActive","next","list","imgData","createImageCanvas","toDataURL","_data_","page","pageNumber","getPageNumber","saveData","_createImage","pop","content","splitPage","obj","keys","sort","renderPen","callback","isCreateImage","canvas","bufferCanvas","wScale","hScale","ctx","getContext","strokeStyle","lineWidth","scale","point","beginPath","lineTo","stroke","restore","renderRect","strokeRect","fillStyle","fillRect","moveTo","angle","atan2","PI","angle1","topx","cos","topy","sin","botx","angle2","boty","save","arc","fill","scaleX","scaleY","closePath","fillText","fileCanvas","setAttribute","src","onload","imgWidth","img","imgHeight","dw","dh","drawImage","fileWidth","fileHeight","original","resizePad","cwhp","iwhp","atan","x1","y1","x2","y2","x3","y3","x4","y4","clip","clearRect","renderLine","renderRound","renderImage","delete","mouse","mouseIconCanvas","py","px","Tab","UL","tabTpl","_tab","tabMap","that","uuid","_tabTpl","del","delTpl","_id","li","firstElementChild","canvasMap","getElementsByTagName","cancelBubble","preventDefault","onTabRemove","activeObj","onTabChange","tabWrap","dataMap","tabName","it","setTimeout","pageMap","getData","localStorage","setItem","JSON","stringify","clearTimeout","saving","idList","hide","show","getTab","tabId","cleanCache","removeItem","getPage","outData","Page","currentPage","pageWrap","div","tpl4","total","pageEle","pre","nextPageBtn","goPageBtn","pageNumberInput","value","go","onPageTurn","$1","start","__data","some","flag","prePageBtn","removeClass","empower","removeAttribute","WPad","onRender","onMousemove","fr","FileReader","isFullScreen","exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","colorInput","bufferCanvas4","toolbar","_toolbar","_tpl2","_childToolbars","childToolbarStr","fullScreen","toolbarStr","__str__","parse","getItem","canvasWrap","toolbarWrap","createSize","canvasWrapWidth","canvasWrapHeight","sizeArr","scaleArr","split","_canvasWrapHeight","_canvasWrapWidth","stopPropagation","detail","oldAvilWidth","oldAvilHeight","avilHeight","avilWidth","w","h","bufferCanvas1","bufferCanvas2","bufferCanvas3","textInput","fullScreenInterface","cancelFullScreenInterface","fullScreenBtn","pad","exitFullScreen","showFiles","files","newTab","_showFiles","pageObj","isShow","setPage","onShowFiles","build","result","fileInput","readAsDataURL","which","trim","shiftKey","span","srcElement","level","getAttribute","handPad","downloadEle","imageDataArr","bStr","atob","tArr","charCodeAt","url","createObjectURL","Blob","mime","href","download","revokeObjectURL","exportImage","curActiveNode","lastSpan","curActiveChildNode","parentSpan","preNode","title","match","returnValue","mouseX","mouseY","targetTouches","getBoundingClientRect","posX","posY","moveX","moveY","_n","realData","renderAll","dataArr","renderMouse","console","error","createImage","turnPage","number","removeTab","wPad","_params","getPadById","getPadByIndex","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","xc","yc","originY","abs","9","Text","log","cssText","focus"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: eraser.js\r\n * describe: 橡皮擦\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null,\r\n\t\tlastPoint = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\t// 存储临时数据\r\n\t\tthis.interimBuffer = [];\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\t// 橡皮擦放大接口\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 橡皮擦缩小接口\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// 橡皮擦功能较为特殊，直接绘制到持久画板上\r\n\t\t// status = 1\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = {type: \"eraser\", data: [], status: 1, origin: true, mode: modeMap[self.current.name], from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\r\n\t\t\tif(!origin && lastPoint) {\r\n\t\t\t\t_data.ex = lastPoint.x;\r\n\t\t\t\t_data.ey = lastPoint.y;\r\n\t\t\t} else {\r\n\t\t\t\t_data.ex = _data.x;\r\n\t\t\t\t_data.ey = _data.y;\r\n\t\t\t}\r\n\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.render(data);\r\n\t\t\tlastPoint = _data;\r\n\t\t},\r\n\t\t// 舍弃\r\n\t\trender: function() {\r\n\t\t\treturn ;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: ferula.js\r\n * describe: 教鞭\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: image.js\r\n * describe: 演示图片\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tURL = window.URL || window.webkitURL,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\t// 事件名map，PC端和移动端需要对应不同的事件名\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mousemove\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\"\r\n\t\t},\r\n\t\t// 工具栏不同的布局对应的className\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\t// 默认的白板初始化参数\r\n\t\t// ferula, ellipesstroke, rectstroke, pen, eraser, rect, ellipes, text, line, arrow, color, export, scissors, clear, enlarge, file, handPad\r\n\t\tdefaultConfig = {\r\n\t\t\tdata: null,\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tfontSize: 16,\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\t// 不同工具对应的名称\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\t// 不同工具对应的icon的className\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\t// 白板tab的默认名称\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n// ==============================================================模板===============================================================\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap @LAYOUT@ @DISABLED@\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">@TOOLBARS@</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"@TITLE@\"><span class=\"item-icon iconfont @ICONCLASS@\" item=\"@ITEM@\" level=\"@LEVEL@\"></span>@CHILDTOOLBARS@</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">@CHILDTOOLBARITEM@</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn iconfont icon-zuofanye\"></a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn iconfont icon-youfanye\"></a>\\\r\n\t\t\t<span><input type=\"text\" class=\"page-number-input\"/>/@TOTAL@<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl5 = '<li class=\"toolbar-item full-screen-btn-wrap\"><span class=\"item-icon full-screen-btn iconfont icon-enlarge\" item=\"fullScreen\"></span></li>';\r\n// ==============================================================模板===============================================================\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\t// 这里创建一个ele对象，此对象下都是对dom节点进行操作的接口\r\n\t// 目地是方便后面的调用\r\n\tvar ele = {\r\n\t\t// 对dom节点绑定事件\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 移除dom节点上的事件\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 为dom节点添加一个指定的类名\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 移除dom节点上指定的类名\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取指定dom节点的前一个节点\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\t// 获取指定dom节点的下一个节点\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\t// 为dom节点添加样式\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\t// 滚动条模块\r\n\t// 如果创建白板时，为白板指定了固定大小，且白板大小大于当前放置白板的容器时会创建滚动条\r\n\tvar scroll = (function() {\r\n\t\tvar scrolls = [],\r\n\t\t\tDIV = document.createElement(\"DIV\"),\r\n\t\t\tyTpl = '<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>',\r\n\t\t\txTpl = '<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>';\r\n\r\n\t\tfunction Scroll(params) {\r\n\t\t\tif(!(this instanceof Scroll)) {\r\n\t\t\t\treturn new Scroll(params);\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdisable = false,\r\n\t\t\t\tactiveType = \"x\",\r\n\t\t\t\tstartPoint = {x: 0, y: 0},\r\n\t\t\t\tconfig = params.config,\r\n\t\t\t\tparentNode = params.node.parentNode;\r\n\r\n\t\t\tself.params = params;\r\n\t\t\tself.events = {};\r\n\r\n\t\t\tvar scrollBuilder = function(type) {\r\n\t\t\t\tDIV.innerHTML = \"x\"===type?xTpl:yTpl;\r\n\r\n\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\tself.xScrollObj = DIV.removeChild(DIV.firstChild);\r\n\t\t\t\t\tparentNode.appendChild(self.xScrollObj);\r\n\t\t\t\t\tparams.node.clientWidth<params.node.scrollWidth && self.xScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.yScrollObj = DIV.removeChild(DIV.firstChild);\r\n\t\t\t\t\tparentNode.appendChild(self.yScrollObj);\r\n\t\t\t\t\tparams.node.clientHeight<params.node.scrollHeight && self.yScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tObject.defineProperty(this, \"disable\", {\r\n\t\t\t\tset: function(d) {\r\n\t\t\t\t\tdisable = d;\r\n\r\n\t\t\t\t\tif(disable) {\r\n\t\t\t\t\t\tself.xScrollObj && self.xScrollObj.classList.add(\"pad-hide\");\r\n\t\t\t\t\t\tself.yScrollObj && self.yScrollObj.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.xScrollObj && params.node.clientWidth<params.node.scrollWidth && self.xScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t\tself.yScrollObj && params.node.clientHeight<params.node.scrollHeight && self.yScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn disable;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif(!params.type) {\r\n\t\t\t\tscrollBuilder(\"x\");\r\n\t\t\t\tscrollBuilder(\"y\");\r\n\t\t\t} else {\r\n\t\t\t\tscrollBuilder(params.type);\r\n\t\t\t}\r\n\r\n\t\t\tvar mousemoveHandler = function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\tif(\"x\"===activeType) {\r\n\t\t\t\t\tvar x = e.x || e.clientX;\r\n\t\t\t\t\tvar data = {type: \"x\", distance: x-startPoint.x, from: config.id, width: config.width, height: config.height};\r\n\t\t\t\t\tstartPoint.x = x;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar y = e.y || e.clientY;\r\n\t\t\t\t\tvar data = {type: \"y\", distance: y-startPoint.y, from: config.id, width: config.width, height: config.height};\r\n\t\t\t\t\tstartPoint.y = y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.scroll(data);\r\n\t\t\t\tself.fire(\"scroll\", data);\r\n\t\t\t};\r\n\r\n\t\t\tvar mouseupHandler = function() {\r\n\t\t\t\tele.delEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\tele.delEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t};\r\n\r\n\t\t\tif(self.xScrollObj) {\r\n\t\t\t\tele.addEvent(self.xScrollObj.getElementsByClassName(\"scroll-toolbar\")[0], \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.x = e.x || e.clientX;\r\n\t\t\t\t\tactiveType = \"x\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(self.yScrollObj) {\r\n\t\t\t\tele.addEvent(self.yScrollObj.getElementsByClassName(\"scroll-toolbar\")[0], \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.y = e.y || e.clientY;\r\n\t\t\t\t\tactiveType = \"y\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tScroll.prototype = {\r\n\t\t\tconstructor: Scroll,\r\n\t\t\tscroll: function(param) {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(\"x\"===param.type) {\r\n\t\t\t\t\tvar xScrollToolbar = this.xScrollObj.getElementsByClassName(\"scroll-toolbar\")[0];\r\n\t\t\t\t\tif((xScrollToolbar.offsetLeft + xScrollToolbar.offsetWidth===this.xScrollObj.clientWidth && param.distance>=0) || (0===xScrollToolbar.offsetLeft && param.distance<=0)) return ;\r\n\t\t\t\t\tparam.distance = param.distance / (params.config.width/param.width);\r\n\t\t\t\t\txScrollToolbar.style.left = Math.max(0, Math.min(xScrollToolbar.offsetLeft + param.distance, this.xScrollObj.clientWidth - xScrollToolbar.offsetWidth)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollLeft = params.node.scrollLeft + (param.distance / ((this.xScrollObj.clientWidth - xScrollToolbar.offsetWidth)/(params.node.scrollWidth - params.node.clientWidth)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar yScrollToolbar = this.yScrollObj.getElementsByClassName(\"scroll-toolbar\")[0];\r\n\t\t\t\t\tif((yScrollToolbar.offsetTop + yScrollToolbar.offsetHeight===this.yScrollObj.clientHeight && param.distance>=0) || (0===yScrollToolbar.offsetTop && param.distance<=0)) return ;\r\n\t\t\t\t\tparam.distance = param.distance / (params.config.height/param.height);\r\n\t\t\t\t\tyScrollToolbar.style.top = Math.max(0, Math.min(yScrollToolbar.offsetTop + param.distance, this.yScrollObj.clientHeight - yScrollToolbar.offsetHeight)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollTop = params.node.scrollTop + (param.distance / ((this.yScrollObj.clientHeight - yScrollToolbar.offsetHeight)/(params.node.scrollHeight - params.node.clientHeight)));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparam.from===params.config.id && \"[object Function]\"===toString.call(params.config.onScroll) && params.config.onScroll(param);\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(this.xScrollObj) {\r\n\t\t\t\t\tvar xScrollToolbar = this.xScrollObj.getElementsByClassName(\"scroll-toolbar\")[0],\r\n\t\t\t\t\t\tcoverWidth = params.node.scrollWidth - params.node.clientWidth;\r\n\t\t\t\t\t\r\n\t\t\t\t\txScrollToolbar.style.width = Math.max(this.xScrollObj.clientWidth - coverWidth/10, 50) + \"px\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.yScrollObj) {\r\n\t\t\t\t\tvar yScrollToolbar = this.yScrollObj.getElementsByClassName(\"scroll-toolbar\")[0],\r\n\t\t\t\t\t\tcoverHeight = params.node.scrollHeight - params.node.clientHeight;\r\n\r\n\t\t\t\t\tyScrollToolbar.style.height = Math.max(this.yScrollObj.clientHeight - coverHeight/10, 50) + \"px\";\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(!events[eventName]) {\r\n\t\t\t\t\tevents[eventName] = [fn];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[eventName].push(fn);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(\"[object Function]\"===toString.call(fn)) {\r\n\t\t\t\t\tevents[eventName].splice(events[eventName].indexOf(fn), 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete events[eventName];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfire: function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\teventName = args.shift(),\r\n\t\t\t\t\tevents = this.events;\r\n\r\n\t\t\t\tevents[eventName] && events[eventName].forEach(function(fn) {\r\n\t\t\t\t\t\"[object Function]\"===toString.call(fn) && fn.apply(Object.create(null), args);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tinit: function(params) {\r\n\t\t\t\tif(!params.node) return ;\r\n\t\t\t\tvar scrollObj = new Scroll(params);\r\n\t\t\t\tscrolls.push(scrollObj);\r\n\t\t\t\treturn scrollObj;\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tscrolls.forEach(function(scrollObj) {\r\n\t\t\t\t\tscrollObj.resize();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\t// 数据对象\r\n\t// 这里是对所有进行数据处理的接口进行了归总\r\n\tvar data = {\r\n\t\t// 生成uuid\r\n\t\tget uuid() {\r\n\t\t\tvar len = 20, str = \"\"\r\n\t\t\tfor(;str.length<len;str+=Math.random().toString().substr(2));\r\n\t\t\treturn str.substr(0, len);\r\n\t\t},\r\n\t\t// 对白板数进行缩放\r\n\t\t// 主要应对白板的缩放后的重绘及从一个白板传递到另一个白板的数据\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 数据深拷贝\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tvar val = arg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\tfirstArg.push(container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tvar val = firstArg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 将白板数据生成图片数据\r\n\t\t// 此接口应对的是用户在白板上多次操作产生很多数据，由于数据是存储在storage中，数据量不宜过多，所以会在操作过程中把适量的数据生成图片数据进行存储\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(),\r\n\t\t\t\t\tpage = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) {\r\n\t\t\t\t\t_data_.pageNumber = page.getPageNumber();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 清除文本头尾的空格\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\t// 数据分页\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\t// 对页码进行排序\r\n\t\t\tkeys.sort();\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\t// 向白板绘制pen模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制rect模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制line模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制round模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制text模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.font = params.size + \"px sans-serif\";\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制image模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:(\"file\"===params.type?self.fileCanvas:self.mainCanvas)),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\timg = new Image(),\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.setAttribute(\"crossOrigin\", \"anonymous\");\r\n\t\t\timg.src = data[0];\r\n\t\t\tvar cw = canvas.clientWidth, ch = canvas.clientHeight;\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tvar imgWidth = img.width,\r\n\t\t\t\t\timgHeight = img.height,\r\n\t\t\t\t\tdw = cw - imgWidth, \r\n\t\t\t\t\tdh = ch - imgHeight;\r\n\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(dw>=0 && dh>=0) {\r\n\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\tctx.drawImage(img, x, y);\r\n\t\t\t\t\tparams.fileWidth = imgWidth;\r\n\t\t\t\t\tparams.fileHeight = imgHeight;\r\n\t\t\t\t\tdata[1] = x;\r\n\t\t\t\t\tdata[2] = y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!params.original) {\r\n\t\t\t\t\t\tvar cwhp = cw/ch, iwhp = img.width/img.height;\r\n\r\n\t\t\t\t\t\tif(cwhp>iwhp) {\r\n\t\t\t\t\t\t\tctx.drawImage(img, (cw-ch*iwhp)/2, 0, ch*iwhp, ch);\r\n\t\t\t\t\t\t\tparams.fileWidth = ch*iwhp;\r\n\t\t\t\t\t\t\tparams.fileHeight = ch;\r\n\t\t\t\t\t\t\tdata[1] = (cw-ch*iwhp)/2;\r\n\t\t\t\t\t\t\tdata[2] = 0;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tctx.drawImage(img, 0, (ch-cw/iwhp)/2, cw, cw/iwhp);\r\n\t\t\t\t\t\t\tparams.fileWidth = cw;\r\n\t\t\t\t\t\t\tparams.fileHeight = cw/iwhp;\r\n\t\t\t\t\t\t\tdata[1] = 0;\r\n\t\t\t\t\t\t\tdata[2] = (ch-cw/iwhp)/2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcw = cw>imgWidth?cw:imgWidth;\r\n\t\t\t\t\t\tch = ch>imgHeight?ch:imgHeight;\r\n\t\t\t\t\t\tdw = cw - imgWidth, \r\n\t\t\t\t\t\tdh = ch - imgHeight;\r\n\t\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\t\tcanvas.width = cw;\r\n\t\t\t\t\t\tcanvas.height = ch;\r\n\t\t\t\t\t\tparams.fileWidth = imgWidth;\r\n\t\t\t\t\t\tparams.fileHeight = imgHeight;\r\n\t\t\t\t\t\tdata[1] = x;\r\n\t\t\t\t\t\tdata[2] = y;\r\n\t\t\t\t\t\tself.tab.resizePad(cw, ch);\r\n\t\t\t\t\t\tctx.drawImage(img, x, y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 向白板绘制eraser模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tdata.forEach(function(data) {\r\n\t\t\t\tif(0===params.mode) {\r\n\t\t\t\t\tvar sin = data.size/2*Math.sin(Math.atan((data.y - data.ey)/(data.x - data.ex))),\r\n\t\t\t\t    \tcos = data.size/2*Math.cos(Math.atan((data.y - data.ey)/(data.x - data.ex)));\r\n\r\n\t\t\t\t    var x1 = data.ex + sin;\r\n\t\t\t\t    var y1 = data.ey - cos;\r\n\t\t\t\t    var x2 = data.ex - sin;\r\n\t\t\t\t    var y2 = data.ey + cos;\r\n\t\t\t\t    var x3 = data.x + sin;\r\n\t\t\t\t    var y3 = data.y - cos;\r\n\t\t\t\t    var x4 = data.x - sin;\r\n\t\t\t\t    var y4 = data.y + cos;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(scale, scale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.arc(data.x, data.y, data.size/2, 0, 2*Math.PI);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar x1 = data.ex - data.size/2;\r\n\t\t\t\t    var y1 = data.ey - data.size/2;\r\n\t\t\t\t    var x2 = data.ex - data.size/2;\r\n\t\t\t\t    var y2 = data.ey + data.size/2;\r\n\t\t\t\t    var x3 = data.x + data.size/2;\r\n\t\t\t\t    var y3 = data.y - data.size/2;\r\n\t\t\t\t    var x4 = data.x - data.size/2;\r\n\t\t\t\t    var y4 = data.y + data.size/2;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(scale, scale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.rect(x1, y1, data.size, data.size);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(scale, scale);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x1, y1);\r\n\t        \tctx.lineTo(x2, y2);\r\n\t        \tctx.lineTo(x3, y3);\r\n\t        \tctx.lineTo(x4, y4);\r\n\t        \tctx.closePath();\r\n\t        \tctx.clip()\r\n\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t        \tctx.restore();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 总的绘制接口\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\t// 根据type调用相对应功能的render接口\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 鼠标的绘制对象\r\n\tvar mouse = {\r\n\t\t// 橡皮擦\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 教鞭\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\t// 总的render接口\r\n\t\t// 根据type调用mouse[type]\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\t// 白板的tab模块\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\" title=\"@LABEL@\">@LABEL@@DELETEBTN@</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\t// 创建的所有tab生成的map,key是tab的唯一标识\r\n\t\t\t\tdataMap = {},\t// 所有tab对应的数据生成的map,key是tab的唯一标识\r\n\t\t\t\tcanvasMap = {},\t// 所有tab对应的画面生成的map,key是tab的唯一标识\r\n\t\t\t\tactiveObj = {},\t// 目前被激活的画布,数据,tab生成的对象\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, type, _data, _tab, del) {\r\n\t\t\t\tif(!canvas) return ;\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\t_id = _tab && _tab.id?_tab.id:(0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/@LABEL@/g, _tab && _tab.name?_tab.name:tabNameMap[type]).replace(/@DELETEBTN@/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(true===that.params.disable || this===activeObj.tab) return ;\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tdel: del\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(_tab && _tab.name) that.container[_id].tabName = _tab.name;\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\r\n\t\t\t\tif(pageMap[_id]) {\r\n\t\t\t\t\tpageMap[_id].hide();\r\n\t\t\t\t\tdelete pageMap[_id];\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\t\t\t\t_id = idList[index-1>=0?index-1:0];\r\n\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id) {\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\t\t\t\tself.tab.resizePad();\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.container[_id].type != activeObj.type) {\r\n\t\t\t\t\tele.css(activeObj.canvas || self.mainCanvas, \"background\");\r\n\t\t\t\t\tele.css(canvasMap[_id], \"background\", self.params.background);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(params) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.clear.call(self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(self.params.onClear) && self.params.onClear({tabId: activeObj.id});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar id = params.tabId;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].clear.call(self, params);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(dataMap[id]) dataMap[id].length = 0;\r\n\t\t\t\t\t\tif(canvasMap[id]) canvasMap[id].width = canvasMap[id].width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.cleanCache = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\twindow.localStorage.removeItem(self.id+\"_pad\");\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.render = function(_data, callback) {\r\n\t\t\t\tvar that = this;\r\n\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {};\r\n\r\n\t\t\t\t\t\tobj[activeObj.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeObj.type,\r\n\t\t\t\t\t\t\tsplitPage: activeObj.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tcallback(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_data.status && that.tab.push.call(that, activeObj.id, _data);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4.replace(/@TOTAL@/g, total);\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"input\", function() {\r\n\t\t\tif(/^\\s*([0-9]+).*\\s*$/.test(this.value)) {\r\n\t\t\t\tthis.value = RegExp.$1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = currentPage;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, callback) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\"[object Function]\" === toString.call(callback) && callback();\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tthat.page = self;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t\tdelete that.page;\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: that.params.width,\r\n\t\t\t\t\theight: that.params.height,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from,\r\n\t\t\t\t\toriginal: params.original\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d, pageNumber) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = void(0)!=pageNumber?pageNumber:currentPage;\r\n\t\t\t_data[d.pageNumber-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[d.pageNumber-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[d.pageNumber-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tvar pageNumber = (params?params.pageNumber:currentPage) || currentPage;\r\n\t\t\t_data[pageNumber-1].length = 1;\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\tif(void(0)===params || (params.tabId===that.tab.getActive().id && params.pageNumber===currentPage)) {\r\n\t\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(that.params.onClear) && that.params.onClear({tabId: that.tab.getActive().id, pageNumber: pageNumber});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data, callback) {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\tpageNumber: currentPage,\r\n\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcallback(obj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_data.status && that.page.push.call(that, _data);\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\r\n\t\tif(show) {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tparams.from === that.params.id && self.go(1);\r\n\t\t}\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tif(that.page) {\r\n\t\t\t\t\tthat.page.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthat.tab.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\t\t\t\t_data.width = that.params.width;\r\n\t\t\t\t_data.height = that.params.height;\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, realData = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tif(!activeTab.page) {\r\n\t\t\t\t\t\tthat.tab.render.call(that, realData);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(activeTab.page.getPageNumber() === val.pageNumber) {\r\n\t\t\t\t\t\t\tthat.page.render.call(that, realData);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trealData.status && that.page.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(realData.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, realData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, 1, [realData], {id: key}, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null, scaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, val = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tthat.tab.clear.call(that, params);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\tthat.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id===activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\ttoolbarStr = \"\",\r\n\t\t\tisFullScreen = false,\r\n\t\t\tfullScreenInterface = wrap.requestFullscreen || wrap.webkitRequestFullscreen || wrap.mozRequestFullScreen || wrap.msRequestFullscreen,\r\n\t\t\tcancelFullScreenInterface = document.exitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen;\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/@ITEM@/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@TITLE@/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARS@/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/@ITEM@/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@TITLE@/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@CHILDTOOLBARS@/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARITEM@/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tfalse!=params.fullScreen && (toolbarStr = toolbarStr + tpl5);\r\n\t\tvar __str__ = tpl1.replace(/@LAYOUT@/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\")).replace(/@TOOLBARS@/g, toolbarStr).replace(/@DISABLED@/g, params.disable?\"disabled\":\"\");\r\n\t\tvar _data = params.data || JSON.parse(window.localStorage.getItem(self.id+\"_pad\"));\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar\tcanvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0],\r\n\t\t\tfullScreenBtn = toolbarWrap.getElementsByClassName(\"full-screen-btn\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\tvar createSize = function() {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(params.size) {\r\n\t\t\t\tif(/^(\\s*\\d+\\s*)\\*(\\s*\\d+\\s*)$/.test(params.size)) {\r\n\t\t\t\t\tvar sizeArr = params.size.split(/\\*/);\r\n\r\n\t\t\t\t\tcanvasWrapWidth = +sizeArr[0];\r\n\t\t\t\t\tcanvasWrapHeight = +sizeArr[1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(/^(\\s*\\d+\\s*):(\\s*\\d+\\s*)$/.test(params.size)) {\r\n\t\t\t\t\tvar scaleArr = params.size.split(/\\:/),\r\n\t\t\t\t\t\t_canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tswitch(true) {\r\n\t\t\t\t\t\tcase scaleArr[0]/scaleArr[1]>_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapHeight/scaleArr[1]*scaleArr[0];\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase scaleArr[0]/scaleArr[1]<_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapWidth/scaleArr[0]*scaleArr[1];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tparams.width = canvasWrapWidth;\r\n\t\t\tparams.height = canvasWrapHeight;\r\n\t\t};\r\n\r\n\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tif(true===self.params.disable) return ;\r\n\t\t\tvar data = {type: \"y\", distance: (\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY))/10, from: params.id, width: params.width, height: params.height};\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t});\r\n\r\n\t\tvar oldAvilWidth = canvasWrap.clientWidth, oldAvilHeight = canvasWrap.clientHeight;\r\n\r\n\t\tele.addEvent(window, \"resize\", function() {\r\n\t\t\tvar avilWidth = canvasWrap.clientWidth,\r\n\t\t\t\tavilHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(avilWidth!=oldAvilWidth || avilHeight!=oldAvilHeight) {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tresizePad();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t\toldAvilWidth = avilWidth;\r\n\t\t\t\toldAvilHeight = avilHeight;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar resizePad = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\t\t\tmainCanvas.width = width;\r\n\t\t\tmainCanvas.height = height;\r\n\t\t\tbufferCanvas1.width = width;\r\n\t\t\tbufferCanvas1.height = height;\r\n\t\t\tbufferCanvas2.width = width;\r\n\t\t\tbufferCanvas2.height = height;\r\n\t\t\tbufferCanvas3.width = width;\r\n\t\t\tbufferCanvas3.height = height;\r\n\t\t\tbufferCanvas4.width = width;\r\n\t\t\tbufferCanvas4.height = height;\r\n\t\t\tscrollObj && scrollObj.resize();\r\n\t\t};\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tself.mainCanvas = mainCanvas;\r\n\t\tcreateSize();\r\n\t\tresizePad();\r\n\r\n\t\tvar scrollObj = scroll.init({\r\n\t\t\tnode: canvasWrap,\r\n\t\t\tconfig: params\r\n\t\t});\r\n\r\n\t\tscrollObj.disable = params.disable;\r\n\t\tscrollObj.resize();\r\n\t\t\r\n\t\tObject.defineProperty(self.tab, \"resizePad\", {\r\n\t\t\tvalue: resizePad\r\n\t\t});\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tvar fullScreen = function(flag) {\r\n\t\t\tif(!isMobile) {\r\n\t\t\t\tflag?fullScreenInterface.call(wrap.getElementsByClassName(\"pad-wrap\")[0]):cancelFullScreenInterface.call(document);\r\n\t\t\t}else {\t\t\t\t\r\n\t\t\t\tflag?ele.addClass(wrap, \"pad-full-screen\"):ele.removeClass(wrap, \"pad-full-screen\");\r\n\t\t\t}\r\n\r\n\t\t\tisFullScreen = flag;\r\n\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t\tresizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tvar exportImage = function() {\r\n\t\t\tvar uuid = data.uuid,\r\n\t\t\t\timage = self.mainCanvas.toDataURL(),\r\n\t\t\t\tdownloadEle = document.createElement(\"A\"),\r\n\t\t\t\timageDataArr = image.split(\",\"),\r\n\t\t\t\tbStr = atob(imageDataArr[1]),\r\n\t\t\t\tlen = bStr.length,\r\n\t\t\t\ttArr = new Uint8Array(len);\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\ttArr[len] = bStr.charCodeAt(len);\r\n\t\t\t}\r\n\r\n\t\t\tvar url = URL.createObjectURL(new Blob([tArr], {mime: \"image/octet-stream;Content-Disposition:attachment\"}));\r\n\t\t\tdownloadEle.href = url;\r\n\t\t\tdownloadEle.download = uuid + \".png\";\r\n\t\t\tdownloadEle.click();\r\n\t\t\tURL.revokeObjectURL(url);\r\n\t\t};\r\n\r\n\t\tself.pad.resize = function(w, h) {\r\n\t\t\t!isNaN(w)&&!isNaN(h)?resizePad(w, h):resizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tself.pad.scroll = function(data) {\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t};\r\n\r\n\t\tself.pad.fullScreen = function() {\r\n\t\t\tif(isFullScreen) return ;\r\n\t\t\tfullScreen(true);\r\n\t\t};\r\n\r\n\t\tself.pad.exitFullScreen = function() {\r\n\t\t\tif(!isFullScreen) return ;\r\n\t\t\tfullScreen(false);\r\n\t\t};\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = void(0)!=params.from?params.from:self.params.id,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\tfrom: from,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id,\r\n\t\t\t\t\toriginal: params.original || false\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\r\n\t\t\t\tif(self.params.id===from && \"[object Function]\"===toString.call(self.params.onShowFiles)) {\r\n\t\t\t\t\tparams.from = from;\r\n\t\t\t\t\tself.params.onShowFiles(params);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar _tab = {id: tabId, name: tabName};\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, 1, null, _tab, from===self.params.id);\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tfrom === self.params.id && self.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tself.pad.clear();\r\n\t\t\t\t_showFiles();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"input\", function() {\r\n\t\t\tthis.style.width = this.scrollWidth + \"px\";\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), \r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\t\t\tcurrent && current.destory.call(self);\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\texportImage();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"fullScreen\":\r\n\t\t\t\tfullScreen(!isFullScreen);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tparentSpan.setAttribute(\"item\", item);\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar mouseX = 0, mouseY = 0;\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\tif(isMobile && e.targetTouches.length>1) return ;\r\n\r\n\t\t\tvar rect = this.getBoundingClientRect(),\r\n\t\t\t\tposX = isMobile?e.targetTouches[0].clientX:e.clientX,\r\n\t\t\t\tposY = isMobile?e.targetTouches[0].clientY:e.clientY,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: posX - (rect.x || rect.left),\r\n\t\t\t\t\ty: posY - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(!current) {\r\n\t\t\t\tif(active) {\r\n\t\t\t\t\tif(true===self.params.disable) return ;\r\n\t\t\t\t\tvar moveX = mouseX - posX, moveY = mouseY - posY;\r\n\t\t\t\t\tscrollObj.scroll({type: \"x\", distance: moveX, from: params.id, width: params.width, height: params.height});\r\n\t\t\t\t\tscrollObj.scroll({type: \"y\", distance: moveY, from: params.id, width: params.width, height: params.height});\r\n\t\t\t\t\tmouseX = posX;\r\n\t\t\t\t\tmouseY = posY;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar item = current.name.toLowerCase();\r\n\r\n\t\t\t\tif(handPad || active) {\r\n\t\t\t\t\tswitch(item) {\r\n\t\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tmouseX = isMobile?e.targetTouches[0].clientX:e.clientX;\r\n\t\t\tmouseY = isMobile?e.targetTouches[0].clientY:e.clientY;\r\n\t\t\tactive = true;\r\n\t\t\tif(!current) return ;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t\tcurrent.bufferRender && current.bufferRender.call(self, pos, true);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t\t// bufferCanvas1.width = bufferCanvas1.width;\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, 0);\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key];\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, val.type, val.data, {id: key, name: val.tabName}, val.del);\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0 === val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: line.js\r\n * describe: 线性\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\t//直线\r\n\t\tarrow: 1\t//箭头\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: pen.js\r\n * describe: 笔\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: rectangle.js\r\n * describe: 矩形\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\t//空心矩形\r\n\t\trect: 1\t//实心矩形\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: round.js\r\n * describe: 圆\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\t//空心圆\r\n\t\troundel: 1,\t//实心圆\r\n\t\tellipesstroke: 2,\t//空心椭圆\r\n\t\tellipes: 3\t//实心椭圆\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: text.js\r\n * describe: 文本\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\t\t\tconsole.log(\"text\");\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; font-size: \" + self.params.fontSize + \"; left: \" + data.x + \"px; top: \" + (data.y-self.textInput.offsetHeight/2-8) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, size: self.params.fontSize, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this, content = self.textInput.value.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(content) self.current.render.call(self, content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}