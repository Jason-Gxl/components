{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","js/eraser.js","js/ferula.js","js/image.js","js/index.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modeMap","circular","quadrate","pos","lastPoint","Eraser","params","this","name","interimBuffer","buffer","prototype","constructor","active","mouseRender","data","self","type","x","y","eraserSize","mode","current","from","id","largen","cw","mainCanvas","clientWidth","ch","clientHeight","Math","min","apply","lesser","max","bufferRender","_data","origin","status","width","height","ex","ey","size","push","render","destory","vm","window","eraser","Ferula","ferula","Image","renderBuffer","toolbarMap","image","shift","concat","toString","Object","URL","webkitURL","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","eventMap","click","down","move","up","wheel","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","layout","fontSize","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","ferulaSize","toolbars","childToolbars","rectangle","line","round","titles","circle","roundel","ellipesstroke","rectstroke","pen","rect","ellipes","text","arrow","export","scissors","clear","classes","tabNameMap","0","tpl1","tpl2","tpl3","tpl5","addEventListener","target","fn","use","delEvent","detachEvent","addClass","ele","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextNode","style","attrName","attrValue","scroll","scrolls","createElement","Scroll","node","parentNode","events","scrollBuilder","innerHTML","xTpl","yTpl","appendChild","xScrollObj","scrollWidth","classList","remove","yScrollObj","tplDiv","removeChild","firstChild","scrollHeight","defineProperty","d","add","get","mousemoveHandler","slice","arguments","activeType","scale","getElementsByClassName","offsetWidth","distance","startPoint","clientY","fire","mouseupHandler","addEvent","event","clientX","param","scrollObj","scrollToolbar","offsetLeft","scrollLeft","offsetTop","scrollTop","offsetHeight","resize","xScrollToolbar","coverWidth","yScrollToolbar","coverHeight","eventName","splice","indexOf","args","forEach","create","init","str","random","substr","val","scaleWidth","scaleHeight","isNaN","firstArg","arg","_type","container","key","copy","item","index","saveAsImage","count","arr","file","len","activeTab","tab","getActive","next","list","imgData","createImageCanvas","toDataURL","_data_","page","pageNumber","getPageNumber","saveData","_createImage","pop","content","splitPage","obj","keys","sort","renderPen","callback","isCreateImage","canvas","bufferCanvas","wScale","hScale","ctx","getContext","strokeStyle","lineWidth","point","beginPath","lineTo","stroke","restore","renderRect","strokeRect","fillStyle","fillRect","moveTo","angle","atan2","PI","angle1","topx","cos","topy","sin","botx","angle2","boty","save","arc","fill","scaleX","scaleY","closePath","fillText","fileCanvas","setAttribute","src","onload","imgWidth","img","imgHeight","dw","dh","drawImage","fileWidth","fileHeight","original","resizePad","cwhp","iwhp","atan","x1","y1","x2","y2","x3","y3","x4","y4","clip","clearRect","renderLine","renderRound","renderImage","delete","mouse","mouseIconCanvas","py","px","Tab","UL","tabTpl","_tab","tabMap","that","uuid","_tabTpl","del","delTpl","_id","li","firstElementChild","canvasMap","getElementsByTagName","cancelBubble","preventDefault","onTabRemove","activeObj","onTabChange","tabWrap","dataMap","tabName","it","setTimeout","pageMap","getData","localStorage","setItem","JSON","stringify","clearTimeout","saving","idList","hide","css","show","getTab","tabId","cleanCache","removeItem","getPage","outData","Page","currentPage","pageWrap","div","tpl4","total","pageEle","pre","nextPageBtn","goPageBtn","pageNumberInput","value","go","onPageTurn","$1","start","__data","some","flag","prePageBtn","removeClass","empower","removeAttribute","WPad","onRender","onMousemove","fr","FileReader","isFullScreen","exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","colorInput","bufferCanvas4","toolbar","_toolbar","_tpl2","_childToolbars","childToolbarStr","fullScreen","toolbarStr","__str__","parse","getItem","canvasWrap","toolbarWrap","createSize","canvasWrapWidth","canvasWrapHeight","sizeArr","scaleArr","split","_canvasWrapHeight","_canvasWrapWidth","stopPropagation","detail","oldAvilWidth","oldAvilHeight","avilHeight","avilWidth","w","h","bufferCanvas1","bufferCanvas2","bufferCanvas3","textInput","config","fullScreenInterface","cancelFullScreenInterface","fullScreenBtn","pad","exitFullScreen","showFiles","files","newTab","_showFiles","pageObj","isShow","setPage","onShowFiles","build","result","fileInput","readAsDataURL","which","trim","shiftKey","span","srcElement","level","getAttribute","handPad","downloadEle","imageDataArr","bStr","atob","tArr","charCodeAt","url","createObjectURL","Blob","mime","href","download","revokeObjectURL","exportImage","curActiveNode","lastSpan","curActiveChildNode","parentSpan","preNode","title","match","returnValue","mouseX","mouseY","targetTouches","getBoundingClientRect","posX","left","posY","top","moveX","moveY","_n","realData","renderAll","dataArr","renderMouse","console","error","createImage","turnPage","number","removeTab","wPad","_params","getPadById","getPadByIndex","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","xc","yc","originY","abs","9","Text","log","cssText","focus"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: eraser.js\r\n * describe: 橡皮擦\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null,\r\n\t\tlastPoint = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\t// 存储临时数据\r\n\t\tthis.interimBuffer = [];\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\t// 橡皮擦放大接口\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 橡皮擦缩小接口\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// 橡皮擦功能较为特殊，直接绘制到持久画板上\r\n\t\t// status = 1\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = {type: \"eraser\", data: [], status: 1, origin: true, mode: modeMap[self.current.name], from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\r\n\t\t\tif(!origin && lastPoint) {\r\n\t\t\t\t_data.ex = lastPoint.x;\r\n\t\t\t\t_data.ey = lastPoint.y;\r\n\t\t\t} else {\r\n\t\t\t\t_data.ex = _data.x;\r\n\t\t\t\t_data.ey = _data.y;\r\n\t\t\t}\r\n\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.render(data);\r\n\t\t\tlastPoint = _data;\r\n\t\t},\r\n\t\t// 舍弃\r\n\t\trender: function() {\r\n\t\t\treturn ;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: ferula.js\r\n * describe: 教鞭\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: image.js\r\n * describe: 演示图片\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tURL = window.URL || window.webkitURL,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\t// 事件名map，PC端和移动端需要对应不同的事件名\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mousemove\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\"\r\n\t\t},\r\n\t\t// 工具栏不同的布局对应的className\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\t// 默认的白板初始化参数\r\n\t\t// ferula, ellipesstroke, rectstroke, pen, eraser, rect, ellipes, text, line, arrow, color, export, scissors, clear, enlarge, file, handPad\r\n\t\tdefaultConfig = {\r\n\t\t\tdata: null,\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tfontSize: 16,\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\t// 不同工具对应的名称\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\t// 不同工具对应的icon的className\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\t// 白板tab的默认名称\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n// ==============================================================模板===============================================================\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap @LAYOUT@ @DISABLED@\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">@TOOLBARS@</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"@TITLE@\"><span class=\"item-icon iconfont @ICONCLASS@\" item=\"@ITEM@\" level=\"@LEVEL@\"></span>@CHILDTOOLBARS@</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">@CHILDTOOLBARITEM@</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn iconfont icon-zuofanye\"></a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn iconfont icon-youfanye\"></a>\\\r\n\t\t\t<span><input type=\"text\" class=\"page-number-input\"/>/@TOTAL@<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl5 = '<li class=\"toolbar-item full-screen-btn-wrap\"><span class=\"item-icon full-screen-btn iconfont icon-enlarge\" item=\"fullScreen\"></span></li>';\r\n// ==============================================================模板===============================================================\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\t// 这里创建一个ele对象，此对象下都是对dom节点进行操作的接口\r\n\t// 目地是方便后面的调用\r\n\tvar ele = {\r\n\t\t// 对dom节点绑定事件\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 移除dom节点上的事件\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 为dom节点添加一个指定的类名\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 移除dom节点上指定的类名\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取指定dom节点的前一个节点\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\t// 获取指定dom节点的下一个节点\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\t// 为dom节点添加样式\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\t// 滚动条模块\r\n\t// 如果创建白板时，为白板指定了固定大小，且白板大小大于当前放置白板的容器时会创建滚动条\r\n\tvar scroll = (function() {\r\n\t\tvar scrolls = [],\r\n\t\t\ttplDiv = document.createElement(\"DIV\"),\r\n\t\t\txTpl = '<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>',\r\n\t\t\tyTpl = '<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>';\r\n\r\n\t\tfunction Scroll(params) {\r\n\t\t\tif(!(this instanceof Scroll)) {\r\n\t\t\t\treturn new Scroll(params);\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdisable = false,\r\n\t\t\t\tactiveType = \"x\",\r\n\t\t\t\tstartPoint = {x: 0, y: 0},\r\n\t\t\t\tparentNode = params.node.parentNode;\r\n\r\n\t\t\tself.params = params;\r\n\t\t\tself.events = {};\r\n\r\n\t\t\tvar scrollBuilder = function(type) {\r\n\t\t\t\ttplDiv.innerHTML = \"x\"===type?xTpl:yTpl;\r\n\r\n\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\tself.xScrollObj = tplDiv.removeChild(tplDiv.firstChild);\r\n\t\t\t\t\tparentNode.appendChild(self.xScrollObj);\r\n\t\t\t\t\tparams.node.clientWidth<params.node.scrollWidth && self.xScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.yScrollObj = tplDiv.removeChild(tplDiv.firstChild);\r\n\t\t\t\t\tparentNode.appendChild(self.yScrollObj);\r\n\t\t\t\t\tparams.node.clientHeight<params.node.scrollHeight && self.yScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tObject.defineProperty(this, \"disable\", {\r\n\t\t\t\tset: function(d) {\r\n\t\t\t\t\tdisable = d;\r\n\r\n\t\t\t\t\tif(disable) {\r\n\t\t\t\t\t\tself.xScrollObj && self.xScrollObj.classList.add(\"pad-hide\");\r\n\t\t\t\t\t\tself.yScrollObj && self.yScrollObj.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.xScrollObj && params.node.clientWidth<params.node.scrollWidth && self.xScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t\tself.yScrollObj && params.node.clientHeight<params.node.scrollHeight && self.yScrollObj.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn disable;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif(!params.type) {\r\n\t\t\t\tscrollBuilder(\"x\");\r\n\t\t\t\tscrollBuilder(\"y\");\r\n\t\t\t} else {\r\n\t\t\t\tscrollBuilder(params.type);\r\n\t\t\t}\r\n\r\n\t\t\tvar mousemoveHandler = function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\tif(\"x\"===activeType) {\r\n\t\t\t\t\tvar x = e.x || e.clientX,\r\n\t\t\t\t\t\tscale = (self.xScrollObj.clientWidth - self.xScrollObj.getElementsByClassName(\"scroll-toolbar\")[0].offsetWidth)/params.node.scrollWidth,\r\n\t\t\t\t\t\tdata = {type: \"x\", distance: x-startPoint.x, from: params.id, scale: scale};\r\n\t\t\t\t\tstartPoint.x = x;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar y = e.y || e.clientY,\r\n\t\t\t\t\t\tscale = (self.yScrollObj.clientHeight - self.yScrollObj.getElementsByClassName(\"scroll-toolbar\")[0].offsetWidth)/params.node.scrollHeight,\r\n\t\t\t\t\t\tdata = {type: \"y\", distance: y-startPoint.y, from: params.id, scale: scale};\r\n\t\t\t\t\tstartPoint.y = y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.scroll(data);\r\n\t\t\t\tself.fire(\"scroll\", data);\r\n\t\t\t};\r\n\r\n\t\t\tvar mouseupHandler = function() {\r\n\t\t\t\tele.delEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\tele.delEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t};\r\n\r\n\t\t\tif(self.xScrollObj) {\r\n\t\t\t\tele.addEvent(self.xScrollObj.getElementsByClassName(\"scroll-toolbar\")[0], \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.x = e.x || e.clientX;\r\n\t\t\t\t\tactiveType = \"x\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(self.yScrollObj) {\r\n\t\t\t\tele.addEvent(self.yScrollObj.getElementsByClassName(\"scroll-toolbar\")[0], \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.y = e.y || e.clientY;\r\n\t\t\t\t\tactiveType = \"y\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tScroll.prototype = {\r\n\t\t\tconstructor: Scroll,\r\n\t\t\tscroll: function(param) {\r\n\t\t\t\tvar params = this.params,\r\n\t\t\t\t\tscrollObj = \"x\"===param.type?this.xScrollObj:this.yScrollObj,\r\n\t\t\t\t\tscrollToolbar = scrollObj.getElementsByClassName(\"scroll-toolbar\")[0];\r\n\r\n\t\t\t\tif(param.from===this.params.id) {\r\n\t\t\t\t\tif(\"x\"===param.type) {\r\n\t\t\t\t\t\tvar offsetLeft = scrollToolbar.offsetLeft + param.distance;\r\n\t\t\t\t\t\tscrollToolbar.style.left = Math.max(0, Math.min(offsetLeft, scrollObj.clientWidth - scrollToolbar.offsetWidth)) + \"px\";\r\n\t\t\t\t\t\tparams.node.scrollLeft = params.node.scrollLeft + (param.distance/((scrollObj.clientWidth - scrollToolbar.offsetWidth)/params.node.offsetWidth));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar offsetTop = scrollToolbar.offsetTop + param.distance;\r\n\t\t\t\t\t\tscrollToolbar.style.top = Math.max(0, Math.min(offsetTop, scrollObj.clientHeight - scrollToolbar.offsetHeight)) + \"px\";\r\n\t\t\t\t\t\tparams.node.scrollTop = params.node.scrollTop + (param.distance/((scrollObj.clientHeight - scrollToolbar.offsetHeight)/params.node.offsetHeight));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\t\t/*if(\"x\"===param.type) {\r\n\t\t\t\t\tvar xScrollToolbar = this.xScrollObj.getElementsByClassName(\"scroll-toolbar\")[0];\r\n\t\t\t\t\tif((xScrollToolbar.offsetLeft + xScrollToolbar.offsetWidth===this.xScrollObj.clientWidth && param.distance>=0) || (0===xScrollToolbar.offsetLeft && param.distance<=0)) return ;\r\n\t\t\t\t\tparam.distance = param.distance / (params.config.width/param.width);\r\n\t\t\t\t\txScrollToolbar.style.left = Math.max(0, Math.min(xScrollToolbar.offsetLeft + param.distance, this.xScrollObj.clientWidth - xScrollToolbar.offsetWidth)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollLeft = params.node.scrollLeft + (param.distance / ((this.xScrollObj.clientWidth - xScrollToolbar.offsetWidth)/(params.node.scrollWidth - params.node.clientWidth)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar yScrollToolbar = this.yScrollObj.getElementsByClassName(\"scroll-toolbar\")[0];\r\n\t\t\t\t\tif((yScrollToolbar.offsetTop + yScrollToolbar.offsetHeight===this.yScrollObj.clientHeight && param.distance>=0) || (0===yScrollToolbar.offsetTop && param.distance<=0)) return ;\r\n\t\t\t\t\tparam.distance = param.distance / (params.config.height/param.height);\r\n\t\t\t\t\tyScrollToolbar.style.top = Math.max(0, Math.min(yScrollToolbar.offsetTop + param.distance, this.yScrollObj.clientHeight - yScrollToolbar.offsetHeight)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollTop = params.node.scrollTop + (param.distance / ((this.yScrollObj.clientHeight - yScrollToolbar.offsetHeight)/(params.node.scrollHeight - params.node.clientHeight)));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparam.from===params.config.id && \"[object Function]\"===toString.call(params.config.onScroll) && params.config.onScroll(param);*/\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(this.xScrollObj) {\r\n\t\t\t\t\tvar xScrollToolbar = this.xScrollObj.getElementsByClassName(\"scroll-toolbar\")[0],\r\n\t\t\t\t\t\tcoverWidth = params.node.scrollWidth - params.node.clientWidth;\r\n\t\t\t\t\t\r\n\t\t\t\t\txScrollToolbar.style.width = Math.max(this.xScrollObj.clientWidth - coverWidth/10, 50) + \"px\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.yScrollObj) {\r\n\t\t\t\t\tvar yScrollToolbar = this.yScrollObj.getElementsByClassName(\"scroll-toolbar\")[0],\r\n\t\t\t\t\t\tcoverHeight = params.node.scrollHeight - params.node.clientHeight;\r\n\r\n\t\t\t\t\tyScrollToolbar.style.height = Math.max(this.yScrollObj.clientHeight - coverHeight/10, 50) + \"px\";\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(!events[eventName]) {\r\n\t\t\t\t\tevents[eventName] = [fn];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[eventName].push(fn);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(\"[object Function]\"===toString.call(fn)) {\r\n\t\t\t\t\tevents[eventName].splice(events[eventName].indexOf(fn), 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete events[eventName];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfire: function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\teventName = args.shift(),\r\n\t\t\t\t\tevents = this.events;\r\n\r\n\t\t\t\tevents[eventName] && events[eventName].forEach(function(fn) {\r\n\t\t\t\t\t\"[object Function]\"===toString.call(fn) && fn.apply(Object.create(null), args);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tinit: function(params) {\r\n\t\t\t\tif(!params.node) return ;\r\n\t\t\t\tvar scrollObj = new Scroll(params);\r\n\t\t\t\tscrolls.push(scrollObj);\r\n\t\t\t\treturn scrollObj;\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tscrolls.forEach(function(scrollObj) {\r\n\t\t\t\t\tscrollObj.resize();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\t// 数据对象\r\n\t// 这里是对所有进行数据处理的接口进行了归总\r\n\tvar data = {\r\n\t\t// 生成uuid\r\n\t\tget uuid() {\r\n\t\t\tvar len = 20, str = \"\"\r\n\t\t\tfor(;str.length<len;str+=Math.random().toString().substr(2));\r\n\t\t\treturn str.substr(0, len);\r\n\t\t},\r\n\t\t// 对白板数进行缩放\r\n\t\t// 主要应对白板的缩放后的重绘及从一个白板传递到另一个白板的数据\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 数据深拷贝\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tvar val = arg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\tfirstArg.push(container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tvar val = firstArg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 将白板数据生成图片数据\r\n\t\t// 此接口应对的是用户在白板上多次操作产生很多数据，由于数据是存储在storage中，数据量不宜过多，所以会在操作过程中把适量的数据生成图片数据进行存储\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(),\r\n\t\t\t\t\tpage = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) {\r\n\t\t\t\t\t_data_.pageNumber = page.getPageNumber();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 清除文本头尾的空格\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\t// 数据分页\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\t// 对页码进行排序\r\n\t\t\tkeys.sort();\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\t// 向白板绘制pen模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制rect模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制line模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制round模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制text模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.font = params.size + \"px sans-serif\";\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制image模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:(\"file\"===params.type?self.fileCanvas:self.mainCanvas)),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\timg = new Image(),\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.setAttribute(\"crossOrigin\", \"anonymous\");\r\n\t\t\timg.src = data[0];\r\n\t\t\tvar cw = canvas.clientWidth, ch = canvas.clientHeight;\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tvar imgWidth = img.width,\r\n\t\t\t\t\timgHeight = img.height,\r\n\t\t\t\t\tdw = cw - imgWidth, \r\n\t\t\t\t\tdh = ch - imgHeight;\r\n\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(dw>=0 && dh>=0) {\r\n\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\tctx.drawImage(img, x, y);\r\n\t\t\t\t\tparams.fileWidth = imgWidth;\r\n\t\t\t\t\tparams.fileHeight = imgHeight;\r\n\t\t\t\t\tdata[1] = x;\r\n\t\t\t\t\tdata[2] = y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!params.original) {\r\n\t\t\t\t\t\tvar cwhp = cw/ch, iwhp = img.width/img.height;\r\n\r\n\t\t\t\t\t\tif(cwhp>iwhp) {\r\n\t\t\t\t\t\t\tctx.drawImage(img, (cw-ch*iwhp)/2, 0, ch*iwhp, ch);\r\n\t\t\t\t\t\t\tparams.fileWidth = ch*iwhp;\r\n\t\t\t\t\t\t\tparams.fileHeight = ch;\r\n\t\t\t\t\t\t\tdata[1] = (cw-ch*iwhp)/2;\r\n\t\t\t\t\t\t\tdata[2] = 0;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tctx.drawImage(img, 0, (ch-cw/iwhp)/2, cw, cw/iwhp);\r\n\t\t\t\t\t\t\tparams.fileWidth = cw;\r\n\t\t\t\t\t\t\tparams.fileHeight = cw/iwhp;\r\n\t\t\t\t\t\t\tdata[1] = 0;\r\n\t\t\t\t\t\t\tdata[2] = (ch-cw/iwhp)/2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcw = cw>imgWidth?cw:imgWidth;\r\n\t\t\t\t\t\tch = ch>imgHeight?ch:imgHeight;\r\n\t\t\t\t\t\tdw = cw - imgWidth, \r\n\t\t\t\t\t\tdh = ch - imgHeight;\r\n\t\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\t\tcanvas.width = cw;\r\n\t\t\t\t\t\tcanvas.height = ch;\r\n\t\t\t\t\t\tparams.fileWidth = imgWidth;\r\n\t\t\t\t\t\tparams.fileHeight = imgHeight;\r\n\t\t\t\t\t\tdata[1] = x;\r\n\t\t\t\t\t\tdata[2] = y;\r\n\t\t\t\t\t\tself.tab.resizePad(cw, ch);\r\n\t\t\t\t\t\tctx.drawImage(img, x, y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 向白板绘制eraser模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tdata.forEach(function(data) {\r\n\t\t\t\tif(0===params.mode) {\r\n\t\t\t\t\tvar sin = data.size/2*Math.sin(Math.atan((data.y - data.ey)/(data.x - data.ex))),\r\n\t\t\t\t    \tcos = data.size/2*Math.cos(Math.atan((data.y - data.ey)/(data.x - data.ex)));\r\n\r\n\t\t\t\t    var x1 = data.ex + sin;\r\n\t\t\t\t    var y1 = data.ey - cos;\r\n\t\t\t\t    var x2 = data.ex - sin;\r\n\t\t\t\t    var y2 = data.ey + cos;\r\n\t\t\t\t    var x3 = data.x + sin;\r\n\t\t\t\t    var y3 = data.y - cos;\r\n\t\t\t\t    var x4 = data.x - sin;\r\n\t\t\t\t    var y4 = data.y + cos;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(scale, scale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.arc(data.x, data.y, data.size/2, 0, 2*Math.PI);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar x1 = data.ex - data.size/2;\r\n\t\t\t\t    var y1 = data.ey - data.size/2;\r\n\t\t\t\t    var x2 = data.ex - data.size/2;\r\n\t\t\t\t    var y2 = data.ey + data.size/2;\r\n\t\t\t\t    var x3 = data.x + data.size/2;\r\n\t\t\t\t    var y3 = data.y - data.size/2;\r\n\t\t\t\t    var x4 = data.x - data.size/2;\r\n\t\t\t\t    var y4 = data.y + data.size/2;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(scale, scale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.rect(x1, y1, data.size, data.size);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(scale, scale);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x1, y1);\r\n\t        \tctx.lineTo(x2, y2);\r\n\t        \tctx.lineTo(x3, y3);\r\n\t        \tctx.lineTo(x4, y4);\r\n\t        \tctx.closePath();\r\n\t        \tctx.clip()\r\n\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t        \tctx.restore();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 总的绘制接口\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\t// 根据type调用相对应功能的render接口\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 鼠标的绘制对象\r\n\tvar mouse = {\r\n\t\t// 橡皮擦\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 教鞭\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\t// 总的render接口\r\n\t\t// 根据type调用mouse[type]\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\t// 白板的tab模块\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\" title=\"@LABEL@\">@LABEL@@DELETEBTN@</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\t// 创建的所有tab生成的map,key是tab的唯一标识\r\n\t\t\t\tdataMap = {},\t// 所有tab对应的数据生成的map,key是tab的唯一标识\r\n\t\t\t\tcanvasMap = {},\t// 所有tab对应的画面生成的map,key是tab的唯一标识\r\n\t\t\t\tactiveObj = {},\t// 目前被激活的画布,数据,tab生成的对象\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, type, _data, _tab, del) {\r\n\t\t\t\tif(!canvas) return ;\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\t_id = _tab && _tab.id?_tab.id:(0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/@LABEL@/g, _tab && _tab.name?_tab.name:tabNameMap[type]).replace(/@DELETEBTN@/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(true===that.params.disable || this===activeObj.tab) return ;\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tdel: del\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(_tab && _tab.name) that.container[_id].tabName = _tab.name;\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\r\n\t\t\t\tif(pageMap[_id]) {\r\n\t\t\t\t\tpageMap[_id].hide();\r\n\t\t\t\t\tdelete pageMap[_id];\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\t\t\t\t_id = idList[index-1>=0?index-1:0];\r\n\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id) {\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\t\t\t\tself.tab.resizePad();\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.container[_id].type != activeObj.type) {\r\n\t\t\t\t\tele.css(activeObj.canvas || self.mainCanvas, \"background\");\r\n\t\t\t\t\tele.css(canvasMap[_id], \"background\", self.params.background);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(params) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.clear.call(self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(self.params.onClear) && self.params.onClear({tabId: activeObj.id});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar id = params.tabId;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].clear.call(self, params);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(dataMap[id]) dataMap[id].length = 0;\r\n\t\t\t\t\t\tif(canvasMap[id]) canvasMap[id].width = canvasMap[id].width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.cleanCache = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\twindow.localStorage.removeItem(self.id+\"_pad\");\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.render = function(_data, callback) {\r\n\t\t\t\tvar that = this;\r\n\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {};\r\n\r\n\t\t\t\t\t\tobj[activeObj.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeObj.type,\r\n\t\t\t\t\t\t\tsplitPage: activeObj.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tcallback(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_data.status && that.tab.push.call(that, activeObj.id, _data);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4.replace(/@TOTAL@/g, total);\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"input\", function() {\r\n\t\t\tif(/^\\s*([0-9]+).*\\s*$/.test(this.value)) {\r\n\t\t\t\tthis.value = RegExp.$1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = currentPage;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, callback) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\"[object Function]\" === toString.call(callback) && callback();\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tthat.page = self;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t\tdelete that.page;\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: that.params.width,\r\n\t\t\t\t\theight: that.params.height,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from,\r\n\t\t\t\t\toriginal: params.original\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d, pageNumber) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = void(0)!=pageNumber?pageNumber:currentPage;\r\n\t\t\t_data[d.pageNumber-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[d.pageNumber-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[d.pageNumber-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tvar pageNumber = (params?params.pageNumber:currentPage) || currentPage;\r\n\t\t\t_data[pageNumber-1].length = 1;\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\tif(void(0)===params || (params.tabId===that.tab.getActive().id && params.pageNumber===currentPage)) {\r\n\t\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(that.params.onClear) && that.params.onClear({tabId: that.tab.getActive().id, pageNumber: pageNumber});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data, callback) {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\tpageNumber: currentPage,\r\n\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcallback(obj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_data.status && that.page.push.call(that, _data);\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\r\n\t\tif(show) {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tparams.from === that.params.id && self.go(1);\r\n\t\t}\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tif(that.page) {\r\n\t\t\t\t\tthat.page.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthat.tab.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\t\t\t\t_data.width = that.params.width;\r\n\t\t\t\t_data.height = that.params.height;\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, realData = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tif(!activeTab.page) {\r\n\t\t\t\t\t\tthat.tab.render.call(that, realData);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(activeTab.page.getPageNumber() === val.pageNumber) {\r\n\t\t\t\t\t\t\tthat.page.render.call(that, realData);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trealData.status && that.page.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(realData.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, realData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, 1, [realData], {id: key}, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null, scaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, val = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tthat.tab.clear.call(that, params);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\tthat.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id===activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\ttoolbarStr = \"\",\r\n\t\t\tisFullScreen = false,\r\n\t\t\tfullScreenInterface = wrap.requestFullscreen || wrap.webkitRequestFullscreen || wrap.mozRequestFullScreen || wrap.msRequestFullscreen,\r\n\t\t\tcancelFullScreenInterface = document.exitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen;\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/@ITEM@/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@TITLE@/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARS@/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/@ITEM@/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@TITLE@/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@CHILDTOOLBARS@/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARITEM@/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tfalse!=params.fullScreen && (toolbarStr = toolbarStr + tpl5);\r\n\t\tvar __str__ = tpl1.replace(/@LAYOUT@/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\")).replace(/@TOOLBARS@/g, toolbarStr).replace(/@DISABLED@/g, params.disable?\"disabled\":\"\");\r\n\t\tvar _data = params.data || JSON.parse(window.localStorage.getItem(self.id+\"_pad\"));\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar\tcanvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0],\r\n\t\t\tfullScreenBtn = toolbarWrap.getElementsByClassName(\"full-screen-btn\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\tvar createSize = function() {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(params.size) {\r\n\t\t\t\tif(/^(\\s*\\d+\\s*)\\*(\\s*\\d+\\s*)$/.test(params.size)) {\r\n\t\t\t\t\tvar sizeArr = params.size.split(/\\*/);\r\n\r\n\t\t\t\t\tcanvasWrapWidth = +sizeArr[0];\r\n\t\t\t\t\tcanvasWrapHeight = +sizeArr[1];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(/^(\\s*\\d+\\s*):(\\s*\\d+\\s*)$/.test(params.size)) {\r\n\t\t\t\t\tvar scaleArr = params.size.split(/\\:/),\r\n\t\t\t\t\t\t_canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tswitch(true) {\r\n\t\t\t\t\t\tcase scaleArr[0]/scaleArr[1]>_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapHeight/scaleArr[1]*scaleArr[0];\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase scaleArr[0]/scaleArr[1]<_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapWidth/scaleArr[0]*scaleArr[1];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tparams.width = canvasWrapWidth;\r\n\t\t\tparams.height = canvasWrapHeight;\r\n\t\t};\r\n\r\n\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tif(true===self.params.disable) return ;\r\n\t\t\tvar data = {type: \"y\", distance: (\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY))/10, from: params.id, width: params.width, height: params.height};\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t});\r\n\r\n\t\tvar oldAvilWidth = canvasWrap.clientWidth, oldAvilHeight = canvasWrap.clientHeight;\r\n\r\n\t\tele.addEvent(window, \"resize\", function() {\r\n\t\t\tvar avilWidth = canvasWrap.clientWidth,\r\n\t\t\t\tavilHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(avilWidth!=oldAvilWidth || avilHeight!=oldAvilHeight) {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tresizePad();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t\toldAvilWidth = avilWidth;\r\n\t\t\t\toldAvilHeight = avilHeight;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar resizePad = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\t\t\tmainCanvas.width = width;\r\n\t\t\tmainCanvas.height = height;\r\n\t\t\tbufferCanvas1.width = width;\r\n\t\t\tbufferCanvas1.height = height;\r\n\t\t\tbufferCanvas2.width = width;\r\n\t\t\tbufferCanvas2.height = height;\r\n\t\t\tbufferCanvas3.width = width;\r\n\t\t\tbufferCanvas3.height = height;\r\n\t\t\tbufferCanvas4.width = width;\r\n\t\t\tbufferCanvas4.height = height;\r\n\t\t\tscrollObj && scrollObj.resize();\r\n\t\t};\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tself.mainCanvas = mainCanvas;\r\n\t\tcreateSize();\r\n\t\tresizePad();\r\n\r\n\t\tvar scrollObj = scroll.init({\r\n\t\t\tnode: canvasWrap,\r\n\t\t\tconfig: params\r\n\t\t});\r\n\r\n\t\tscrollObj.disable = params.disable;\r\n\t\tscrollObj.resize();\r\n\t\t\r\n\t\tObject.defineProperty(self.tab, \"resizePad\", {\r\n\t\t\tvalue: resizePad\r\n\t\t});\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tvar fullScreen = function(flag) {\r\n\t\t\tif(!isMobile) {\r\n\t\t\t\tflag?fullScreenInterface.call(wrap.getElementsByClassName(\"pad-wrap\")[0]):cancelFullScreenInterface.call(document);\r\n\t\t\t}else {\t\t\t\t\r\n\t\t\t\tflag?ele.addClass(wrap, \"pad-full-screen\"):ele.removeClass(wrap, \"pad-full-screen\");\r\n\t\t\t}\r\n\r\n\t\t\tisFullScreen = flag;\r\n\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t\tresizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tvar exportImage = function() {\r\n\t\t\tvar uuid = data.uuid,\r\n\t\t\t\timage = self.mainCanvas.toDataURL(),\r\n\t\t\t\tdownloadEle = document.createElement(\"A\"),\r\n\t\t\t\timageDataArr = image.split(\",\"),\r\n\t\t\t\tbStr = atob(imageDataArr[1]),\r\n\t\t\t\tlen = bStr.length,\r\n\t\t\t\ttArr = new Uint8Array(len);\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\ttArr[len] = bStr.charCodeAt(len);\r\n\t\t\t}\r\n\r\n\t\t\tvar url = URL.createObjectURL(new Blob([tArr], {mime: \"image/octet-stream;Content-Disposition:attachment\"}));\r\n\t\t\tdownloadEle.href = url;\r\n\t\t\tdownloadEle.download = uuid + \".png\";\r\n\t\t\tdownloadEle.click();\r\n\t\t\tURL.revokeObjectURL(url);\r\n\t\t};\r\n\r\n\t\tself.pad.resize = function(w, h) {\r\n\t\t\t!isNaN(w)&&!isNaN(h)?resizePad(w, h):resizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tself.pad.scroll = function(data) {\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t};\r\n\r\n\t\tself.pad.fullScreen = function() {\r\n\t\t\tif(isFullScreen) return ;\r\n\t\t\tfullScreen(true);\r\n\t\t};\r\n\r\n\t\tself.pad.exitFullScreen = function() {\r\n\t\t\tif(!isFullScreen) return ;\r\n\t\t\tfullScreen(false);\r\n\t\t};\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = void(0)!=params.from?params.from:self.params.id,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\tfrom: from,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id,\r\n\t\t\t\t\toriginal: params.original || false\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\r\n\t\t\t\tif(self.params.id===from && \"[object Function]\"===toString.call(self.params.onShowFiles)) {\r\n\t\t\t\t\tparams.from = from;\r\n\t\t\t\t\tself.params.onShowFiles(params);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar _tab = {id: tabId, name: tabName};\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, 1, null, _tab, from===self.params.id);\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tfrom === self.params.id && self.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tself.pad.clear();\r\n\t\t\t\t_showFiles();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"input\", function() {\r\n\t\t\tthis.style.width = this.scrollWidth + \"px\";\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), \r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\t\t\tcurrent && current.destory.call(self);\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\texportImage();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"fullScreen\":\r\n\t\t\t\tfullScreen(!isFullScreen);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tparentSpan.setAttribute(\"item\", item);\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar mouseX = 0, mouseY = 0;\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\tif(isMobile && e.targetTouches.length>1) return ;\r\n\r\n\t\t\tvar rect = this.getBoundingClientRect(),\r\n\t\t\t\tposX = isMobile?e.targetTouches[0].clientX:e.clientX,\r\n\t\t\t\tposY = isMobile?e.targetTouches[0].clientY:e.clientY,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: posX - (rect.x || rect.left),\r\n\t\t\t\t\ty: posY - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(!current) {\r\n\t\t\t\tif(active) {\r\n\t\t\t\t\tif(true===self.params.disable) return ;\r\n\t\t\t\t\tvar moveX = mouseX - posX, moveY = mouseY - posY;\r\n\t\t\t\t\tscrollObj.scroll({type: \"x\", distance: moveX, from: params.id, width: params.width, height: params.height});\r\n\t\t\t\t\tscrollObj.scroll({type: \"y\", distance: moveY, from: params.id, width: params.width, height: params.height});\r\n\t\t\t\t\tmouseX = posX;\r\n\t\t\t\t\tmouseY = posY;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar item = current.name.toLowerCase();\r\n\r\n\t\t\t\tif(handPad || active) {\r\n\t\t\t\t\tswitch(item) {\r\n\t\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tmouseX = isMobile?e.targetTouches[0].clientX:e.clientX;\r\n\t\t\tmouseY = isMobile?e.targetTouches[0].clientY:e.clientY;\r\n\t\t\tactive = true;\r\n\t\t\tif(!current) return ;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t\tcurrent.bufferRender && current.bufferRender.call(self, pos, true);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t\t// bufferCanvas1.width = bufferCanvas1.width;\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, 0);\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key];\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, val.type, val.data, {id: key, name: val.tabName}, val.del);\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0 === val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: line.js\r\n * describe: 线性\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\t//直线\r\n\t\tarrow: 1\t//箭头\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: pen.js\r\n * describe: 笔\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: rectangle.js\r\n * describe: 矩形\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\t//空心矩形\r\n\t\trect: 1\t//实心矩形\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: round.js\r\n * describe: 圆\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\t//空心圆\r\n\t\troundel: 1,\t//实心圆\r\n\t\tellipesstroke: 2,\t//空心椭圆\r\n\t\tellipes: 3\t//实心椭圆\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: text.js\r\n * describe: 文本\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\t\t\tconsole.log(\"text\");\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; font-size: \" + self.params.fontSize + \"; left: \" + data.x + \"px; top: \" + (data.y-self.textInput.offsetHeight/2-8) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, size: self.params.fontSize, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this, content = self.textInput.value.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(content) self.current.render.call(self, content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}