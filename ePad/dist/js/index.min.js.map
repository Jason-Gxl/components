{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","index.js","js/eraser.js","js/ferula.js","js/image.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","vm","window","toString","Object","prototype","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","eventMap","click","down","move","up","wheel","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","layout","size","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","eraserSize","ferulaSize","toolbars","childToolbars","rectangle","line","round","eraser","titles","ferula","circle","roundel","ellipesstroke","rectstroke","pen","circular","quadrate","rect","ellipes","text","arrow","export","scissors","clear","image","classes","tabNameMap","0","tpl1","tpl2","tpl3","moveEvent","ele","addEventListener","target","type","fn","use","attachEvent","removeEventListener","addClass","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextElementSibling","nextSibling","attrName","attrValue","style","val","slice","arguments","event","node","x","clientX","dValue","left","offsetWidth","width","y","clientY","top","callback","init","addEvent","start","this","delEvent","str","substr","_data","scaleWidth","scaleHeight","mainCanvas","height","data","isNaN","args","shift","firstArg","_type","arg","key","container","copy","push","forEach","item","index","self","count","arr","file","activeTab","tab","getActive","createImageCanvas","next","list","d","imgData","toDataURL","page","getPage","id","_data_","origin","from","pageNumber","getPageNumber","apply","saveData","_createImage","render","len","pop","unshift","params","content","obj","keys","sort","isCreateImage","canvas","status","bufferCanvas","wScale","hScale","ctx","getContext","strokeStyle","lineWidth","save","scale","point","beginPath","lineTo","stroke","restore","mode","strokeRect","fillStyle","moveTo","angle","Math","atan2","PI","angle1","angle2","topx","cos","botx","boty","sin","arc","fill","scaleX","scaleY","closePath","fillText","Image","src","cw","clientWidth","ch","clientHeight","onload","imgWidth","img","dw","dh","drawImage","fileWidth","fileHeight","imgHeight","cwhp","iwhp","lineJoin","lineCap","renderPen","renderRect","renderLine","renderRound","renderImage","delete","mouse","mouseIconCanvas","py","px","Tab","_tab","pageMap","build","del","that","_tabTpl","tabTpl","delTpl","innerHTML","_id","li","UL","firstElementChild","firstChild","tabMap","canvasMap","getElementsByTagName","returnValue","preventDefault","stopPropagation","onTabRemove","activeObj","onTabChange","active","tabWrap","appendChild","splitPage","dataMap","saveAsImage","saving","getData","clearTimeout","it","idList","indexOf","hide","removeChild","splice","localStorage","setItem","JSON","stringify","css","removeClass","getTab","setPage","constructor","Page","currentPage","tabId","show","div","createElement","pageWrap","getElementsByClassName","tpl4","pageEle","nextPageBtn","pre","total","goPageBtn","pageNumberInput","value","go","__data","some","flag","out","onPageTurn","prePageBtn","empower","removeAttribute","setAttribute","WPad","onRender","onMousemove","outData","handPad","curActiveChildNode","scrollWrapY","colorInput","bufferCanvas2","bufferCanvas4","toolbar","_childToolbars","_toolbar","_tpl2","childToolbarStr","toolbarStr","__str__","parse","getItem","toolbarMap","canvasWrap","fileInput","scrollWrapX","resizePad","isFixedSize","sizeArr","split","canvasWrapWidth","canvasWrapHeight","scrollTop","detail","scrollY","offsetHeight","scrollHeight","cancelBubble","getBoundingClientRect","moveDest","scrollX","hideWidth","scrollWidth","scrollLeft","hideHeight","bufferCanvas1","bufferCanvas3","textInput","pad","showFiles","newTab","isShow","tabName","files","pageObj","_showFiles","renderBuffer","result","fr","readAsDataURL","which","trim","current","shiftKey","largen","lesser","toolbarWrap","span","srcElement","level","getAttribute","onClear","uuid","href","curActiveNode","lastSpan","parentSpan","preNode","parentNode","title","match","name","toLowerCase","targetTouches","mouseRender","pos","bufferRender","_n","fileCanvas","console","error","dataArr","mouseCtrl","renderMouse","enable","createImage","changeTab","turnPage","number","removeTab","remove","wPad","_params","getPadById","2","modeMap","Eraser","interimBuffer","buffer","min","max","3","Ferula","4","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","originY","xc","yc","abs","9","Text"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mousemove\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\"\r\n\t\t},\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\tdefaultConfig = {\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t\t//toolbars: [\"ferula\", \"ellipesstroke\", \"rectstroke\", \"pen\", \"eraser\", \"rect\", \"ellipes\", \"text\", \"line\", \"arrow\", \"color\", \"export\", \"scissors\", \"clear\", \"enlarge\", \"file\", \"handPad\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap $LAYOUT$ $DISABLED$\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">$TOOLBARS$</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>\\\r\n\t\t\t\t<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"$TITLE$\"><span class=\"item-icon iconfont $ICONCLASS$\" item=\"$ITEM$\" level=\"$LEVEL$\"></span>$CHILDTOOLBARS$</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">$CHILDTOOLBARITEM$</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn\">上一页</a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn\">下一页</a>\\\r\n\t\t\t<span>第<input type=\"text\" class=\"page-number-input\"/>页<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\tvar ele = {\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\tvar scroll = (function() {\r\n\t\tvar moveEvent = function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\ttype = moveEvent.type,\r\n\t\t\t\tnode = moveEvent.node,\r\n\t\t\t\trect = node.offsetParent.getBoundingClientRect();\r\n\r\n\t\t\tif(0===type) {\r\n\t\t\t\tvar val = (e.x || e.clientX) - moveEvent.dValue - (rect.x || rect.left);\r\n\t\t\t\tval = 0>val?0:(val + node.offsetWidth>rect.width?rect.width-node.offsetWidth:val);\r\n\t\t\t\tnode.style.left = val + \"px\";\r\n\t\t\t} else {\r\n\t\t\t\tvar val = (e.y || e.clientY) - moveEvent.dValue - (rect.y || rect.top);\r\n\t\t\t\tval = 0>val?0:(val + node.offsetHeight>rect.height?rect.height-node.offsetHeight:val);\r\n\t\t\t\tnode.style.top = val + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tmoveEvent.callback(val);\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tinit: function(node, type, callback) {\r\n\t\t\t\tele.addEvent(node, eventMap[\"down\"], function() {\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event,\r\n\t\t\t\t\t\tstart = 0===type?(e.x || e.clientX):(e.y || e.clientY),\r\n\t\t\t\t\t\trect = this.getBoundingClientRect();\r\n\r\n\t\t\t\t\tmoveEvent.type = type;\r\n\t\t\t\t\tmoveEvent.node = this;\r\n\t\t\t\t\tmoveEvent.callback = callback;\r\n\t\t\t\t\tmoveEvent.dValue = start - (0===type?(rect.x || rect.left):(rect.y || rect.top));\r\n\t\t\t\t\tele.addEvent(document, eventMap[\"move\"], moveEvent);\r\n\r\n\t\t\t\t\tele.addEvent(document, eventMap[\"up\"], function() {\r\n\t\t\t\t\t\tele.delEvent(document, eventMap[\"move\"], moveEvent);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\tvar data = {\r\n\t\tget uuid() {\r\n\t\t\tvar len = 20, str = \"\"\r\n\t\t\tfor(;str.length<len;str+=Math.random().toString().substr(2));\r\n\t\t\treturn str.substr(0, len);\r\n\t\t},\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tvar val = arg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\tfirstArg.push(container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tvar val = firstArg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(),\r\n\t\t\t\t\tpage = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) {\r\n\t\t\t\t\t_data_.pageNumber = page.getPageNumber();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\tkeys.sort();\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\timg = new Image(),\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.src = data[0];\r\n\t\t\tvar cw = canvas.clientWidth, ch = canvas.clientHeight;\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tvar imgWidth = img.width,\r\n\t\t\t\t\timgHeight = img.height,\r\n\t\t\t\t\tdw = cw - imgWidth, \r\n\t\t\t\t\tdh = ch - imgHeight;\r\n\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(dw>=0 && dh>=0) {\r\n\t\t\t\t\tvar x = dw/2, y = dh/2;\r\n\t\t\t\t\tctx.drawImage(img, dw/2, dh/2);\r\n\t\t\t\t\tparams.fileWidth = imgWidth;\r\n\t\t\t\t\tparams.fileHeight = imgHeight;\r\n\t\t\t\t\tdata[1] = x;\r\n\t\t\t\t\tdata[2] = y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar cwhp = cw/ch, iwhp = img.width/img.height;\r\n\r\n\t\t\t\t\tif(cwhp>iwhp) {\r\n\t\t\t\t\t\tctx.drawImage(img, (cw-ch*iwhp)/2, 0, ch*iwhp, ch);\r\n\t\t\t\t\t\tparams.fileWidth = ch*iwhp;\r\n\t\t\t\t\t\tparams.fileHeight = ch;\r\n\t\t\t\t\t\tdata[1] = (cw-ch*iwhp)/2;\r\n\t\t\t\t\t\tdata[2] = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tctx.drawImage(img, 0, (ch-cw/iwhp)/2, cw, cw/iwhp);\r\n\t\t\t\t\t\tparams.fileWidth = cw;\r\n\t\t\t\t\t\tparams.fileHeight = cw/iwhp;\r\n\t\t\t\t\t\tdata[1] = 0;\r\n\t\t\t\t\t\tdata[2] = (ch-cw/iwhp)/2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = self.params.background;\r\n\t\t\tctx.fillStyle = self.params.background;\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.lineJoin = \"round\";\r\n\t\t\t\tctx.lineCap = \"round\";\r\n\t\t\t} else {\r\n\t\t\t\tctx.lineCap = \"square\";\r\n\t\t\t\tctx.lineJoin = \"bevel\";\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(scale, scale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tctx.lineWidth = point.size;\r\n\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar mouse = {\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = self.params.width/params.width,\r\n\t\t\t\thScale = self.params.height/params.height,\r\n\t\t\t\tscale = wScale<hScale?wScale:hScale,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tctx.scale(scale, scale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\">$LABEL$$DELETEBTN$</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\r\n\t\t\t\tdataMap = {},\r\n\t\t\t\tcanvasMap = {},\r\n\t\t\t\tactiveObj = {},\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, type, _data, id, del) {\r\n\t\t\t\tif(!canvas) return ;\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\t_id = id || (0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/\\$LABEL\\$/g, tabNameMap[type]).replace(/\\$DELETEBTN\\$/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(this===activeObj.tab) return ;\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tdel: del\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\r\n\t\t\t\tif(pageMap[_id]) {\r\n\t\t\t\t\tpageMap[_id].hide();\r\n\t\t\t\t\tdelete pageMap[_id];\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\t\t\t\t_id = idList[index-1>=0?index-1:0];\r\n\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id) {\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\r\n\t\t\t\tif(activeObj.canvas) {\r\n\t\t\t\t\tele.css(activeObj.canvas, \"zIndex\");\r\n\t\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\t\t\t\tself.mainCanvas = activeObj.canvas;\r\n\t\t\t\tele.css(activeObj.canvas, \"zIndex\", 2);\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(id) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===id) {\r\n\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\tself.container[activeObj.id].splitPage = 0;\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\t\tdelete pageMap[activeObj.id];\r\n\t\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdataMap[id].length = 0;\r\n\t\t\t\t\tself.container[id].splitPage = 0;\r\n\t\t\t\t\tcanvasMap[id].width = canvasMap[id].width;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].hide();\r\n\t\t\t\t\t\tdelete pageMap[id];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twindow.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4;\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\tself.go(pageNumber);\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, out) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t!out && that.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tthat.page = self;\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t\tdelete that.page;\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: that.params.width,\r\n\t\t\t\t\theight: that.params.height,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = currentPage;\r\n\t\t\t_data[currentPage-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[currentPage-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[currentPage-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\r\n\t\tif(show) {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\t\t\t_data.length>1 && pageWrap.appendChild(pageEle);\r\n\t\t\tself.go(1);\r\n\t\t}\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(params.onRender) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tparams.onRender(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t_data.width = that.mainCanvas.width;\r\n\t\t\t\t_data.height = that.mainCanvas.height;\r\n\r\n\t\t\t\tif(_data.status) {\r\n\t\t\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\t\tactiveTab.page.push.call(that, _data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.push.call(that, activeTab.id, _data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\t\t\t\t_data.width = that.mainCanvas.width;\r\n\t\t\t\t_data.height = that.mainCanvas.height;\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key],\r\n\t\t\t\t\ttype = val.type,\r\n\t\t\t\t\tval = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tdata.render.call(that, val);\r\n\r\n\t\t\t\t\tif(val.status) {\r\n\t\t\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\t\t\tactiveTab.page.push.call(that, val);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthat.tab.push.call(that, key, val);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(val.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, val, key);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, val);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, 1, [val], key, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key],\r\n\t\t\t\t\ttype = val.type,\r\n\t\t\t\t\tval = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(id) {\r\n\t\t\tthat.tab.clear.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\tthat.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id===activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number, true);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\tscrollWrapY = null,\r\n\t\t\tscrollWrapX = null,\r\n\t\t\tscrollY = null,\r\n\t\t\tscrollX = null,\r\n\t\t\ttoolbarStr = \"\";\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/\\$ITEM\\$/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/\\$ICONCLASS\\$/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/\\$TITLE\\$/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/\\$LEVEL\\$/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/\\$CHILDTOOLBARS\\$/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/\\$ITEM\\$/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/\\$ICONCLASS\\$/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/\\$TITLE\\$/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/\\$CHILDTOOLBARS\\$/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/\\$LEVEL\\$/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/\\$CHILDTOOLBARITEM\\$/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tvar __str__ = tpl1.replace(/\\$LAYOUT\\$/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\")).replace(/\\$TOOLBARS\\$/g, toolbarStr).replace(/\\$DISABLED\\$/g, params.disable?\"disabled\":\"\");\r\n\t\tvar _data = params.data || JSON.parse(window.localStorage.getItem(self.id+\"_pad\"));\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar\tcanvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tscrollWrapX = wrap.getElementsByClassName(\"scroll-x-wrap\")[0];\r\n\t\tscrollWrapY = wrap.getElementsByClassName(\"scroll-y-wrap\")[0];\r\n\t\tscrollX = scrollWrapX.getElementsByClassName(\"scroll-x\")[0];\r\n\t\tscrollY = scrollWrapY.getElementsByClassName(\"scroll-y\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\tvar resizePad = null, isFixedSize = false;\r\n\r\n\t\tif(params.size && /\\*/.test(params.size)) {\r\n\t\t\tvar sizeArr = params.size.split(/\\*/);\r\n\t\t\tisFixedSize = true;\r\n\r\n\t\t\tif(2!=sizeArr.length) {\r\n\t\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, \r\n\t\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\t\t\t} else {\r\n\t\t\t\tvar canvasWrapWidth = isNaN(sizeArr[0])?canvasWrap.clientWidth:sizeArr[0],\r\n\t\t\t\t\tcanvasWrapHeight = isNaN(sizeArr[1])?canvasWrap.clientHeight:sizeArr[1];\r\n\t\t\t}\r\n\r\n\t\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\tcanvasWrap.scrollTop = canvasWrap.scrollTop + (\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY));\r\n\t\t\t\tscrollY.style.top = (scrollWrapY.clientHeight - scrollY.offsetHeight)*(canvasWrap.scrollTop/(canvasWrap.scrollHeight - canvasWrap.clientHeight)) + \"px\";\r\n\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tscroll.init(scrollX, 0, function(val) {\r\n\t\t\t\tvar rect = scrollWrapX.getBoundingClientRect(),\r\n\t\t\t\t\tmoveDest = rect.width - scrollX.offsetWidth,\r\n\t\t\t\t\thideWidth = canvasWrap.scrollWidth - canvasWrap.offsetWidth;\r\n\r\n\t\t\t\tcanvasWrap.scrollLeft = val*(hideWidth/moveDest);\r\n\t\t\t});\r\n\r\n\t\t\tscroll.init(scrollY, 1, function(val) {\r\n\t\t\t\tvar rect = scrollWrapY.getBoundingClientRect(),\r\n\t\t\t\t\tmoveDest = rect.height - scrollY.offsetHeight,\r\n\t\t\t\t\thideHeight = canvasWrap.scrollHeight - canvasWrap.offsetHeight;\r\n\r\n\t\t\t\tcanvasWrap.scrollTop = val*(hideHeight/moveDest);\r\n\t\t\t});\r\n\r\n\t\t\tresizePad = function() {\r\n\t\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\tif(canvasWrapWidth<params.width) {\r\n\t\t\t\t\tele.removeClass(scrollWrapX, \"pad-hide\");\r\n\t\t\t\t\tvar scrollWidth = canvasWrapWidth - (params.width - canvasWrapWidth);\r\n\t\t\t\t\tscrollWidth = scrollWidth<10?10:scrollWidth;\r\n\t\t\t\t\tscrollX.style.width = scrollWidth + \"px\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tele.addClass(scrollWrapX, \"pad-hide\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(canvasWrapHeight<params.height) {\r\n\t\t\t\t\tele.removeClass(scrollWrapY, \"pad-hide\");\r\n\t\t\t\t\tvar scrollHeight = canvasWrapHeight - (params.height - canvasWrapHeight);\r\n\t\t\t\t\tscrollHeight = scrollHeight<10?10:scrollHeight;\r\n\t\t\t\t\tscrollY.style.height = scrollHeight + \"px\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tele.addClass(scrollWrapY, \"pad-hide\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, \r\n\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tresizePad = function() {\r\n\t\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, \r\n\t\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\tif(canvasWrapWidth!=params.width || canvasWrapHeight!=params.height) {\r\n\t\t\t\t\tparams.width = canvasWrapWidth;\r\n\t\t\t\t\tparams.height = canvasWrapHeight;\r\n\t\t\t\t\tmainCanvas.width = canvasWrapWidth;\r\n\t\t\t\t\tmainCanvas.height = canvasWrapHeight;\r\n\t\t\t\t\tbufferCanvas1.width = canvasWrapWidth;\r\n\t\t\t\t\tbufferCanvas1.height = canvasWrapHeight;\r\n\t\t\t\t\tbufferCanvas2.width = canvasWrapWidth;\r\n\t\t\t\t\tbufferCanvas2.height = canvasWrapHeight;\r\n\t\t\t\t\tbufferCanvas3.width = canvasWrapWidth;\r\n\t\t\t\t\tbufferCanvas3.height = canvasWrapHeight;\r\n\t\t\t\t\tbufferCanvas4.width = canvasWrapWidth;\r\n\t\t\t\t\tbufferCanvas4.height = canvasWrapHeight;\r\n\r\n\t\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\t\r\n\t\tmainCanvas.width = canvasWrapWidth;\r\n\t\tmainCanvas.height = canvasWrapHeight;\r\n\t\tbufferCanvas1.width = canvasWrapWidth;\r\n\t\tbufferCanvas1.height = canvasWrapHeight;\r\n\t\tbufferCanvas2.width = canvasWrapWidth;\r\n\t\tbufferCanvas2.height = canvasWrapHeight;\r\n\t\tbufferCanvas3.width = canvasWrapWidth;\r\n\t\tbufferCanvas3.height = canvasWrapHeight;\r\n\t\tbufferCanvas4.width = canvasWrapWidth;\r\n\t\tbufferCanvas4.height = canvasWrapHeight;\r\n\t\tparams.width = canvasWrapWidth;\r\n\t\tparams.height = canvasWrapHeight;\r\n\t\tisFixedSize && resizePad();\r\n\r\n\t\tele.addEvent(window, \"resize\", function() {\r\n\t\t\tresizePad();\r\n\t\t});\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tele.css(mainCanvas, \"background\", self.params.background);\r\n\t\tele.css(bufferCanvas4, \"background\", self.params.background);\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = params.from,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tself.pad.clear();\r\n\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar _tab = {id:tabId, name:tabName};\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, 1, null, tabId, from===self.params.id);\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tself.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t_showFiles();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tparams.onClear && \"[object Function]\"===toString.call(params.onClear) && params.onClear(self.tab.getActive().id);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\tvar image = self.mainCanvas.toDataURL().replace(/image\\/png/, \"image/octet-stream;Content-Disposition:attachment;filename=\"+data.uuid+\".png\");\r\n\t\t\t\tlocation.href = image;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tif(!current) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\titem = current.name.toLowerCase(),\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(handPad || active) {\r\n\t\t\t\tswitch(item) {\r\n\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t}\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tactive = true;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.bufferRender && current.bufferRender.call(self, pos, true);\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tbufferCanvas1.width = bufferCanvas1.width;\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, 0);\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key];\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, val.type, val.data, key, val.del);\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0===val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"eraser\", data: [], status: 0, origin: !!origin, mode: modeMap[self.current.name], from: self.params.id, width: self.params.width, height: self.params.height}:self.current.interimBuffer.pop();\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\r\n\t\tarrow: 1\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\r\n\t\trect: 1\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\r\n\t\troundel: 1,\r\n\t\tellipesstroke: 2,\r\n\t\tellipes: 3\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; left: \" + data.x + \"px; top: \" + (data.y-self.textInput.offsetHeight/2) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.params.width, height: self.params.height};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}