{"version":3,"sources":["node_modules/_browser-pack@6.0.3@browser-pack/_prelude.js","js/eraser.js","js/ferula.js","js/image.js","js/index.js","js/line.js","js/pen.js","js/rectangle.js","js/round.js","js/text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modeMap","circular","quadrate","pos","lastPoint","Eraser","params","this","name","interimBuffer","buffer","prototype","constructor","active","mouseRender","data","self","type","x","y","eraserSize","mode","current","from","id","width","mainCanvas","offsetWidth","height","offsetHeight","largen","cw","clientWidth","ch","clientHeight","Math","min","apply","lesser","max","bufferRender","_data","origin","status","ex","ey","size","push","render","destory","vm","window","eraser","Ferula","ferula","Image","renderBuffer","that","toolbarMap","image","shift","concat","toString","Object","URL","webkitURL","padMap","padCount","padTab","isMobile","test","navigator","userAgent","isFireFox","eventMap","click","down","move","up","wheel","layoutClassMap","leftTop","rightTop","rightBottom","leftBottom","defaultConfig","noCache","noTab","noToolbar","layout","fontSize","vertical","disable","wrap","document","body","autoSaveTime","saveImgStep","color","background","ferulaSize","toolbars","childToolbars","rectangle","line","round","titles","circle","roundel","ellipesstroke","rectstroke","pen","rect","ellipes","text","arrow","export","scissors","clear","classes","tabNameMap","0","tpl1","tpl2","tpl3","tpl5","addEventListener","target","fn","use","delEvent","detachEvent","addClass","ele","className","RegExp","reg","replace","previousElementSibling","previousSibling","nextNode","css","attrName","attrValue","scroll","scrolls","createElement","xTpl","Scroll","activeType","node","parentNode","events","scrollObj","scrollBuilder","tplDiv","innerHTML","yTpl","removeChild","firstChild","appendChild","toolbar","getElementsByClassName","scrollHeight","classList","remove","defineProperty","set","d","get","mousemoveHandler","obj","args","event","clientX","distance","startPoint","scale","moveWidth","coverWidth","clientY","moveHeight","coverHeight","mouseupHandler","addEvent","slice","arguments","param","container","offsetLeft","style","left","scrollLeft","offsetTop","top","scrollTop","fire","resize","scrollWidth","add","eventName","splice","indexOf","forEach","create","uuid","val","scaleWidth","scaleHeight","isNaN","firstArg","arg","_type","key","copy","item","index","saveAsImage","count","arr","file","len","activeTab","tab","getActive","next","list","imgData","createImageCanvas","toDataURL","_data_","page","pageNumber","getPageNumber","saveData","_createImage","pop","trim","content","keys","sort","b","renderPen","callback","isCreateImage","canvas","bufferCanvas","wScale","hScale","ctx","getContext","strokeStyle","lineWidth","point","beginPath","lineTo","stroke","restore","renderRect","strokeRect","fillStyle","fillRect","moveTo","angle","atan2","PI","angle1","topx","cos","topy","sin","botx","angle2","boty","save","arc","fill","scaleX","scaleY","closePath","font","fillText","fileCanvas","img","tplImage","cWidth","cHeight","src","imgWidth","imgHeight","resizePadPixel","drawImage","delete","atan","x1","y1","x2","y2","x3","y3","x4","y4","clip","clearRect","renderLine","renderRound","renderText","renderImage","mouseIconCanvas","px","py","mouse","Tab","canvasMap","build","_tab","_tabTpl","tabTpl","del","delTpl","UL","_id","li","firstElementChild","tabMap","getElementsByTagName","cancelBubble","preventDefault","onTabRemove","activeObj","onTabChange","tabWrap","dataMap","splitPage","tabName","saving","it","setTimeout","pageMap","getData","clearTimeout","idList","localStorage","setItem","JSON","stringify","removeClass","toOrigin","show","getTab","tabId","cleanCache","removeItem","getPage","outData","Page","currentPage","pageEle","div","prePageBtn","pre","total","goPageBtn","pageNumberInput","value","go","onPageTurn","$1","keyCode","which","start","__data","some","flag","nextPageBtn","pageWrap","splitpageLayout","right","hide","empower","WPad","setAttribute","waitList","onRender","onMousemove","fr","FileReader","isFullScreen","exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","colorInput","bufferCanvas4","_toolbar","_childToolbars","_tpl2","childToolbarStr","toolbarStr","fullScreen","__str__","parse","getItem","canvasWrap","toolbarWrap","createSize","canvasWrapWidth","canvasWrapHeight","$2","_canvasWrapWidth","_canvasWrapHeight","returnValue","detail","oldAvilWidth","oldAvilHeight","avilWidth","avilHeight","resizePad","w","h","bufferCanvas1","bufferCanvas2","bufferCanvas3","textInput","init","onScroll","fullScreenBtn","pad","showFiles","files","newTab","isShow","_showFiles","pageObj","setPage","onShowFiles","onload","result","fileInput","readAsDataURL","shiftKey","span","srcElement","level","getAttribute","handPad","removeAttribute","downloadEle","imageDataArr","split","bStr","atob","tArr","Uint8ClampedArray","charCodeAt","href","url","download","revokeObjectURL","exportImage","curActiveNode","lastSpan","curActiveChildNode","parentSpan","preNode","title","match","stopPropagation","mouseX","mouseY","targetTouches","getBoundingClientRect","posY","toLowerCase","moveX","posX","moveY","_n","realData","renderAll","dataArr","renderMouse","console","error","enable","createImage","turnPage","number","removeTab","wPad","_params","getPadById","getPadByIndex","5","Line","points","6","Pen","7","Rectangle","8","Round","originX","xc","yc","originY","abs","9","Text","cssText","focus"],"mappings":"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","file":"index.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: eraser.js\r\n * describe: 橡皮擦\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tcircular: 0,\r\n\t\tquadrate: 1\r\n\t};\r\n\r\n\tvar pos = null,\r\n\t\tlastPoint = null;\r\n\r\n\tfunction Eraser(params) {\r\n\t\tthis.name = params.name || \"Eraser\";\r\n\t\t// 存储临时数据\r\n\t\tthis.interimBuffer = [];\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tEraser.prototype = {\r\n\t\tconstructor: Eraser,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"eraser\", data: [data.x, data.y, self.params.eraserSize], mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\t// 橡皮擦放大接口\r\n\t\tlargen: function() {\r\n\t\t\tvar self = this,\r\n\t\t\t\teraserSize = self.params.eraserSize,\r\n\t\t\t\tcw = self.mainCanvas.clientWidth,\r\n\t\t\t\tch = self.mainCanvas.clientHeight;\r\n\r\n\t\t\teraserSize++;\r\n\t\t\tself.params.eraserSize = Math.min.apply(Math, [eraserSize, cw, ch]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 橡皮擦缩小接口\r\n\t\tlesser: function() {\r\n\t\t\tvar self = this, eraserSize = self.params.eraserSize;\r\n\t\t\teraserSize--;\r\n\t\t\tself.params.eraserSize = Math.max.apply(Math, [5, eraserSize]);\r\n\t\t\tpos.data[2] = self.params.eraserSize;\r\n\t\t\tself.mouseRender.call(self, pos);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// 橡皮擦功能较为特殊，直接绘制到持久画板上\r\n\t\t// status = 1\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = {type: \"eraser\", data: [], status: 1, origin: true, mode: modeMap[self.current.name], from: self.params.id, width: self.mainCanvas.width, height: self.mainCanvas.height};\r\n\t\t\t\r\n\t\t\tif(!origin && lastPoint) {\r\n\t\t\t\t_data.ex = lastPoint.x;\r\n\t\t\t\t_data.ey = lastPoint.y;\r\n\t\t\t} else {\r\n\t\t\t\t_data.ex = _data.x;\r\n\t\t\t\t_data.ey = _data.y;\r\n\t\t\t}\r\n\r\n\t\t\t_data.size = self.params.eraserSize;\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.render(data);\r\n\t\t\tlastPoint = _data;\r\n\t\t},\r\n\t\t// 舍弃\r\n\t\trender: function() {\r\n\t\t\treturn ;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.eraser = Eraser;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: ferula.js\r\n * describe: 教鞭\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar pos = null;\r\n\r\n\tfunction Ferula(params) {\r\n\t\tthis.name = params.name || \"Ferula\";\r\n\t\t// 存储持久数据\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tFerula.prototype = {\r\n\t\tconstructor: Ferula,\r\n\t\tactive: function() {},\r\n\t\t// 鼠标绘制接口\r\n\t\tmouseRender: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tdata = {type: \"ferula\", data: [data.x, data.y], from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\tpos = data;\r\n\t\t\tself.mouseRender.call(self, data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this;\r\n\t\t\tself.current.mouseRender.call(self, {x: -1, y: -1});\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.ferula = Ferula;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: image.js\r\n * describe: 演示图片\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Image(params) {\r\n\t\tthis.name = params.name || \"Image\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tImage.prototype = {\r\n\t\tconstructor: Image,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\trenderBuffer: function(data) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar data = {type: \"image\", data: [data], status: 0, origin: true, from: self.params.id, width: that.mainCanvas.offsetWidth, height: that.mainCanvas.offsetHeight};\r\n\t\t\tself.toolbarMap.image.interimBuffer.push(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(_data) {\r\n\t\t\tif(!_data) return ;\r\n\t\t\tvar self = this, data = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tdata.data = [].concat.apply(data.data, _data);\r\n\t\t\t\tself.toolbarMap.image.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.toolbarMap.image.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.image = Image;\r\n\twindow.vm = vm;\r\n}());",";(function() {\r\n\t\"use strict\";\r\n\tvar vm = window.vm || {},\r\n\t\ttoString = Object.prototype.toString,\r\n\t\tURL = window.URL || window.webkitURL,\r\n\t\tpadMap = {},\r\n\t\tpadCount = 0,\r\n\t\tpadTab = [],\r\n\t\tisMobile = /(\\bmobile\\b|\\bandroid\\b)/i.test(navigator.userAgent),\r\n\t\tisFireFox = /\\bfirefox\\b/i.test(navigator.userAgent),\r\n\t\t// 事件名map，PC端和移动端需要对应不同的事件名\r\n\t\teventMap = {\r\n\t\t\tclick: isMobile?\"touchend\":\"click\",\r\n\t\t\tdown: isMobile?\"touchstart\":\"mousedown\",\r\n\t\t\tmove: isMobile?\"touchmove\":\"mousemove\",\r\n\t\t\tup: isMobile?\"touchend\":\"mouseup\",\r\n\t\t\twheel: isFireFox?\"DOMMouseScroll\":\"mousewheel\"\r\n\t\t},\r\n\t\t// 工具栏不同的布局对应的className\r\n\t\tlayoutClassMap = {\r\n\t\t\tleftTop: \"left-top\",\r\n\t\t\trightTop: \"right-top\",\r\n\t\t\trightBottom: \"right-bottom\",\r\n\t\t\tleftBottom: \"left-bottom\"\r\n\t\t},\r\n\t\t// 默认的白板初始化参数\r\n\t\t// ferula, ellipesstroke, rectstroke, pen, eraser, rect, ellipes, text, line, arrow, color, export, scissors, clear, enlarge, file, handPad\r\n\t\tdefaultConfig = {\r\n\t\t\tdata: null,\r\n\t\t\tnoCache: false,\r\n\t\t\tnoTab: false,\r\n\t\t\tnoToolbar: false,\r\n\t\t\tlayout: \"leftTop\",\r\n\t\t\tsize: \"100%\",\r\n\t\t\tfontSize: 16,\r\n\t\t\tvertical: false,\r\n\t\t\tdisable: false,\r\n\t\t\twrap: document.body,\r\n\t\t\tautoSaveTime: 10,\r\n\t\t\tsaveImgStep: 5,\r\n\t\t\tcolor: \"#000\",\r\n\t\t\tbackground: \"#fff\",\r\n\t\t\teraserSize: 5,\r\n\t\t\tferulaSize: 5,\r\n\t\t\ttoolbars: isMobile?[\"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\"]:[\"ferula\", \"pen\", \"line\", \"rectangle\", \"round\", \"text\", \"image\", \"eraser\", \"export\", \"clear\", \"color\"]\r\n\t\t},\r\n\t\tchildToolbars = {\r\n\t\t\trectangle: [\"rectstroke\", \"rect\"],\r\n\t\t\tline: [\"line\", \"arrow\"],\r\n\t\t\tround: [\"circle\", \"roundel\", \"ellipesstroke\", \"ellipes\"],\r\n\t\t\teraser: [\"circular\", \"quadrate\"]\r\n\t\t},\r\n\t\t// 不同工具对应的名称\r\n\t\ttitles = {\r\n\t\t\tferula: \"教鞭\",\r\n\t\t\tcircle: \"空心圆\",\r\n\t\t\troundel: \"实心圆\",\r\n\t\t\tellipesstroke: \"空心椭圆\", \r\n\t\t\trectstroke: \"空心矩形\", \r\n\t\t\tpen: \"画笔\",\r\n\t\t\tcircular: \"圆形橡皮擦\",\r\n\t\t\tquadrate: \"方形橡皮擦\",\r\n\t\t\trect:'实心矩形',\r\n\t\t\tellipes: '实心椭圆',\r\n\t\t\ttext: \"文本\",\r\n\t\t\tline: \"直线\", \r\n\t\t\tarrow: \"箭头\", \r\n\t\t\tcolor: \"颜色\", \r\n\t\t\texport: \"导出\", \r\n\t\t\tscissors:\"截图\",\r\n\t\t\tclear: \"清空\",\r\n\t\t\timage: \"图片\"\r\n\t\t},\r\n\t\t// 不同工具对应的icon的className\r\n\t\tclasses = {\r\n\t\t\tferula: \"icon-teach-rod\",\r\n\t\t\tcircle: \"icon-round-a\",\r\n\t\t\troundel: \"icon-round-c\",\r\n\t\t\tellipesstroke: \"icon-ellipse-b\",\r\n\t\t\trectstroke: \"icon-rectangle-a\",\r\n\t\t\tpen: \"icon-pen\",\r\n\t\t\tcircular: \"icon-xiangpica\",\r\n\t\t\tquadrate: \"icon-rubber\",\r\n\t\t\trect: \"icon-rectangle-c\",\r\n\t\t\tellipes: \"icon-ellipse-a\",\r\n\t\t\ttext: \"icon-font\",\r\n\t\t\tline: \"icon-line\",\r\n\t\t\tarrow: \"icon-arrow\",\r\n\t\t\tcolor: \"icon-colour\",\r\n\t\t\texport: \"icon-keep\",\r\n\t\t\tscissors: \"icon-screenshot\",\r\n\t\t\tclear: \"icon-empty\",\r\n\t\t\timage: \"icon-pic\"\r\n\t\t},\r\n\t\t// 白板tab的默认名称\r\n\t\ttabNameMap = {\r\n\t\t\t0: \"白板\",\r\n\t\t\t1: \"文档演示\"\r\n\t\t};\r\n\r\n// ==============================================================模板===============================================================\r\n\tvar tpl1 = '\\\r\n\t\t<div class=\"pad-wrap @LAYOUT@ @DISABLED@ @NOTOOLBAR@ @NOTAB@\">\\\r\n\t\t\t<div class=\"toolbar-wrap\">\\\r\n\t\t\t\t<ul class=\"toolbar-list\">@TOOLBARS@</ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"can-wrap-outer\">\\\r\n\t\t\t\t<div class=\"can-wrap\">\\\r\n\t\t\t\t\t<input type=\"text\" class=\"text-input tool-input\"/>\\\r\n\t\t\t\t\t<canvas class=\"main-can\">抱歉！您的浏览器版本太低，暂时不支持此白板！</canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-4\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-3\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-2\"></canvas>\\\r\n\t\t\t\t\t<canvas class=\"buffer-can-1\"></canvas>\\\r\n\t\t\t\t</div>\\\r\n\t\t\t\t<div class=\"split-page-wrap\"></div>\\\r\n\t\t\t</div>\\\r\n\t\t\t<div class=\"pad-tab-wrap\">\\\r\n\t\t\t\t<ul class=\"pad-tab-list\"></ul>\\\r\n\t\t\t</div>\\\r\n\t\t\t<input type=\"file\" accept=\"image/png, image/jpeg\" class=\"file-input tool-input\"/>\\\r\n\t\t\t<input type=\"color\" class=\"color-input tool-input\"/>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl2 = '<li class=\"toolbar-item\" title=\"@TITLE@\"><span class=\"item-icon iconfont @ICONCLASS@\" item=\"@ITEM@\" level=\"@LEVEL@\"></span>@CHILDTOOLBARS@</li>';\r\n\r\n\tvar tpl3 = '<ul class=\"child-toolbar-list\">@CHILDTOOLBARITEM@</ul>';\r\n\r\n\tvar tpl4 = '\\\r\n\t\t<div>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"pre-page-btn iconfont icon-zuofanye\"></a>\\\r\n\t\t\t<a href=\"javascript:void(0);\" class=\"next-page-btn iconfont icon-youfanye\"></a>\\\r\n\t\t\t<span><input type=\"text\" class=\"page-number-input\"/>/@TOTAL@<a href=\"javascript:void(0);\" class=\"go-page-btn\">GO</a></span>\\\r\n\t\t</div>';\r\n\r\n\tvar tpl5 = '<li class=\"toolbar-item full-screen-btn-wrap\"><span class=\"item-icon full-screen-btn iconfont icon-enlarge\" item=\"fullScreen\"></span></li>';\r\n// ==============================================================模板===============================================================\r\n\r\n\tvm.module = vm.module || {};\r\n\r\n\t// 这里创建一个ele对象，此对象下都是对dom节点进行操作的接口\r\n\t// 目地是方便后面的调用\r\n\tvar ele = {\r\n\t\t// 对dom节点绑定事件\r\n\t\taddEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.addEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.attachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 移除dom节点上的事件\r\n\t\tdelEvent: window.addEventListener?function(target, type, fn, use) {\r\n\t\t\ttarget.removeEventListener(type, fn, use||false);\r\n\t\t}:function(target, type, fn) {\r\n\t\t\ttarget.detachEvent(\"on\"+type, fn);\r\n\t\t},\r\n\t\t// 为dom节点添加一个指定的类名\r\n\t\taddClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(!reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className + \" \" + className;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 移除dom节点上指定的类名\r\n\t\tremoveClass: function(ele, className) {\r\n\t\t\tif(ele===void(0) || className===void(0)) return ;\r\n\t\t\tvar reg = new RegExp(\"\\\\b\"+className+\"\\\\b\", \"g\");\r\n\r\n\t\t\tif(reg.test(ele.className)) {\r\n\t\t\t\tele.className = ele.className.replace(reg, \"\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取指定dom节点的前一个节点\r\n\t\tpreNode: function(ele) {\r\n\t\t\treturn ele.previousElementSibling || ele.previousSibling;\r\n\t\t},\r\n\t\t// 获取指定dom节点的下一个节点\r\n\t\tnextNode: function(ele) {\r\n\t\t\treturn ele.nextElementSibling || ele.nextSibling;\r\n\t\t},\r\n\t\t// 为dom节点添加样式\r\n\t\tcss: function(ele, attrName, attrValue) {\r\n\t\t\tele.style[attrName] = attrValue || \"\";\r\n\t\t}\r\n\t};\r\n\r\n\t// 滚动条模块\r\n\t// 如果创建白板时，为白板指定了固定大小，且白板大小大于当前放置白板的容器时会创建滚动条\r\n\tvar scroll = (function() {\r\n\t\tvar scrolls = [],\r\n\t\t\ttplDiv = document.createElement(\"DIV\"),\r\n\t\t\txTpl = '<div class=\"scroll-x-wrap pad-hide\"><span class=\"scroll-x scroll-toolbar\"></span></div>',\r\n\t\t\tyTpl = '<div class=\"scroll-y-wrap pad-hide\"><span class=\"scroll-y scroll-toolbar\"></span></div>';\r\n\r\n\t\tfunction Scroll(params) {\r\n\t\t\tif(!(this instanceof Scroll)) {\r\n\t\t\t\treturn new Scroll(params);\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this,\r\n\t\t\t\tdisable = false,\r\n\t\t\t\tactiveType = \"x\",\r\n\t\t\t\tstartPoint = {x: 0, y: 0},\r\n\t\t\t\tparentNode = params.node.parentNode;\r\n\r\n\t\t\tself.params = params;\r\n\t\t\tself.events = {};\r\n\t\t\tself.scrollObj = {};\r\n\r\n\t\t\tvar scrollBuilder = function(type) {\r\n\t\t\t\ttplDiv.innerHTML = \"x\"===type?xTpl:yTpl;\r\n\t\t\t\tvar ele = tplDiv.removeChild(tplDiv.firstChild);\r\n\t\t\t\tparentNode.appendChild(ele);\r\n\r\n\t\t\t\tself.scrollObj[type] = {\r\n\t\t\t\t\tcontainer: ele,\r\n\t\t\t\t\ttoolbar: ele.getElementsByClassName(\"scroll-toolbar\")[0]\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\tparams.node.clientWidth<params.node.scrollWidth && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparams.node.clientHeight<params.node.scrollHeight && ele.classList.remove(\"pad-hide\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tObject.defineProperty(this, \"disable\", {\r\n\t\t\t\tset: function(d) {\r\n\t\t\t\t\tdisable = d;\r\n\t\t\t\t},\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn disable;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif(!params.type) {\r\n\t\t\t\tscrollBuilder(\"x\");\r\n\t\t\t\tscrollBuilder(\"y\");\r\n\t\t\t} else {\r\n\t\t\t\tscrollBuilder(params.type);\r\n\t\t\t}\r\n\r\n\t\t\tvar mousemoveHandler = function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\tobj = self.scrollObj[activeType],\r\n\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\tif(\"x\"===activeType) {\r\n\t\t\t\t\tvar x = e.x || e.clientX, data = {type: \"x\", distance: x-startPoint.x, from: params.id, scale: obj.moveWidth/obj.coverWidth};\r\n\t\t\t\t\tstartPoint.x = x;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar y = e.y || e.clientY, data = {type: \"y\", distance: y-startPoint.y, from: params.id, scale: obj.moveHeight/obj.coverHeight};\r\n\t\t\t\t\tstartPoint.y = y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.scroll(data);\r\n\t\t\t};\r\n\r\n\t\t\tvar mouseupHandler = function() {\r\n\t\t\t\tele.delEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\tele.delEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t};\r\n\r\n\t\t\tif(self.scrollObj.x) {\r\n\t\t\t\tele.addEvent(self.scrollObj.x.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.x = e.x || e.clientX;\r\n\t\t\t\t\tactiveType = \"x\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(self.scrollObj.y) {\r\n\t\t\t\tele.addEvent(self.scrollObj.y.toolbar, \"mousedown\", function() {\r\n\t\t\t\t\tif(disable) return ;\r\n\r\n\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\t\t\tstartPoint.y = e.y || e.clientY;\r\n\t\t\t\t\tactiveType = \"y\";\r\n\t\t\t\t\tele.addEvent(document, \"mousemove\", mousemoveHandler);\r\n\t\t\t\t\tele.addEvent(document, \"mouseup\", mouseupHandler);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tScroll.prototype = {\r\n\t\t\tconstructor: Scroll,\r\n\t\t\tscroll: function(param) {\r\n\t\t\t\tvar params = this.params,\r\n\t\t\t\t\tobj = this.scrollObj[param.type],\r\n\t\t\t\t\tcontainer = obj.container,\r\n\t\t\t\t\ttoolbar = obj.toolbar;\r\n\r\n\t\t\t\tif(\"x\"===param.type) {\r\n\t\t\t\t\tvar offsetLeft = toolbar.offsetLeft + param.distance;\r\n\t\t\t\t\ttoolbar.style.left = Math.max(0, Math.min(offsetLeft, container.clientWidth - toolbar.offsetWidth)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollLeft = params.node.scrollLeft + (param.distance/(obj.moveWidth/obj.coverWidth))/((obj.moveWidth/obj.coverWidth)/param.scale);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar offsetTop = toolbar.offsetTop + param.distance;\r\n\t\t\t\t\ttoolbar.style.top = Math.max(0, Math.min(offsetTop, container.clientHeight - toolbar.offsetHeight)) + \"px\";\r\n\t\t\t\t\tparams.node.scrollTop = params.node.scrollTop + (param.distance/(obj.moveHeight/obj.coverHeight))/((obj.moveHeight/obj.coverHeight)/param.scale);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(void(0)==this.params.id || param.from==this.params.id) {\r\n\t\t\t\t\tthis.fire(\"scroll\", param);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttoOrigin: function(type) {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(!type) {\r\n\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"x\"===type) {\r\n\t\t\t\t\t\tthis.scrollObj.x.toolbar.style.left = 0;\r\n\t\t\t\t\t\tparams.node.scrollLeft = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.scrollObj.y.toolbar.style.top = 0;\r\n\t\t\t\t\t\tparams.node.scrollTop = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tvar params = this.params;\r\n\r\n\t\t\t\tif(this.scrollObj.x) {\r\n\t\t\t\t\tvar obj = this.scrollObj.x,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverWidth = params.node.scrollWidth - params.node.clientWidth;\r\n\t\t\t\t\t\r\n\t\t\t\t\ttoolbar.style.width = Math.max(obj.container.clientWidth - coverWidth/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverWidth = coverWidth;\r\n\t\t\t\t\tobj.moveWidth = obj.container.clientWidth - toolbar.offsetWidth;\r\n\r\n\t\t\t\t\tif(0===obj.moveWidth) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.scrollObj.y) {\r\n\t\t\t\t\tvar obj = this.scrollObj.y,\r\n\t\t\t\t\t\ttoolbar = obj.toolbar,\r\n\t\t\t\t\t\tcoverHeight = params.node.scrollHeight - params.node.clientHeight;\r\n\r\n\t\t\t\t\ttoolbar.style.height = Math.max(obj.container.clientHeight - coverHeight/10, 50) + \"px\";\r\n\t\t\t\t\tobj.coverHeight = coverHeight;\r\n\t\t\t\t\tobj.moveHeight = obj.container.clientHeight - toolbar.offsetHeight;\r\n\r\n\t\t\t\t\tif(0===obj.moveHeight) {\r\n\t\t\t\t\t\tobj.container.classList.add(\"pad-hide\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj.container.classList.remove(\"pad-hide\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(!events[eventName]) {\r\n\t\t\t\t\tevents[eventName] = [fn];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[eventName].push(fn);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdelEvent: function(eventName, fn) {\r\n\t\t\t\tvar events = this.events;\r\n\r\n\t\t\t\tif(\"[object Function]\"===toString.call(fn)) {\r\n\t\t\t\t\tevents[eventName].splice(events[eventName].indexOf(fn), 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete events[eventName];\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfire: function() {\r\n\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\teventName = args.shift(),\r\n\t\t\t\t\tevents = this.events;\r\n\r\n\t\t\t\tevents[eventName] && events[eventName].forEach(function(fn) {\r\n\t\t\t\t\t\"[object Function]\"===toString.call(fn) && fn.apply(Object.create(null), args);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tinit: function(params) {\r\n\t\t\t\tif(!params.node) return ;\r\n\t\t\t\tvar scrollObj = new Scroll(params);\r\n\t\t\t\tscrolls.push(scrollObj);\r\n\t\t\t\treturn scrollObj;\r\n\t\t\t},\r\n\t\t\tresize: function() {\r\n\t\t\t\tscrolls.forEach(function(scrollObj) {\r\n\t\t\t\t\tscrollObj.resize();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t}());\r\n\r\n\t// 数据对象\r\n\t// 这里是对所有进行数据处理的接口进行了归总\r\n\tvar data = {\r\n\t\t// 生成uuid\r\n\t\tget uuid() {\r\n\t\t\treturn Date.now();\r\n\t\t},\r\n\t\t// 对白板数进行缩放\r\n\t\t// 主要应对白板的缩放后的重绘及从一个白板传递到另一个白板的数据\r\n\t\tscale: function(_data) {\r\n\t\t\tvar that = this,\r\n\t\t\t\tval = _data,\r\n\t\t\t\ttype = val.type,\r\n\t\t\t\tscaleWidth = null,\r\n\t\t\t\tscaleHeight = null;\r\n\r\n\t\t\tif(!scaleWidth || !scaleHeight) {\r\n\t\t\t\tscaleWidth = that.mainCanvas.width/val.width;\r\n\t\t\t\tscaleHeight = that.mainCanvas.height/val.height;\r\n\t\t\t}\r\n\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tval.data[0] = val.data[0] * scaleWidth;\r\n\t\t\t\tval.data[1] = val.data[1] * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tval.data.x = val.data.x * scaleWidth;\r\n\t\t\t\tval.data.y = val.data.y * scaleHeight;\r\n\t\t\t\tval.data.size = val.data.size * scaleWidth;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(val.data[0]) val.data[0] = !isNaN(val.data[0])?val.data[0] * scaleWidth:val.data[0];\r\n\t\t\t\tif(val.data[1]) val.data[1] = !isNaN(val.data[1])?val.data[1] * scaleWidth:val.data[1];\r\n\t\t\t\tif(val.data[2]) val.data[2] = !isNaN(val.data[2])?val.data[2] * scaleWidth:val.data[2];\r\n\t\t\t\tif(val.data[3]) val.data[3] = !isNaN(val.data[3])?val.data[3] * scaleWidth:val.data[3];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 数据深拷贝\r\n\t\tcopy: function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\tfirstArg = args.shift(),\r\n\t\t\t\tlen = args.length;\r\n\r\n\t\t\tif(len) {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) return firstArg;\r\n\r\n\t\t\t\targs.forEach(function(arg) {\r\n\t\t\t\t\tvar _type = toString.call(arg);\r\n\t\t\t\t\tif(\"[object Object]\"!=_type && \"[object Array]\"!=_type) return ;\r\n\r\n\t\t\t\t\tif(\"[object Object]\"===_type) {\r\n\r\n\t\t\t\t\t\tif(\"[object Array]\"===type) {\r\n\t\t\t\t\t\t\tvar container = {};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor(var key in arg) {\r\n\t\t\t\t\t\t\tvar val = arg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[key] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(container) {\r\n\t\t\t\t\t\t\tfirstArg.push(container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targ.forEach(function(item, index) {\r\n\t\t\t\t\t\t\tvar _type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = data.copy(val);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg[index] = val;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(\"[object Object]\"===_type || \"[object Array]\"===_type) {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(data.copy(val));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tfirstArg.push(val);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn firstArg;\r\n\t\t\t} else {\r\n\t\t\t\tvar type = toString.call(firstArg);\r\n\r\n\t\t\t\tif(\"[object Object]\"!=type && \"[object Array]\"!=type) {\r\n\t\t\t\t\treturn firstArg;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(\"[object Object]\"===type) {\r\n\t\t\t\t\t\tvar container = {};\r\n\r\n\t\t\t\t\t\tfor(var key in firstArg) {\r\n\t\t\t\t\t\t\tvar val = firstArg[key],\r\n\t\t\t\t\t\t\t\ttype = toString.call(val);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer[key] = data.copy(val);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer[key] = val;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar container = [];\r\n\r\n\t\t\t\t\t\tfirstArg.forEach(function(item) {\r\n\t\t\t\t\t\t\tvar type = toString.call(item);\r\n\r\n\t\t\t\t\t\t\tif(\"[object Object]\"===type || \"[object Array]\"===type) {\r\n\t\t\t\t\t\t\t\tcontainer.push(data.copy(item));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcontainer.push(item);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn container;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 将白板数据生成图片数据\r\n\t\t// 此接口应对的是用户在白板上多次操作产生很多数据，由于数据是存储在storage中，数据量不宜过多，所以会在操作过程中把适量的数据生成图片数据进行存储\r\n\t\tsaveAsImage: function(_data, type) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcount = 0,\r\n\t\t\t\tarr = [],\r\n\t\t\t\tfile = null,\r\n\t\t\t\tlen = _data.length,\r\n\t\t\t\tactiveTab = self.tab.getActive(),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas;\r\n\r\n\t\t\tvar _createImage = function() {\r\n\t\t\t\tvar imgData=createImageCanvas.toDataURL(),\r\n\t\t\t\t\tpage = self.tab.getPage(activeTab.id);\r\n\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\tvar _data_ = {\r\n\t\t\t\t\ttype: \"image\",\r\n\t\t\t\t\tdata: [imgData, 0, 0],\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tstatus: 1, \r\n\t\t\t\t\torigin: true,\r\n\t\t\t\t\tfrom: \"auto\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(page) {\r\n\t\t\t\t\t_data_.pageNumber = page.getPageNumber();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfile && _data.push(file);\r\n\t\t\t\t_data.push(_data_);\r\n\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\t\t\t};\r\n\r\n\t\t\tvar next = function(list) {\r\n\t\t\t\tvar d = list.shift();\r\n\t\t\t\tif(!d) return _createImage();\r\n\r\n\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\tfile = d;\r\n\t\t\t\t\tnext(list);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata.render.call(self, d, function() {\r\n\t\t\t\t\t\tnext(list);\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\tvar d = _data.pop();\r\n\t\t\t\tarr.unshift(d);\r\n\t\t\t\td.origin && count++;\r\n\r\n\t\t\t\tif(self.params.saveImgStep<=count) {\r\n\t\t\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\r\n\t\t\t\t\tif(_data.length) {\r\n\t\t\t\t\t\tnext(_data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t[].push.apply(_data, arr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 清除文本头尾的空格\r\n\t\ttrim: function(content) {\r\n\t\t\tif(!content || \"[object String]\"!=toString.call(content)) return ;\r\n\t\t\treturn content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t},\r\n\t\t// 数据分页\r\n\t\tsplitPage: function(_data) {\r\n\t\t\tvar obj = {},\r\n\t\t\t\tkeys = [],\r\n\t\t\t\tlist = [];\r\n\r\n\t\t\t_data.forEach(function(d) {\r\n\t\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t\tlist.push(d);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj[d.pageNumber] = obj[d.pageNumber] || [];\r\n\t\t\t\t\tobj[d.pageNumber].push(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor(var key in obj) {\r\n\t\t\t\tkeys.push(key);\r\n\t\t\t}\r\n\r\n\t\t\t// 对页码进行排序\r\n\t\t\tkeys.sort(function(a, b) {\r\n\t\t\t\treturn a-b;\r\n\t\t\t});\r\n\r\n\t\t\tkeys.forEach(function(key) {\r\n\t\t\t\tlist.push(obj[key]);\r\n\t\t\t});\r\n\r\n\t\t\treturn list;\r\n\t\t},\r\n\t\t// 向白板绘制pen模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderPen: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\r\n\t\t\tdata.forEach(function(point, index) {\r\n\t\t\t\tif(0===index) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(point.x, point.y);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.lineTo(point.x, point.y);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制rect模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRect: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===params.mode) {\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.strokeRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.fillRect(data[0], data[1], data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制line模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderLine: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.strokeStyle = params.color;\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(data[0], data[1]);\r\n\t\t\tctx.lineTo(data[2], data[3]);\r\n\r\n\t\t\tif(1===mode) {\r\n\t\t\t\tvar angle = Math.atan2(data[1]-data[3], data[0]-data[2])*180/Math.PI,\r\n\t\t\t\t\tangle1 = (angle+30)*Math.PI/180,\r\n\t\t\t\t\tangle2 = (angle-30)*Math.PI/180,\r\n\t\t\t\t\ttopx = 15*Math.cos(angle1),\r\n\t\t\t\t\ttopy = 15*Math.sin(angle1),\r\n\t\t\t\t\tbotx = 15*Math.cos(angle2),\r\n\t\t\t\t\tboty = 15*Math.sin(angle2);\r\n\r\n\t\t\t\tctx.moveTo(topx+data[2], topy+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t\tctx.moveTo(botx+data[2], boty+data[3]);\r\n\t\t\t\tctx.lineTo(data[2], data[3]);\r\n\t\t\t}\r\n\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制round模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderRound: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tswitch(mode) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tctx.arc(data[0], data[1], data[2], 0, 2*Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\tctx.strokeStyle = params.color;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\tctx.fillStyle = params.color;\r\n\t\t\t\tvar r = data[2]>data[3]?data[2]:data[3],\r\n\t\t\t\t\tscaleX = data[2]/r,\r\n\t\t\t\t\tscaleY = data[3]/r;\r\n\t\t\t\tctx.scale(scaleX, scaleY);\r\n\t\t\t\tctx.arc(data[0]/scaleX, data[1]/scaleY, r, 0, 2*Math.PI);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制text模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderText: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tctx.fillStyle = params.color;\r\n\t\t\tctx.font = params.size + \"px sans-serif\";\r\n\t\t\tctx.save();\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillText(data[2], data[0], data[1]);\r\n\t\t\tctx.restore();\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 向白板绘制image模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trenderImage: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:(\"file\"===params.type?self.fileCanvas:self.mainCanvas)),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\timg = self.tplImage,\r\n\t\t\t\tcWidth = params.width,\r\n\t\t\t\tcHeight = params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\timg.src = data[0];\r\n\r\n\t\t\timg.onload = function() {\r\n\t\t\t\tvar imgWidth = img.width, imgHeight = img.height;\r\n\t\t\t\tctx.save();\r\n\r\n\t\t\t\tif(\"file\"===params.type) {\r\n\t\t\t\t\tcHeight = (cHeight>cWidth/(imgWidth/imgHeight)?cHeight:cWidth*(imgHeight/imgWidth))>>0;\r\n\t\t\t\t\tself.tab.resizePad(cWidth, cHeight);\r\n\t\t\t\t\tself.tab.resizePadPixel(imgWidth, imgHeight);\r\n\t\t\t\t\tctx.drawImage(img, 0, 0, imgWidth, imgHeight);\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tcallback && callback();\r\n\t\t\t};\r\n\t\t},\r\n\t\t// 向白板绘制eraser模块传递过来的数据\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\tdelete: function(params, callback, isCreateImage) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = isCreateImage?self.createImageCanvas:(0===params.status?self.bufferCanvas:self.mainCanvas),\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tif(0===params.status) {\r\n\t\t\t\tcanvas.width = canvas.width;\r\n\t\t\t} else {\r\n\t\t\t\tself.bufferCanvas.width = self.bufferCanvas.width;\r\n\t\t\t}\r\n\r\n\t\t\tdata.forEach(function(data) {\r\n\t\t\t\tif(0===params.mode) {\r\n\t\t\t\t\tvar sin = data.size/2*Math.sin(Math.atan((data.y - data.ey)/(data.x - data.ex))),\r\n\t\t\t\t    \tcos = data.size/2*Math.cos(Math.atan((data.y - data.ey)/(data.x - data.ex)));\r\n\r\n\t\t\t\t    var x1 = data.ex + sin;\r\n\t\t\t\t    var y1 = data.ey - cos;\r\n\t\t\t\t    var x2 = data.ex - sin;\r\n\t\t\t\t    var y2 = data.ey + cos;\r\n\t\t\t\t    var x3 = data.x + sin;\r\n\t\t\t\t    var y3 = data.y - cos;\r\n\t\t\t\t    var x4 = data.x - sin;\r\n\t\t\t\t    var y4 = data.y + cos;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.arc(data.x, data.y, data.size/2, 0, 2*Math.PI);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar x1 = data.ex - data.size/2;\r\n\t\t\t\t    var y1 = data.ey - data.size/2;\r\n\t\t\t\t    var x2 = data.ex - data.size/2;\r\n\t\t\t\t    var y2 = data.ey + data.size/2;\r\n\t\t\t\t    var x3 = data.x + data.size/2;\r\n\t\t\t\t    var y3 = data.y - data.size/2;\r\n\t\t\t\t    var x4 = data.x - data.size/2;\r\n\t\t\t\t    var y4 = data.y + data.size/2;\r\n\r\n\t\t\t\t    ctx.save();\r\n\t\t\t\t    ctx.scale(wScale, hScale);\r\n\t\t        \tctx.beginPath();\r\n\t\t        \tctx.rect(x1, y1, data.size, data.size);\r\n\t\t        \tctx.clip();\r\n\t\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t\t        \tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(wScale, hScale);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(x1, y1);\r\n\t        \tctx.lineTo(x2, y2);\r\n\t        \tctx.lineTo(x3, y3);\r\n\t        \tctx.lineTo(x4, y4);\r\n\t        \tctx.closePath();\r\n\t        \tctx.clip()\r\n\t        \tctx.clearRect(0, 0, self.params.width, self.params.height);\r\n\t        \tctx.restore();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcallback && callback();\r\n\t\t},\r\n\t\t// 总的绘制接口\r\n\t\t// isCreateImage是boolean值,只有在saveAsImage中调用些接口时才为true\r\n\t\trender: function(_data, callback, isCreateImage) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\r\n\t\t\t// 根据type调用相对应功能的render接口\r\n\t\t\tswitch(type) {\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tdata.renderPen.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"rectangle\":\r\n\t\t\t\tdata.renderRect.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\tdata.renderLine.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"round\":\r\n\t\t\t\tdata.renderRound.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"text\":\r\n\t\t\t\tdata.renderText.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"file\":\r\n\t\t\t\tdata.renderImage.call(self, _data, callback, isCreateImage);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"eraser\":\r\n\t\t\t\tdata.delete.call(self, _data, callback, isCreateImage);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 鼠标的绘制对象\r\n\tvar mouse = {\r\n\t\t// 橡皮擦\r\n\t\teraser: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tmode = params.mode,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\r\n\t\t\tif(0===mode) {\r\n\t\t\t\tctx.arc(data[0], data[1], data[2]/2, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\t\t\t\tvar px = data[0]-data[2]/2,\r\n\t\t\t\t\tpy = data[1]-data[2]/2;\r\n\t\t\t\tctx.rect(px, py, data[2], data[2]);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 教鞭\r\n\t\tferula: function(params) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tcanvas = self.mouseIconCanvas,\r\n\t\t\t\tdata = params.data,\r\n\t\t\t\tferulaSize = self.params.ferulaSize,\r\n\t\t\t\twScale = canvas.width/params.width,\r\n\t\t\t\thScale = canvas.height/params.height,\r\n\t\t\t\tctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\tcanvas.width = canvas.width;\r\n\t\t\tif(-1===data[0] || -1===data[1]) return ;\r\n\t\t\tctx.scale(wScale, hScale);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle = \"red\";\r\n\t\t\tctx.arc(data[0], data[1], ferulaSize, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\t\t},\r\n\t\t// 总的render接口\r\n\t\t// 根据type调用mouse[type]\r\n\t\trender: function(_data) {\r\n\t\t\tvar self = this, type = _data.type;\r\n\t\t\tmouse[type] && mouse[type].call(self, _data);\r\n\t\t}\r\n\t};\r\n\r\n\t// 白板的tab模块\r\n\tvar Tab = (function() {\r\n\t\tvar UL = document.createElement(\"UL\"),\r\n\t\t\ttabTpl = '<li class=\"pad-tab-item\" title=\"@LABEL@\">@LABEL@@DELETEBTN@</li>',\r\n\t\t\tdelTpl = '<i class=\"iconfont icon-close\"></i>';\r\n\r\n\t\tfunction _tab(wrap) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttabMap = {},\t// 创建的所有tab生成的map,key是tab的唯一标识\r\n\t\t\t\tdataMap = {},\t// 所有tab对应的数据生成的map,key是tab的唯一标识\r\n\t\t\t\tcanvasMap = {},\t// 所有tab对应的画面生成的map,key是tab的唯一标识\r\n\t\t\t\tactiveObj = {},\t// 目前被激活的画布,数据,tab生成的对象\r\n\t\t\t\tidList = [],\r\n\t\t\t\tsaving = false,\r\n\t\t\t\tpageMap = {},\r\n\t\t\t\ttabWrap = wrap.getElementsByClassName(\"pad-tab-list\")[0];\r\n\r\n\t\t\tself.build = function(canvas, type, _data, _tab, from) {\r\n\t\t\t\tif(!canvas) return ;\r\n\r\n\t\t\t\tvar that = this,\r\n\t\t\t\t\tdel = from == that.params.id,\r\n\t\t\t\t\t_id = _tab && _tab.id?_tab.id:(0===type?0:data.uuid),\r\n\t\t\t\t\t_tabTpl = tabTpl.replace(/@LABEL@/g, _tab && _tab.name?_tab.name:tabNameMap[type]).replace(/@DELETEBTN@/g, del?delTpl:\"\");\r\n\r\n\t\t\t\tUL.innerHTML = _tabTpl;\r\n\t\t\t\tidList.push(_id);\r\n\t\t\t\tvar li = UL.firstElementChild || UL.firstChild;\r\n\r\n\t\t\t\ttabMap[_id] = li;\r\n\t\t\t\tdataMap[_id] = _data || [];\r\n\t\t\t\tcanvasMap[_id] = canvas;\r\n\r\n\t\t\t\tif(del) {\r\n\t\t\t\t\tele.addEvent(li.getElementsByTagName(\"i\")[0], eventMap[\"click\"], function() {\r\n\t\t\t\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\t\t\t \te = args[0] || window.event;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(window.event) {\r\n\t\t\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself.remove.call(that, _id);\r\n\t\t\t\t\t\tthat.params.onTabRemove && that.params.onTabRemove(_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tele.addEvent(li, eventMap[\"click\"], function() {\r\n\t\t\t\t\tif(true===that.params.disable || this===activeObj.tab) return ;\r\n\t\t\t\t\tself.active.call(that, _id);\r\n\t\t\t\t\tthat.params.onTabChange && that.params.onTabChange(_id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttabWrap.appendChild(li);\r\n\r\n\t\t\t\tthat.container[_id] = {\r\n\t\t\t\t\tdata: dataMap[_id],\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tsplitPage: 0,\r\n\t\t\t\t\tfrom: from\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(_tab && _tab.name) that.container[_id].tabName = _tab.name;\r\n\t\t\t\treturn _id;\r\n\t\t\t};\r\n\r\n\t\t\tself.push = function(id, _data) {\r\n\t\t\t\tvar self = this, count = 0;\r\n\t\t\t\tif(!dataMap[id]) dataMap[id] = [];\r\n\t\t\t\tdataMap[id].push(_data);\r\n\t\t\t\tself.tab.saveData.call(self);\r\n\r\n\t\t\t\tdataMap[id].forEach(function(d) {\r\n\t\t\t\t\tif(\"auto\"!=d.from) count++;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(count-self.params.saveImgStep>=self.params.saveImgStep) {\r\n\t\t\t\t\tdata.saveAsImage.call(self, dataMap[id], self.container[id].type);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.saveData = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tif(saving || \"never\"===self.params.autoSaveTime) return ;\r\n\t\t\t\tself.params.autoSaveTime = isNaN(self.params.autoSaveTime)?10:+self.params.autoSaveTime;\r\n\r\n\t\t\t\tvar it = setTimeout(function() {\r\n\t\t\t\t\tfor(var key in pageMap) {\r\n\t\t\t\t\t\tvar page = pageMap[key];\r\n\t\t\t\t\t\tdataMap[key].length = 0;\r\n\t\t\t\t\t\t[].push.apply(dataMap[key], page.getData());\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t\t\tclearTimeout(it);\r\n\t\t\t\t\tsaving = false;\r\n\t\t\t\t}, self.params.autoSaveTime*1000);\r\n\r\n\t\t\t\tsaving = true;\r\n\t\t\t};\r\n\r\n\t\t\tself.remove = function(_id) {\r\n\t\t\t\tvar self = this,\r\n\t\t\t\t\tli = tabMap[_id],\r\n\t\t\t\t\tindex = idList.indexOf(_id);\r\n\r\n\t\t\t\tdelete tabMap[_id];\r\n\t\t\t\tdelete dataMap[_id];\r\n\t\t\t\tdelete canvasMap[_id];\r\n\t\t\t\tdelete self.container[_id];\r\n\t\t\t\tdelete pageMap[_id];\r\n\r\n\t\t\t\ttabWrap.removeChild(li);\r\n\t\t\t\tidList.splice(index, 1);\r\n\r\n\t\t\t\tif(activeObj.id==_id) {\r\n\t\t\t\t\t_id = idList[Math.max(index-1, 0)];\r\n\t\t\t\t\tself.tab.active.call(self, _id);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.active = function(_id) {\r\n\t\t\t\tvar self = this, _data = dataMap[_id];\r\n\t\t\t\tele.removeClass(activeObj.tab, \"active\");\r\n\t\t\t\tself.tab.resizePad();\r\n\t\t\t\tself.scroll.toOrigin();\r\n\r\n\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\tactiveObj.page.hide();\r\n\t\t\t\t\tdelete activeObj.page;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.container[_id].type != activeObj.type) {\r\n\t\t\t\t\tele.css(activeObj.canvas || self.mainCanvas, \"background\");\r\n\t\t\t\t\tele.css(canvasMap[_id], \"background\", self.params.background);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveObj.tab = tabMap[_id];\r\n\t\t\t\tactiveObj.data = dataMap[_id];\r\n\t\t\t\tactiveObj.canvas = canvasMap[_id];\r\n\t\t\t\tactiveObj.id = _id;\r\n\t\t\t\tactiveObj.type = self.container[_id].type;\r\n\t\t\t\tactiveObj.page = pageMap[_id];\r\n\r\n\t\t\t\tele.addClass(activeObj.tab, \"active\");\r\n\t\t\t\tactiveObj.page && activeObj.page.show();\r\n\r\n\t\t\t\tif(_data && !activeObj.page) {\r\n\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\tvar i = 0, len = _data.length;\r\n\r\n\t\t\t\t\tif(len) {\r\n\t\t\t\t\t\tvar next = function() {\r\n\t\t\t\t\t\t\tvar d = _data[i];\r\n\r\n\t\t\t\t\t\t\td && data.render.call(self, d, function() {\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\ti<len && next();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tself.getActive = function() {\r\n\t\t\t\treturn activeObj;\r\n\t\t\t};\r\n\r\n\t\t\tself.getTab = function(id) {\r\n\t\t\t\treturn tabMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.clear = function(params) {\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\tif(activeObj.page) {\r\n\t\t\t\t\t\tactiveObj.page.clear.call(self);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tactiveObj.data.length = 0;\r\n\t\t\t\t\t\tactiveObj.canvas.width = activeObj.canvas.width;\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(self.params.onClear) && self.params.onClear({tabId: activeObj.id});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar id = params.tabId;\r\n\r\n\t\t\t\t\tif(pageMap[id]) {\r\n\t\t\t\t\t\tpageMap[id].clear.call(self, params);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(dataMap[id]) dataMap[id].length = 0;\r\n\t\t\t\t\t\tif(canvasMap[id]) canvasMap[id].width = canvasMap[id].width;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t!self.params.noCache && window.localStorage.setItem(self.id+\"_pad\", JSON.stringify(self.container));\r\n\t\t\t};\r\n\r\n\t\t\tself.cleanCache = function() {\r\n\t\t\t\tvar self = this;\r\n\t\t\t\t!self.params.noCache && window.localStorage.removeItem(self.id+\"_pad\");\r\n\t\t\t};\r\n\r\n\t\t\tself.setPage = function(id, page) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tpageMap[id] = page;\r\n\t\t\t\tthat.container[id].splitPage = 1;\r\n\t\t\t};\r\n\r\n\t\t\tself.getPage = function(id) {\r\n\t\t\t\treturn pageMap[id];\r\n\t\t\t};\r\n\r\n\t\t\tself.render = function(_data, callback) {\r\n\t\t\t\tvar that = this;\r\n\r\n\t\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\t\tvar outData = data.copy(_data), obj = {};\r\n\r\n\t\t\t\t\t\tobj[activeObj.id] = {\r\n\t\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\t\ttype: activeObj.type,\r\n\t\t\t\t\t\t\tsplitPage: activeObj.page?1:0\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tcallback(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_data.status && that.tab.push.call(that, activeObj.id, _data);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t_tab.prototype = {\r\n\t\t\tconstructor: _tab\r\n\t\t};\r\n\r\n\t\treturn _tab;\r\n\t}());\r\n\r\n\tfunction Page(params) {\r\n\t\tif(!this instanceof Page) {\r\n\t\t\treturn new Page(params);\r\n\t\t}\r\n\r\n\t\tvar self = this,\r\n\t\t\tcurrentPage = 1,\r\n\t\t\tthat = params.that,\r\n\t\t\t_data = data.splitPage(params.data),\r\n\t\t\ttotal = _data.length,\r\n\t\t\ttabId = params.tabId,\r\n\t\t\tshow = params.show || false,\r\n\t\t\tdiv = document.createElement(\"DIV\"),\r\n\t\t\tpageWrap = that.params.wrap.getElementsByClassName(\"split-page-wrap\")[0];\r\n\r\n\t\tdiv.innerHTML = tpl4.replace(/@TOTAL@/g, total);\r\n\t\tvar pageEle = div.removeChild(div.firstElementChild || div.firstChild),\r\n\t\t\tprePageBtn = pageEle.getElementsByClassName(\"pre-page-btn\")[0],\r\n\t\t\tnextPageBtn = pageEle.getElementsByClassName(\"next-page-btn\")[0],\r\n\t\t\tgoPageBtn = pageEle.getElementsByClassName(\"go-page-btn\")[0],\r\n\t\t\tpageNumberInput = pageEle.getElementsByClassName(\"page-number-input\")[0];\r\n\r\n\t\tele.addEvent(prePageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage<=1) return ;\r\n\t\t\tself.pre();\r\n\t\t});\r\n\r\n\t\tele.addEvent(nextPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable || currentPage>=total) return ;\r\n\t\t\tself.next();\r\n\t\t});\r\n\r\n\t\tele.addEvent(goPageBtn, eventMap[\"click\"], function() {\r\n\t\t\tif(that.params.disable) return ;\r\n\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"input\", function() {\r\n\t\t\tif(/^\\s*([0-9]+).*\\s*$/.test(this.value)) {\r\n\t\t\t\tthis.value = RegExp.$1;\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = currentPage;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(pageNumberInput, \"keypress\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = window.event || args[0];\r\n\r\n\t\t\tif(13===e.keyCode || 13===e.which) {\r\n\t\t\t\tvar pageNumber = pageNumberInput.value;\r\n\t\t\t\r\n\t\t\t\tself.go(pageNumber, function() {\r\n\t\t\t\t\tpageNumber = pageNumberInput.value;\r\n\t\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, pageNumber, _data[pageNumber-1][0]);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.pre = function() {\r\n\t\t\tcurrentPage--;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tvar render = function(pageNumber, start, callback) {\r\n\t\t\tvar __data = _data[pageNumber-1];\r\n\r\n\t\t\tif(\"[object Array]\"===toString.call(__data)) {\r\n\t\t\t\t__data.some(function(d, index) {\r\n\t\t\t\t\tif(index<start) return ;\r\n\t\t\t\t\tvar flag = false;\r\n\r\n\t\t\t\t\tif(\"file\"===d.type) {\r\n\t\t\t\t\t\tflag = true;\r\n\r\n\t\t\t\t\t\tdata.render.call(that, d, function() {\r\n\t\t\t\t\t\t\tif(__data.length-1<=index) {\r\n\t\t\t\t\t\t\t\tcallback && callback();\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trender(pageNumber, ++index, callback);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.render.call(that, d);\r\n\t\t\t\t\t\t__data.length-1<=index && callback && callback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn flag;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdata.render.call(that, __data, callback);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.go = function(pageNumber, callback) {\r\n\t\t\tpageNumber = pageNumber<=1?1:pageNumber;\r\n\t\t\tpageNumber = pageNumber>=total?total:pageNumber;\r\n\r\n\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\"[object Function]\" === toString.call(callback) && callback();\r\n\t\t\t});\r\n\r\n\t\t\tcurrentPage = pageNumber;\r\n\t\t\tpageNumberInput.value = pageNumber;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase currentPage<=1 && currentPage<total:\r\n\t\t\t\t\tele.addClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase currentPage>1 && currentPage>=total:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.addClass(nextPageBtn, \"no\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tele.removeClass(prePageBtn, \"no\");\r\n\t\t\t\t\tele.removeClass(nextPageBtn, \"no\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.next = function() {\r\n\t\t\tcurrentPage++;\r\n\r\n\t\t\tthis.go(currentPage, function() {\r\n\t\t\t\tthat.params.onPageTurn && that.params.onPageTurn(tabId, currentPage, _data[currentPage-1][0]);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.show = function() {\r\n\t\t\tpageWrap.innerHTML = \"\";\r\n\r\n\t\t\tif(_data.length>1) {\r\n\t\t\t\tpageWrap.appendChild(pageEle);\r\n\r\n\t\t\t\tswitch(that.params.splitpageLayout) {\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\tpageWrap.style.left = \"10px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\tpageWrap.style.left = (pageWrap.parentNode.clientWidth - pageWrap.offsetWidth)/2 + \"px\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\tpageWrap.style.right = \"10px\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.go(currentPage);\r\n\t\t};\r\n\r\n\t\tthis.hide = function() {\r\n\t\t\tif(that.tab.getActive().page!=self) return ;\r\n\t\t\t_data.length>1 && pageWrap.removeChild(pageEle);\r\n\t\t};\r\n\r\n\t\tthis.getPageNumber = function() {\r\n\t\t\treturn currentPage;\r\n\t\t};\r\n\r\n\t\tthis.empower = function() {\r\n\t\t\tpageNumberInput.removeAttribute(\"readonly\");\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tpageNumberInput.setAttribute(\"readonly\", \"readonly\");\r\n\t\t};\r\n\r\n\t\t_data.forEach(function(d, i) {\r\n\t\t\tif(\"[object String]\"===toString.call(d)) {\r\n\t\t\t\t_data[i] = [{\r\n\t\t\t\t\tdata: [d, 0, 0],\r\n\t\t\t\t\tpageNumber: i+1,\r\n\t\t\t\t\twidth: that.mainCanvas.offsetWidth,\r\n\t\t\t\t\theight: that.mainCanvas.offsetHeight,\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t\ttype: \"file\",\r\n\t\t\t\t\tfrom: params.from\r\n\t\t\t\t}];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.push = function(d, pageNumber) {\r\n\t\t\tvar activeTab = that.tab.getActive(), count = 0;\r\n\t\t\td.pageNumber = void(0)!=pageNumber?pageNumber:currentPage;\r\n\t\t\t_data[d.pageNumber-1].push(d);\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\t_data[d.pageNumber-1].forEach(function(d) {\r\n\t\t\t\tif(\"file\"!=d.type && \"auto\"!=d.from) count++;\r\n\t\t\t});\r\n\r\n\t\t\tif(count-that.params.saveImgStep>=that.params.saveImgStep) {\r\n\t\t\t\tdata.saveAsImage.call(that, _data[d.pageNumber-1], that.container[activeTab.id].type);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.getData = function() {\r\n\t\t\tvar i = 0, arr = [];\r\n\r\n\t\t\twhile(i<total) {\r\n\t\t\t\t[].push.apply(arr, _data[i]);\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tvar pageNumber = (params?params.pageNumber:currentPage) || currentPage;\r\n\t\t\t_data[pageNumber-1].length = 1;\r\n\t\t\tthat.tab.saveData.call(that);\r\n\r\n\t\t\tif(void(0)===params || (params.tabId==that.tab.getActive().id && params.pageNumber==currentPage)) {\r\n\t\t\t\tthat.mainCanvas.width = that.mainCanvas.width;\r\n\r\n\t\t\t\trender(pageNumber, 0, function() {\r\n\t\t\t\t\tif(void(0)===params) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(that.params.onClear) && that.params.onClear({tabId: that.tab.getActive().id, pageNumber: pageNumber});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data, callback) {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tdata.render.call(that, _data, function() {\r\n\t\t\t\tif(\"[object Function]\"===toString.call(callback)) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type,\r\n\t\t\t\t\t\tpageNumber: currentPage,\r\n\t\t\t\t\t\tsplitPage: activeTab.page?1:0\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcallback(obj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t_data.status && that.tab.getActive().page.push.call(that, _data);\r\n\t\t};\r\n\r\n\t\tthat.params.disable && this.disable();\r\n\t\tthat.tab.saveData.call(that);\r\n\t\tshow && this.show();\r\n\t}\r\n\r\n\tPage.prototype = {\r\n\t\tconstructor: Page\r\n\t};\r\n\r\n\tfunction WPad(params) {\r\n\t\tif(!this instanceof WPad) {\r\n\t\t\treturn new WPad(params);\r\n\t\t}\r\n\r\n\t\tvar tplImage = new Image();\r\n\t\ttplImage.setAttribute(\"crossOrigin\", \"anonymous\");\r\n\r\n\t\tvar that = {\r\n\t\t\tpad: this,\r\n\t\t\tparams: params,\r\n\t\t\twaitList: [],\r\n\t\t\tcontainer: {},\r\n\t\t\ttplImage: tplImage,\r\n\t\t\tid: params.id || padCount++,\r\n\t\t\trender: function(_data) {\r\n\t\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\t\tif(activeTab.page) {\r\n\t\t\t\t\tactiveTab.page.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthat.tab.render.call(that, _data, function(d) {\r\n\t\t\t\t\t\t\"[object Function]\"===toString.call(params.onRender) && params.onRender(d);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tmouseRender: function(_data) {\r\n\t\t\t\tmouse.render.call(that, _data);\r\n\r\n\t\t\t\tif(params.onMousemove) {\r\n\t\t\t\t\tvar outData = data.copy(_data), obj = {}, activeTab = that.tab.getActive();\r\n\r\n\t\t\t\t\tobj[activeTab.id] = {\r\n\t\t\t\t\t\tdata: outData,\r\n\t\t\t\t\t\ttype: activeTab.type\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tparams.onMousemove(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tbuildPad.call(that);\r\n\r\n\t\tvar render = function(_data) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, realData = val.data;\r\n\r\n\t\t\t\tif(key==activeTab.id) {\r\n\t\t\t\t\tif(!activeTab.page) {\r\n\t\t\t\t\t\tthat.tab.render.call(that, realData);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif(activeTab.page.getPageNumber() == val.pageNumber) {\r\n\t\t\t\t\t\t\tactiveTab.page.render.call(that, realData);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trealData.status && activeTab.page.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(that.tab.getTab(key)) {\r\n\t\t\t\t\t\tif(realData.status) {\r\n\t\t\t\t\t\t\tvar page = that.tab.getPage(key);\r\n\r\n\t\t\t\t\t\t\tif(page) {\r\n\t\t\t\t\t\t\t\tpage.push.call(that, realData, +val.pageNumber);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthat.tab.push.call(that, key, realData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthat.tab.build.call(that, that.fileCanvas, 1, [realData], {id: key}, realData.from);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar renderMouse = function(_data) {\r\n\t\t\tvar scaleWidth = null, scaleHeight = null;\r\n\r\n\t\t\tfor(var key in _data) {\r\n\t\t\t\tvar val = _data[key], type = val.type, val = val.data;\r\n\t\t\t\tmouse.render.call(that, val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.render = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\t\r\n\t\t\trender(_data);\r\n\t\t};\r\n\r\n\t\tthis.renderAll = function(dataArr) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(dataArr)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Array\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\tdataArr.forEach(function(_data) {\r\n\t\t\t\trender(_data);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tthis.mouseCtrl = function(_data) {\r\n\t\t\tif(\"[object Object]\"!=toString.call(_data)) {\r\n\t\t\t\tconsole.error(\"TypeError: data must be Object\");\r\n\t\t\t\treturn ;\r\n\t\t\t}\r\n\r\n\t\t\trenderMouse(_data);\r\n\t\t};\r\n\r\n\t\tthis.clear = function(params) {\r\n\t\t\tthat.tab.clear.call(that, params);\r\n\t\t};\r\n\r\n\t\tthis.disable = function() {\r\n\t\t\tele.addClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = true;\r\n\t\t};\r\n\r\n\t\tthis.enable = function() {\r\n\t\t\tele.removeClass(params.wrap.firstElementChild||params.wrap.firstChild, \"disabled\");\r\n\t\t\tparams.disable = false;\r\n\t\t};\r\n\r\n\t\tthis.createImage = function() {\r\n\t\t\treturn that.mainCanvas.toDataURL();\r\n\t\t};\r\n\r\n\t\tthis.getData = function(tabId) {\r\n\t\t\treturn that.container[tabId] || that.container;\r\n\t\t};\r\n\r\n\t\tthis.changeTab = function(id) {\r\n\t\t\tthat.tab.active.call(that, id);\r\n\t\t};\r\n\r\n\t\tthis.turnPage = function(id, number) {\r\n\t\t\tvar activeTab = that.tab.getActive();\r\n\r\n\t\t\tif(id==activeTab.id) {\r\n\t\t\t\tvar pageObj = that.tab.getPage.call(that, id);\r\n\t\t\t\tpageObj.go(number);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.removeTab = function(id) {\r\n\t\t\tif(void(0)==id) return ;\r\n\t\t\tthat.tab.remove.call(that, id);\r\n\t\t};\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseenter\", function() {\r\n\t\t\tthat.active = true;\r\n\t\t});\r\n\r\n\t\tele.addEvent(params.wrap, \"mouseleave\", function() {\r\n\t\t\tthat.active = false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction buildPad() {\r\n\t\tvar self = this,\r\n\t\t\tparams = this.params,\r\n\t\t\twrap = params.wrap,\r\n\t\t\ttoolbars = params.toolbars,\r\n\t\t\ttoolbarMap = {},\r\n\t\t\thandPad = false,\r\n\t\t\tcurrent = null,\r\n\t\t\tcurActiveNode = null,\r\n\t\t\tcurActiveChildNode = null,\r\n\t\t\tfr = new FileReader(),\r\n\t\t\tactive = false,\r\n\t\t\ttoolbarStr = \"\",\r\n\t\t\tisFullScreen = false,\r\n\t\t\tfullScreenInterface = wrap.requestFullscreen || wrap.webkitRequestFullscreen || wrap.mozRequestFullScreen || wrap.msRequestFullscreen,\r\n\t\t\tcancelFullScreenInterface = document.exitFullscreen || document.webkitCancelFullScreen || document.mozCancelFullScreen;\r\n\r\n\t\tvar colorInput = null,\r\n\t\t\tfileInput = null,\r\n\t\t\ttextInput = null,\r\n\t\t\tmainCanvas = null,\r\n\t\t\tbufferCanvas1 = null,\r\n\t\t\tbufferCanvas2 = null,\r\n\t\t\tbufferCanvas3 = null,\r\n\t\t\tbufferCanvas4 = null;\r\n\r\n\t\ttoolbars.forEach(function(toolbar) {\r\n\t\t\tvar _childToolbars = childToolbars[toolbar];\r\n\r\n\t\t\tswitch(toolbar) {\r\n\t\t\t\tcase \"handPad\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tif(!_childToolbars) {\r\n\t\t\t\t\ttoolbarMap[toolbar] = new vm.module[toolbar]({name: toolbar});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_childToolbars.forEach(function(_toolbar) {\r\n\t\t\t\t\t\ttoolbarMap[_toolbar] = new vm.module[toolbar]({name: _toolbar});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar _tpl2 = tpl2.replace(/@ITEM@/g, !_childToolbars?toolbar:_childToolbars[0])\r\n\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, !_childToolbars?classes[toolbar]:classes[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@TITLE@/g, !_childToolbars?titles[toolbar]:titles[_childToolbars[0]])\r\n\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 0);\r\n\t\t\t\t\r\n\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARS@/g, !_childToolbars?\"\":tpl3);\r\n\r\n\t\t\tif(_childToolbars) {\r\n\t\t\t\tvar childToolbarStr = \"\";\r\n\r\n\t\t\t\t_childToolbars.forEach(function(toolbar) {\r\n\t\t\t\t\tchildToolbarStr += tpl2.replace(/@ITEM@/g, toolbar)\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@ICONCLASS@/g, classes[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@TITLE@/g, titles[toolbar])\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@CHILDTOOLBARS@/g, \"\")\r\n\t\t\t\t\t\t\t\t\t\t\t.replace(/@LEVEL@/g, 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t_tpl2 = _tpl2.replace(/@CHILDTOOLBARITEM@/g, childToolbarStr);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttoolbarStr += _tpl2;\r\n\t\t});\r\n\r\n\t\tfalse!=params.fullScreen && (toolbarStr = toolbarStr + tpl5);\r\n\t\tvar __str__ = tpl1.replace(/@LAYOUT@/g, layoutClassMap[params.layout]+(params.vertical?\" vertical\":\"\"))\r\n\t\t\t\t\t\t\t.replace(/@TOOLBARS@/g, toolbarStr)\r\n\t\t\t\t\t\t\t.replace(/@DISABLED@/g, params.disable?\"disabled\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTOOLBAR@/g, params.noToolbar?\"no-toolbar\":\"\")\r\n\t\t\t\t\t\t\t.replace(/@NOTAB@/g, params.noTab?\"no-tab\":\"\");\r\n\t\tvar _data = params.data || (!params.noCache?JSON.parse(window.localStorage.getItem(self.id+\"_pad\")):null);\r\n\t\twrap.innerHTML = __str__;\r\n\t\tthis.toolbarMap = toolbarMap;\r\n\t\t\r\n\t\tvar canvasWrap = wrap.getElementsByClassName(\"can-wrap\")[0],\r\n\t\t\ttoolbarWrap = wrap.getElementsByClassName(\"toolbar-list\")[0],\r\n\t\t\tfullScreenBtn = toolbarWrap.getElementsByClassName(\"full-screen-btn\")[0];\r\n\r\n\t\tcolorInput = wrap.getElementsByClassName(\"color-input\")[0];\r\n\t\tfileInput = wrap.getElementsByClassName(\"file-input\")[0];\r\n\t\ttextInput = wrap.getElementsByClassName(\"text-input\")[0];\r\n\t\tmainCanvas = wrap.getElementsByClassName(\"main-can\")[0];\r\n\t\tbufferCanvas1 = wrap.getElementsByClassName(\"buffer-can-1\")[0];\r\n\t\tbufferCanvas2 = wrap.getElementsByClassName(\"buffer-can-2\")[0];\r\n\t\tbufferCanvas3 = wrap.getElementsByClassName(\"buffer-can-3\")[0];\r\n\t\tbufferCanvas4 = wrap.getElementsByClassName(\"buffer-can-4\")[0];\r\n\r\n\t\tvar createSize = function() {\r\n\t\t\tvar canvasWrapWidth = canvasWrap.clientWidth, canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*\\*\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tcanvasWrapWidth = +RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = +RegExp.$2;\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)\\s*:\\s*(\\d+)\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tswitch(true) {\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2>_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapWidth/RegExp.$1*RegExp.$2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase RegExp.$1/RegExp.$2<_canvasWrapWidth/_canvasWrapHeight:\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapHeight/RegExp.$2*RegExp.$1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth;\r\n\t\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase /^\\s*(\\d+)%\\s*$/.test(params.size):\r\n\t\t\t\t\tvar _canvasWrapWidth = canvasWrap.clientWidth,\r\n\t\t\t\t\t\t_canvasWrapHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\t\t\tcanvasWrapWidth = _canvasWrapWidth/100*RegExp.$1;\r\n\t\t\t\t\tcanvasWrapHeight = _canvasWrapHeight/100*RegExp.$1;\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tcanvasWrapWidth = canvasWrap.clientWidth;\r\n\t\t\t\t\tcanvasWrapHeight = canvasWrap.clientHeight;\r\n\t\t\t}\r\n\r\n\t\t\tparams.width = canvasWrapWidth>>0;\r\n\t\t\tparams.height = canvasWrapHeight>>0;\r\n\t\t};\r\n\r\n\t\tele.addEvent(canvasWrap, eventMap[\"wheel\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tif(true!=scrollObj.disable && scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\tvar data = {type: \"y\", distance: (\"DOMMouseScroll\"===e.type?(3===e.detail?100:-100):(e.deltaY))/10, from: params.id, scale: scrollObj.scrollObj.y.moveHeight/scrollObj.scrollObj.y.coverHeight};\r\n\t\t\t\tscrollObj.scroll(data);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar oldAvilWidth = canvasWrap.clientWidth, oldAvilHeight = canvasWrap.clientHeight;\r\n\r\n\t\tele.addEvent(window, \"resize\", function() {\r\n\t\t\tvar avilWidth = canvasWrap.clientWidth,\r\n\t\t\t\tavilHeight = canvasWrap.clientHeight;\r\n\r\n\t\t\tif(avilWidth!=oldAvilWidth || avilHeight!=oldAvilHeight) {\r\n\t\t\t\tcreateSize();\r\n\t\t\t\tresizePad();\r\n\t\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t\t\toldAvilWidth = avilWidth;\r\n\t\t\t\toldAvilHeight = avilHeight;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar resizePad = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\r\n\t\t\tmainCanvas.style.width = bufferCanvas1.style.width = bufferCanvas2.style.width = bufferCanvas3.style.width = bufferCanvas4.style.width = width + \"px\";\r\n\t\t\tmainCanvas.style.height = bufferCanvas1.style.height = bufferCanvas2.style.height = bufferCanvas3.style.height = bufferCanvas4.style.height = height + \"px\";\r\n\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = 0;\r\n\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = 0;\r\n\r\n\t\t\tif(width<canvasWrap.clientWidth) {\r\n\t\t\t\tvar left = (canvasWrap.clientWidth - width)/2;\r\n\t\t\t\tmainCanvas.style.left = bufferCanvas1.style.left = bufferCanvas2.style.left = bufferCanvas3.style.left = bufferCanvas4.style.left = left + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tif(height<canvasWrap.clientHeight) {\r\n\t\t\t\tvar top = (canvasWrap.clientHeight - height)/2;\r\n\t\t\t\tmainCanvas.style.top = bufferCanvas1.style.top = bufferCanvas2.style.top = bufferCanvas3.style.top = bufferCanvas4.style.top = top + \"px\";\r\n\t\t\t}\r\n\r\n\t\t\tscrollObj && scrollObj.resize();\r\n\t\t};\r\n\r\n\t\tvar resizePadPixel = function(w, h) {\r\n\t\t\tvar width = w || params.width, height = h || params.height;\r\n\r\n\t\t\tmainCanvas.width = bufferCanvas1.width = bufferCanvas2.width = bufferCanvas3.width = bufferCanvas4.width = width;\r\n\t\t\tmainCanvas.height = bufferCanvas1.height = bufferCanvas2.height = bufferCanvas3.height = bufferCanvas4.height = height;\r\n\t\t};\r\n\r\n\t\tself.tab = new Tab(params.wrap);\r\n\t\tself.textInput = textInput;\r\n\t\tself.mouseIconCanvas = bufferCanvas1;\r\n\t\tself.createImageCanvas = bufferCanvas3;\r\n\t\tself.fileCanvas = bufferCanvas4;\r\n\t\tself.mainCanvas = mainCanvas;\r\n\t\tcreateSize();\r\n\t\tresizePad();\r\n\t\tresizePadPixel();\r\n\r\n\t\tvar scrollObj = scroll.init({\r\n\t\t\tnode: canvasWrap,\r\n\t\t\tid: params.id\r\n\t\t});\r\n\r\n\t\tscrollObj.disable = params.disable;\r\n\t\tself.scroll = scrollObj;\r\n\r\n\t\tscrollObj.addEvent(\"scroll\", function(data) {\r\n\t\t\t\"[object Function]\"===toString.call(params.onScroll) && params.onScroll(data);\r\n\t\t});\r\n\t\t\r\n\t\tObject.defineProperty(self.tab, \"resizePad\", {\r\n\t\t\tvalue: resizePad\r\n\t\t});\r\n\r\n\t\tObject.defineProperty(self.tab, \"resizePadPixel\", {\r\n\t\t\tvalue: resizePadPixel\r\n\t\t});\r\n\r\n\t\tele.addEvent(colorInput, \"change\", function() {\r\n\t\t\tself.params.color = this.value;\r\n\t\t});\r\n\r\n\t\tvar fullScreen = function(flag) {\r\n\t\t\tif(!isMobile) {\r\n\t\t\t\tflag?fullScreenInterface.call(wrap.getElementsByClassName(\"pad-wrap\")[0]):cancelFullScreenInterface.call(document);\r\n\t\t\t}else {\t\t\t\t\r\n\t\t\t\tflag?ele.addClass(wrap, \"pad-full-screen\"):ele.removeClass(wrap, \"pad-full-screen\");\r\n\t\t\t}\r\n\r\n\t\t\tisFullScreen = flag;\r\n\t\t\tele.removeClass(fullScreenBtn, isFullScreen?\"icon-enlarge\":\"icon-narrow\");\r\n\t\t\tele.addClass(fullScreenBtn, isFullScreen?\"icon-narrow\":\"icon-enlarge\");\r\n\t\t\tresizePad();\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tvar exportImage = function() {\r\n\t\t\tvar uuid = data.uuid,\r\n\t\t\t\tdownloadEle = document.createElement(\"A\"),\r\n\t\t\t\tcreateImageCanvas = self.createImageCanvas,\r\n\t\t\t\tctx = createImageCanvas.getContext(\"2d\");\r\n\r\n\t\t\tctx.drawImage(self.fileCanvas, 0, 0);\r\n\t\t\tctx.drawImage(self.mainCanvas, 0, 0);\r\n\r\n\t\t\tvar\timage = createImageCanvas.toDataURL(),\r\n\t\t\t\timageDataArr = image.split(\",\"),\r\n\t\t\t\tbStr = atob(imageDataArr[1]),\r\n\t\t\t\tlen = bStr.length,\r\n\t\t\t\ttArr = new Uint8ClampedArray(len);\r\n\r\n\t\t\twhile(len--) {\r\n\t\t\t\ttArr[len] = bStr.charCodeAt(len);\r\n\t\t\t}\r\n\r\n\t\t\tvar url = URL.createObjectURL(new Blob([tArr], {mime: \"image/octet-stream;Content-Disposition:attachment\"}));\r\n\t\t\tdownloadEle.href = url;\r\n\t\t\tdownloadEle.download = uuid + \".png\";\r\n\t\t\tdownloadEle.click();\r\n\t\t\tURL.revokeObjectURL(url);\r\n\t\t\tcreateImageCanvas.width = createImageCanvas.width;\r\n\t\t};\r\n\r\n\t\tself.pad.resize = function(w, h) {\r\n\t\t\t!isNaN(w) && !isNaN(h) && resizePad(w, h);\r\n\t\t\tself.tab.active.call(self, self.tab.getActive().id);\r\n\t\t};\r\n\r\n\t\tself.pad.scroll = function(data) {\r\n\t\t\tscrollObj.scroll(data);\r\n\t\t};\r\n\r\n\t\tself.pad.fullScreen = function() {\r\n\t\t\tif(isFullScreen) return ;\r\n\t\t\tfullScreen(true);\r\n\t\t};\r\n\r\n\t\tself.pad.exitFullScreen = function() {\r\n\t\t\tif(!isFullScreen) return ;\r\n\t\t\tfullScreen(false);\r\n\t\t};\r\n\r\n\t\tself.pad.showFiles = function(params) {\r\n\t\t\tvar files = params.files,\r\n\t\t\t\tnewTab = params.newTab,\r\n\t\t\t\tisShow = params.isShow,\r\n\t\t\t\tfrom = void(0)!=params.from?params.from:self.params.id,\r\n\t\t\t\ttabId = params.tabId,\r\n\t\t\t\ttabName = params.tabName,\r\n\t\t\t\tactiveTab = self.tab.getActive();\r\n\r\n\t\t\tfiles = \"[object Array]\"===toString.call(files)?files:[files];\r\n\r\n\t\t\tvar _showFiles = function() {\r\n\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\tdata: files, \r\n\t\t\t\t\tshow: isShow, \r\n\t\t\t\t\tthat: self,\r\n\t\t\t\t\twidth: params.width,\r\n\t\t\t\t\theight: params.height,\r\n\t\t\t\t\tfrom: from,\r\n\t\t\t\t\ttabId: newTab?id:activeTab.id\r\n\t\t\t\t});\r\n\r\n\t\t\t\tself.tab.setPage.call(self, void(0)!=id?id:activeTab.id, pageObj);\r\n\t\t\t\tactiveTab.page = pageObj;\r\n\r\n\t\t\t\tif(self.params.id==from && \"[object Function]\"===toString.call(self.params.onShowFiles)) {\r\n\t\t\t\t\tparams.from = from;\r\n\t\t\t\t\tself.params.onShowFiles(params);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif(newTab) {\r\n\t\t\t\tvar _tab = {id: tabId, name: tabName};\r\n\t\t\t\tvar id = self.tab.build.call(self, bufferCanvas4, 1, null, _tab, from);\r\n\t\t\t\tparams.tabId = id;\r\n\r\n\t\t\t\tif(isShow) {\r\n\t\t\t\t\tself.tab.active.call(self, id);\r\n\t\t\t\t\t_showFiles();\r\n\t\t\t\t\tfrom == self.params.id && self.params.onTabChange && self.params.onTabChange(id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tself.pad.clear();\r\n\t\t\t\t_showFiles();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfr.onload = function(data) {\r\n\t\t\tself.toolbarMap.image.renderBuffer.call(self, data.target.result);\r\n\t\t\tself.toolbarMap.image.render.call(self, [0, 0]);\r\n\t\t\tfileInput.value = \"\";\r\n\t\t};\r\n\r\n\t\tele.addEvent(fileInput, \"change\", function() {\r\n\t\t\tfr.readAsDataURL(this.files[0]);\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"input\", function() {\r\n\t\t\tthis.style.width = this.scrollWidth + \"px\";\r\n\t\t});\r\n\r\n\t\tele.addEvent(textInput, \"keyup\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), \r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(13===e.which) {\r\n\t\t\t\tvar val = data.trim(this.value);\r\n\t\t\t\tcurrent.render.call(self, val);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"keydown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\twhich = e.which;\r\n\r\n\t\t\tif(!self.active) return ;\r\n\r\n\t\t\tswitch(true) {\r\n\t\t\t\tcase 107===which || (187===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.largen && current.largen.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase 109===which || (189===which && e.shiftKey):\r\n\t\t\t\tcurrent && current.lesser && current.lesser.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, eventMap[\"click\"], function() {\r\n\t\t\tif(params.disable) return ;\r\n\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\tspan = e.srcElement || e.target,\r\n\t\t\t\tlevel = +span.getAttribute(\"level\"),\r\n\t\t\t\titem = span.getAttribute(\"item\");\r\n\r\n\t\t\tif(!item) return ;\r\n\t\t\tcurrent && current.destory.call(self);\r\n\r\n\t\t\tswitch(item) {\r\n\t\t\t\tcase \"handPad\":\r\n\t\t\t\thandPad = !handPad;\r\n\t\t\t\tif(handPad) {\r\n\t\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tspan.removeAttribute(\"active\");\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"color\":\r\n\t\t\t\tcolorInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"clear\":\r\n\t\t\t\tself.tab.clear.call(self);\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\texportImage();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"image\":\r\n\t\t\t\tfileInput.click();\r\n\t\t\t\tbreak;\r\n\t\t\t\tcase \"fullScreen\":\r\n\t\t\t\tfullScreen(!isFullScreen);\r\n\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tcurrent = toolbarMap[item] || current;\r\n\t\t\t\tif(!current) return ;\r\n\t\t\t\tself.current = current;\r\n\t\t\t\tcurrent.active();\r\n\r\n\t\t\t\tif(0===level) {\r\n\t\t\t\t\tcurActiveNode && curActiveNode.removeAttribute(\"active\");\r\n\t\t\t\t\tcurActiveNode = span;\r\n\t\t\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\r\n\t\t\t\t\tif(span.parentNode!=lastSpan) {\r\n\t\t\t\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tele.addClass(span.parentNode, \"selected-item\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(1===level) {\r\n\t\t\t\t\tcurActiveChildNode && curActiveChildNode.removeAttribute(\"active\");\r\n\t\t\t\t\tvar parentSpan = ele.preNode(span.parentNode.parentNode);\r\n\t\t\t\t\tparentSpan.title = span.parentNode.title;\r\n\t\t\t\t\tparentSpan.className = parentSpan.className.replace(/\\bicon-[\\w-]+\\b/, span.className.match(/\\bicon-[\\w-]+\\b/));\r\n\t\t\t\t\tparentSpan.setAttribute(\"item\", item);\r\n\t\t\t\t\tcurActiveChildNode = span;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tspan.setAttribute(\"active\", \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif(item) {\r\n\t\t\t\tif(window.event) {\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(toolbarWrap, \"mousedown\", function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar mouseX = 0, mouseY = 0;\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"move\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0), e = args[0] || window.event;\r\n\t\t\tif(isMobile && e.targetTouches.length>1) return ;\r\n\r\n\t\t\tvar rect = this.getBoundingClientRect(),\r\n\t\t\t\tposX = isMobile?e.targetTouches[0].clientX:e.clientX,\r\n\t\t\t\tposY = isMobile?e.targetTouches[0].clientY:e.clientY,\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: posX - (rect.x || rect.left),\r\n\t\t\t\t\ty: posY - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(!current) {\r\n\t\t\t\tif(active) {\r\n\t\t\t\t\tif(true===scrollObj.disable) return ;\r\n\t\t\t\t\tvar moveX = mouseX - posX, moveY = mouseY - posY;\r\n\r\n\t\t\t\t\tif(isMobile) {\r\n\t\t\t\t\t\tmoveX /= 10;\r\n\t\t\t\t\t\tmoveY /= 10;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.x.coverWidth>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({type: \"x\", distance: moveX, from: params.id, scale: scrollObj.scrollObj.x.moveWidth/scrollObj.scrollObj.x.coverWidth});\r\n\t\t\t\t\t\tmouseX = posX;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(scrollObj.scrollObj.y.coverHeight>0) {\r\n\t\t\t\t\t\tscrollObj.scroll({type: \"y\", distance: moveY, from: params.id, scale: scrollObj.scrollObj.y.moveHeight/scrollObj.scrollObj.y.coverHeight});\r\n\t\t\t\t\t\tmouseY = posY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar item = current.name.toLowerCase();\r\n\r\n\t\t\t\tif(handPad || active) {\r\n\t\t\t\t\tswitch(item) {\r\n\t\t\t\t\t\tcase \"ferula\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"circular\":\r\n\t\t\t\t\t\tcase \"quadrate\":\r\n\t\t\t\t\t\tcurrent.mouseRender.call(self, pos);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tcurrent.bufferRender.call(self, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcurrent.mouseRender && current.mouseRender.call(self, pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"down\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event,\r\n\t\t\t\trect = this.getBoundingClientRect(),\r\n\t\t\t\tlastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0],\r\n\t\t\t\tpos = {\r\n\t\t\t\t\tx: (isMobile?e.targetTouches[0].clientX:e.clientX) - (rect.x || rect.left), \r\n\t\t\t\t\ty: (isMobile?e.targetTouches[0].clientY:e.clientY) - (rect.y || rect.top)\r\n\t\t\t\t};\r\n\r\n\t\t\tif(window.event) {\r\n\t\t\t\te.returnValue = false;\r\n\t\t\t\te.cancelBubble = true;\r\n\t\t\t} else {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\r\n\t\t\tmouseX = isMobile?e.targetTouches[0].clientX:e.clientX;\r\n\t\t\tmouseY = isMobile?e.targetTouches[0].clientY:e.clientY;\r\n\t\t\tactive = true;\r\n\t\t\tif(!current) return ;\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t\tcurrent.bufferRender && current.bufferRender.call(self, pos, true);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, eventMap[\"down\"], function() {\r\n\t\t\tvar lastSpan = toolbarWrap.getElementsByClassName(\"selected-item\")[0];\r\n\t\t\tele.removeClass(lastSpan, \"selected-item\");\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(document, \"mouseup\", function() {\r\n\t\t\tif(active) {\r\n\t\t\t\tactive = false;\r\n\t\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tele.addEvent(bufferCanvas1, eventMap[\"up\"], function() {\r\n\t\t\tvar args = [].slice.call(arguments, 0),\r\n\t\t\t\te = args[0] || window.event;\r\n\t\t\tactive = false;\r\n\t\t\tcurrent && current.render && current.render.call(self);\r\n\t\t});\r\n\r\n\t\tele.addEvent(canvasWrap, \"mouseleave\", function() {\r\n\t\t\tcurrent && current.destory.call(self);\r\n\t\t});\r\n\r\n\t\tself.bufferCanvas = bufferCanvas2;\r\n\r\n\t\tif(!_data) {\r\n\t\t\tvar _n = self.tab.build.call(self, mainCanvas, 0);\r\n\t\t\tself.tab.active.call(self, _n);\r\n\t\t} else {\r\n\t\t\tObject.keys(_data).sort(function(a, b) {return a-b}).forEach(function(key) {\r\n\t\t\t\tvar val = _data[key];\r\n\t\t\t\tvar _n = self.tab.build.call(self, 0===val.type?mainCanvas:bufferCanvas4, val.type, val.data, {id: key, name: val.tabName}, val.from);\r\n\r\n\t\t\t\tif(val.splitPage) {\r\n\t\t\t\t\tvar pageObj = new Page({\r\n\t\t\t\t\t\tdata: val.data, \r\n\t\t\t\t\t\tshow: 0 === val.type, \r\n\t\t\t\t\t\tthat: self,\r\n\t\t\t\t\t\ttabId: _n\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.tab.setPage.call(self, _n, pageObj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t0===val.type && self.tab.active.call(self, _n);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\twindow.wPad = {\r\n\t\tinit: function(params) {\r\n\t\t\tvar _params = data.copy({}, defaultConfig);\r\n\t\t\t_params = data.copy(_params, params);\r\n\t\t\t_params.id = void(0)==_params.id?data.uuid:_params.id;\r\n\t\t\tvar pad = new WPad(_params);\r\n\t\t\tvoid(0)!=_params.id && (padMap[_params.id] = pad);\r\n\t\t\tpadTab.push(pad);\r\n\t\t\treturn pad;\r\n\t\t},\r\n\t\tgetPadById: function(id) {\r\n\t\t\tif(void(0)===id) return ;\r\n\t\t\treturn padMap[id];\r\n\t\t},\r\n\t\tgetPadByIndex: function(index) {\r\n\t\t\tif(void(0)===index) return ;\r\n\t\t\treturn padTab[index];\r\n\t\t}\r\n\t};\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: line.js\r\n * describe: 线性\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\tline: 0,\t//直线\r\n\t\tarrow: 1\t//箭头\r\n\t};\r\n\r\n\tfunction Line(params) {\r\n\t\tthis.name = params.name || \"Line\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tLine.prototype = {\r\n\t\tconstructor: Line,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x;\r\n\t\t\t\tself.current.points[3] = data.y;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(!origin) {\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"line\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.line = Line;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: pen.js\r\n * describe: 笔\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Pen(params) {\r\n\t\tthis.name = params.name || \"Pen\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tPen.prototype = {\r\n\t\tconstructor: Pen,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(_data, origin) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdata = !!origin?{type: \"pen\", data: [], status: 0, origin: !!origin, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight}:self.current.interimBuffer.pop();\r\n\t\t\tdata.data.push(_data);\r\n\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.pen = Pen;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: rectangle.js\r\n * describe: 矩形\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\tvar modeMap = {\r\n\t\trectstroke: 0,\t//空心矩形\r\n\t\trect: 1\t//实心矩形\r\n\t};\r\n\r\n\tfunction Rectangle(params) {\r\n\t\tthis.name = params.name || \"Rectangle\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRectangle.prototype = {\r\n\t\tconstructor: Rectangle,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tself.current.points[2] = data.x-(self.current.points[0]||0);\r\n\t\t\t\tself.current.points[3] = data.y-(self.current.points[1]||0);\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = [].concat.apply([], self.current.points);\r\n\t\t\t\tdata = {type: \"rectangle\", data: data, status: 0, mode: modeMap[self.current.name], origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.rectangle = Rectangle;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: round.js\r\n * describe: 圆\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tvar modeMap = {\r\n\t\tcircle: 0,\t//空心圆\r\n\t\troundel: 1,\t//实心圆\r\n\t\tellipesstroke: 2,\t//空心椭圆\r\n\t\tellipes: 3\t//实心椭圆\r\n\t};\r\n\r\n\tfunction Round(params) {\r\n\t\tthis.name = params.name || \"Round\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tRound.prototype = {\r\n\t\tconstructor: Round,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t} else {\r\n\t\t\t\tvar _data = [],\r\n\t\t\t\t\toriginX = self.current.points[0],\r\n\t\t\t\t\toriginY = self.current.points[1],\r\n\t\t\t\t\tmode = modeMap[self.current.name],\r\n\t\t\t\t\txc = data.x - originX,\r\n\t\t\t\t\tyc = data.y - originY;\r\n\r\n\t\t\t\t_data.push((originX+data.x)/2);\r\n\t\t\t\t_data.push((originY+data.y)/2);\r\n\r\n\t\t\t\tif(0===mode || 1===mode) {\r\n\t\t\t\t\t_data.push(Math.abs(xc)>Math.abs(yc)?Math.abs(xc)/2:Math.abs(yc)/2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_data.push(Math.abs(xc)/2);\r\n\t\t\t\t\t_data.push(Math.abs(yc)/2);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tself.current.interimBuffer.pop();\r\n\t\t\t\tdata = {type: \"round\", data: _data, status: 0, mode: mode, origin: true, color: self.params.color, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function() {\r\n\t\t\tvar self = this, data = self.current.interimBuffer.shift();\r\n\t\t\tif(!data) return ;\r\n\r\n\t\t\tdo {\r\n\t\t\t\tdata.status = 1;\r\n\t\t\t\tself.current.buffer.push(data);\r\n\t\t\t\tself.render(data);\r\n\t\t\t\tdata = self.current.interimBuffer.shift();\r\n\t\t\t} while(data);\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.round = Round;\r\n\twindow.vm = vm;\r\n}());","/**\r\n *\r\n *\r\n * date: 2018-03-24\r\n * author: Jason\r\n * fileName: text.js\r\n * describe: 文本\r\n *\r\n *\r\n */\r\n;(function() {\r\n\t\"use strict\";\r\n\r\n\tfunction Text(params) {\r\n\t\tthis.name = params.name || \"Text\";\r\n\t\tthis.interimBuffer = [];\r\n\t\tthis.points = [];\r\n\t\tthis.buffer = [];\r\n\t}\r\n\r\n\tText.prototype = {\r\n\t\tconstructor: Text,\r\n\t\tactive: function() {},\r\n\t\t// 绘制缓存接口，这里是将数据绘制到缓存画板上\r\n\t\t// status = 0\r\n\t\tbufferRender: function(data, origin) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif(origin) {\r\n\t\t\t\tself.current.points = [];\r\n\t\t\t\tself.current.points.push(data.x);\r\n\t\t\t\tself.current.points.push(data.y);\r\n\t\t\t\tself.textInput.style.cssText = \"visibility: visible; z-index: 101; font-size: \" + self.params.fontSize + \"; left: \" + (data.x + self.mainCanvas.offsetLeft) + \"px; top: \" + (data.y + self.mainCanvas.offsetTop -self.textInput.offsetHeight/2 - 18) + \"px\";\r\n\t\t\t\tself.textInput.focus();\r\n\t\t\t\tdata = {type: \"text\", data: [data.x, data.y], status: 0, origin: !!origin, color: self.params.color, size: self.params.fontSize, from: self.params.id, width: self.mainCanvas.offsetWidth, height: self.mainCanvas.offsetHeight};\r\n\t\t\t\tself.current.interimBuffer.push(data);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 绘制最终结果，这里是将数据绘制到持久画板上\r\n\t\t// status = 1\r\n\t\trender: function(content) {\r\n\t\t\tif(\"[object String]\"!=Object.prototype.toString.call(content)) return ;\r\n\t\t\tcontent = content.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(!content) return ;\r\n\t\t\tvar self = this, data = self.current.interimBuffer.pop();\r\n\t\t\tif(!data) return ;\r\n\t\t\tdata.data.push(content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t\tdata.status = 1;\r\n\t\t\tself.current.buffer.push(data);\r\n\t\t\tself.render(data);\r\n\t\t\tself.current.interimBuffer.length = 0;\r\n\t\t},\r\n\t\tdestory: function() {\r\n\t\t\tvar self = this, content = self.textInput.value.replace(/^\\s*|\\s*$/, \"\");\r\n\t\t\tif(content) self.current.render.call(self, content);\r\n\t\t\tself.textInput.value = \"\";\r\n\t\t\tself.textInput.removeAttribute(\"style\");\r\n\t\t}\r\n\t};\r\n\r\n\tvar vm = window.vm || {};\r\n\tvm.module = vm.module || {};\r\n\tvm.module.text = Text;\r\n\twindow.vm = vm;\r\n}());"]}